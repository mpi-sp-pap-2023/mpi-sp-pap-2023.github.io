<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="common/css/sf.css" rel="stylesheet" type="text/css" />
<title>Auto: More Automation</title>
<link href="common/jquery-ui/jquery-ui.css" rel="stylesheet">
<script src="common/jquery-ui/external/jquery/jquery.js"></script>
<script src="common/jquery-ui/jquery-ui.js"></script>
<script src="common/toggleproofs.js"></script>
<link href="common/css/lf.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="common/slides.js"></script>
<link href="common/css/slides.css" rel="stylesheet" type="text/css"/>
</head>

<body>

<div id="page">

<div id="header">
<div id='logoinheader'><a href='https://softwarefoundations.cis.upenn.edu'>
<img src='common/media/image/sf_logo_sm.png' alt='Software Foundations Logo'></a></div>
<div class='booktitleinheader'><a href='index.html'>Volume 1: Logical Foundations</a></div>
<ul id='menu'>
   <li class='section_name'><a href='toc.html'>Table of Contents</a></li>
   <li class='section_name'><a href='coqindex.html'>Index</a></li>
   <li class='section_name'><a href='deps.html'>Roadmap</a></li>
</ul>
</div>

<div id="main">

<h1 class="libtitle">Auto<span class="subtitle">More Automation</span></h1>



<div class="doc">
Consider the proof below, showing that <span class="inlinecode"><span class="id" title="var">ceval</span></span> is
    deterministic.  Notice all the repetition and near-repetition... 
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">ceval_deterministic</span>: <span class="id" title="keyword">∀</span> <span class="id" title="var">c</span> <span class="id" title="var">st</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">st</span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">st<sub>1</sub></span>  →<br/>
&nbsp;&nbsp;<span class="id" title="var">st</span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">st<sub>2</sub></span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">st<sub>1</sub></span> = <span class="id" title="var">st<sub>2</sub></span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">c</span> <span class="id" title="var">st</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">E<sub>1</sub></span> <span class="id" title="var">E<sub>2</sub></span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">st<sub>2</sub></span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">E<sub>1</sub></span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">E<sub>2</sub></span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">E<sub>2</sub></span>; <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;E_Skip&nbsp;*)</span> <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;E_Asgn&nbsp;*)</span> <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;E_Seq&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">IHE1_1</span> <span class="id" title="var">st'0</span> <span class="id" title="var">H<sub>1</sub></span>) <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHE1_2</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;E_IfTrue&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;b&nbsp;evaluates&nbsp;to&nbsp;true&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHE1</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;b&nbsp;evaluates&nbsp;to&nbsp;false&nbsp;(contradiction)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>5</sub></span>. <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;E_IfFalse&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;b&nbsp;evaluates&nbsp;to&nbsp;true&nbsp;(contradiction)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>5</sub></span>. <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;b&nbsp;evaluates&nbsp;to&nbsp;false&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHE1</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;E_WhileFalse&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;b&nbsp;evaluates&nbsp;to&nbsp;false&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;b&nbsp;evaluates&nbsp;to&nbsp;true&nbsp;(contradiction)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>2</sub></span>. <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;E_WhileTrue&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;b&nbsp;evaluates&nbsp;to&nbsp;false&nbsp;(contradiction)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>4</sub></span>. <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;b&nbsp;evaluates&nbsp;to&nbsp;true&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">IHE1_1</span> <span class="id" title="var">st'0</span> <span class="id" title="var">H<sub>3</sub></span>) <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">IHE1_2</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab440"></a><h1 class="section">The <span class="inlinecode"><span class="id" title="tactic">auto</span></span> Tactic</h1>

<div class="paragraph"> </div>

 Thus far, our proof scripts mostly apply relevant hypotheses or
    lemmas by name, and only one at a time. 
<div class="paragraph"> </div>

 The <span class="inlinecode"><span class="id" title="tactic">auto</span></span> tactic frees us from this drudgery by <i>searching</i> for a
    sequence of applications that will prove the goal: 
</div>
<div class="code">

<span class="id" title="keyword">Example</span> <span class="id" title="var">auto_example_1'</span> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">R</span>: <span class="id" title="keyword">Prop</span>),<br/>
&nbsp;&nbsp;(<span class="id" title="var">P</span> → <span class="id" title="var">Q</span>) → (<span class="id" title="var">Q</span> → <span class="id" title="var">R</span>) → <span class="id" title="var">P</span> → <span class="id" title="var">R</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab441"></a><h3 class="section"> </h3>
 The <span class="inlinecode"><span class="id" title="tactic">auto</span></span> tactic solves goals that are solvable by any combination of
<ul class="doclist">
<li> <span class="inlinecode"><span class="id" title="tactic">intros</span></span> and

</li>
<li> <span class="inlinecode"><span class="id" title="tactic">apply</span></span> (of hypotheses from the local context, by default). 
</li>
</ul>

<div class="paragraph"> </div>

 Here is a larger example showing <span class="inlinecode"><span class="id" title="tactic">auto</span></span>'s power: 
</div>
<div class="code">

<span class="id" title="keyword">Example</span> <span class="id" title="var">auto_example_2</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">R</span> <span class="id" title="var">S</span> <span class="id" title="var">T</span> <span class="id" title="var">U</span> : <span class="id" title="keyword">Prop</span>,<br/>
&nbsp;&nbsp;(<span class="id" title="var">P</span> → <span class="id" title="var">Q</span>) →<br/>
&nbsp;&nbsp;(<span class="id" title="var">P</span> → <span class="id" title="var">R</span>) →<br/>
&nbsp;&nbsp;(<span class="id" title="var">T</span> → <span class="id" title="var">R</span>) →<br/>
&nbsp;&nbsp;(<span class="id" title="var">S</span> → <span class="id" title="var">T</span> → <span class="id" title="var">U</span>) →<br/>
&nbsp;&nbsp;((<span class="id" title="var">P</span> → <span class="id" title="var">Q</span>) → (<span class="id" title="var">P</span> → <span class="id" title="var">S</span>)) →<br/>
&nbsp;&nbsp;<span class="id" title="var">T</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">U</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab442"></a><h3 class="section"> </h3>
 Proof search could, in principle, take an arbitrarily long time,
    so there are limits to how far <span class="inlinecode"><span class="id" title="tactic">auto</span></span> will search by default. 
<div class="paragraph"> </div>

 If <span class="inlinecode"><span class="id" title="tactic">auto</span></span> is not solving our goal as expected
    we can use <span class="inlinecode"><span class="id" title="tactic">debug</span></span> <span class="inlinecode"><span class="id" title="tactic">auto</span></span> to see a trace 
</div>
<div class="code">
<span class="id" title="keyword">Example</span> <span class="id" title="var">auto_example_3</span> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">R</span> <span class="id" title="var">S</span> <span class="id" title="var">T</span> <span class="id" title="var">U</span>: <span class="id" title="keyword">Prop</span>),<br/>
&nbsp;&nbsp;(<span class="id" title="var">P</span> → <span class="id" title="var">Q</span>) →<br/>
&nbsp;&nbsp;(<span class="id" title="var">Q</span> → <span class="id" title="var">R</span>) →<br/>
&nbsp;&nbsp;(<span class="id" title="var">R</span> → <span class="id" title="var">S</span>) →<br/>
&nbsp;&nbsp;(<span class="id" title="var">S</span> → <span class="id" title="var">T</span>) →<br/>
&nbsp;&nbsp;(<span class="id" title="var">T</span> → <span class="id" title="var">U</span>) →<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">U</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;When&nbsp;it&nbsp;cannot&nbsp;solve&nbsp;the&nbsp;goal,&nbsp;<span class="inlinecode"><span class="id" title="tactic">auto</span></span>&nbsp;does&nbsp;nothing&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Let's&nbsp;see&nbsp;where&nbsp;<span class="inlinecode"><span class="id" title="tactic">auto</span></span>&nbsp;gets&nbsp;stuck&nbsp;using&nbsp;<span class="inlinecode"><span class="id" title="tactic">debug</span></span> <span class="inlinecode"><span class="id" title="tactic">auto</span></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">debug</span> <span class="id" title="tactic">auto</span>.<br/><hr class='doublespaceincode'/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Optional&nbsp;argument&nbsp;says&nbsp;how&nbsp;deep&nbsp;to&nbsp;search&nbsp;(default&nbsp;is&nbsp;5)&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">auto</span> 6.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab443"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 <span class="inlinecode"><span class="id" title="tactic">auto</span></span> considers the hypotheses in the current context
    together with a <i>hint database</i> of other lemmas and constructors.
    Some common facts about equality and logical operators are
    installed in the hint database by default. 
</div>
<div class="code">

<span class="id" title="keyword">Example</span> <span class="id" title="var">auto_example_4</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">R</span> : <span class="id" title="keyword">Prop</span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">Q</span> →<br/>
&nbsp;&nbsp;(<span class="id" title="var">Q</span> → <span class="id" title="var">R</span>) →<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> ∨ (<span class="id" title="var">Q</span> ∧ <span class="id" title="var">R</span>).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">auto</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
If we want to see which facts <span class="inlinecode"><span class="id" title="tactic">auto</span></span> is using, we can use
    <span class="inlinecode"><span class="id" title="tactic">info_auto</span></span> instead. 
</div>
<div class="code">

<span class="id" title="keyword">Example</span> <span class="id" title="var">auto_example_5</span>: 2 = 2.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">info_auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Example</span> <span class="id" title="var">auto_example_5'</span> : <span class="id" title="keyword">∀</span> (<span class="id" title="var">P</span> <span class="id" title="var">Q</span> <span class="id" title="var">R</span> <span class="id" title="var">S</span> <span class="id" title="var">T</span> <span class="id" title="var">U</span> <span class="id" title="var">W</span>: <span class="id" title="keyword">Prop</span>),<br/>
&nbsp;&nbsp;(<span class="id" title="var">U</span> → <span class="id" title="var">T</span>) →<br/>
&nbsp;&nbsp;(<span class="id" title="var">W</span> → <span class="id" title="var">U</span>) →<br/>
&nbsp;&nbsp;(<span class="id" title="var">R</span> → <span class="id" title="var">S</span>) →<br/>
&nbsp;&nbsp;(<span class="id" title="var">S</span> → <span class="id" title="var">T</span>) →<br/>
&nbsp;&nbsp;(<span class="id" title="var">P</span> → <span class="id" title="var">R</span>) →<br/>
&nbsp;&nbsp;(<span class="id" title="var">U</span> → <span class="id" title="var">T</span>) →<br/>
&nbsp;&nbsp;<span class="id" title="var">P</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">T</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">info_auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab444"></a><h3 class="section"> </h3>
 We can extend the hint database just for the purposes of one
    application of <span class="inlinecode"><span class="id" title="tactic">auto</span></span> by writing "<span class="inlinecode"><span class="id" title="tactic">auto</span></span> <span class="inlinecode"><span class="id" title="keyword">using</span></span> <span class="inlinecode">...</span>". 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <span class="id" title="var">le_antisym</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span>: <span class="id" title="var">nat</span>, (<span class="id" title="var">n</span> ≤ <span class="id" title="var">m</span> ∧ <span class="id" title="var">m</span> ≤ <span class="id" title="var">n</span>) → <span class="id" title="var">n</span> = <span class="id" title="var">m</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="var">lia</span>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Example</span> <span class="id" title="var">auto_example_6</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span> <span class="id" title="var">p</span> : <span class="id" title="var">nat</span>,<br/>
&nbsp;&nbsp;(<span class="id" title="var">n</span> ≤ <span class="id" title="var">p</span> → (<span class="id" title="var">n</span> ≤ <span class="id" title="var">m</span> ∧ <span class="id" title="var">m</span> ≤ <span class="id" title="var">n</span>)) →<br/>
&nbsp;&nbsp;<span class="id" title="var">n</span> ≤ <span class="id" title="var">p</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">n</span> = <span class="id" title="var">m</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">auto</span> <span class="id" title="keyword">using</span> <span class="id" title="var">le_antisym</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab445"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 We can also permanently extend the hint database:

<div class="paragraph"> </div>

<ul class="doclist">
<li> <span class="inlinecode"><span class="id" title="keyword">Hint</span></span> <span class="inlinecode"><span class="id" title="keyword">Resolve</span></span> <span class="inlinecode"><span class="id" title="var">T</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">core</span>.</span>

<div class="paragraph"> </div>

          Add theorem or constructor <span class="inlinecode"><span class="id" title="var">T</span></span> to the global DB

<div class="paragraph"> </div>


</li>
<li> <span class="inlinecode"><span class="id" title="keyword">Hint</span></span> <span class="inlinecode"><span class="id" title="keyword">Constructors</span></span> <span class="inlinecode"><span class="id" title="var">c</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">core</span>.</span>

<div class="paragraph"> </div>

          Add <i>all</i> constructors of <span class="inlinecode"><span class="id" title="var">c</span></span> to the global DB

<div class="paragraph"> </div>


</li>
<li> <span class="inlinecode"><span class="id" title="keyword">Hint</span></span> <span class="inlinecode"><span class="id" title="keyword">Unfold</span></span> <span class="inlinecode"><span class="id" title="var">d</span></span> <span class="inlinecode">:</span> <span class="inlinecode"><span class="id" title="var">core</span>.</span>

<div class="paragraph"> </div>

          Automatically expand defined symbol <span class="inlinecode"><span class="id" title="var">d</span></span> during <span class="inlinecode"><span class="id" title="tactic">auto</span></span>

</li>
</ul>

<div class="paragraph"> </div>

 It is also possible to define specialized hint databases (besides
    <span class="inlinecode"><span class="id" title="var">core</span></span>) that can be activated only when needed; indeed, it is good
    style to create your own hint databases instead of polluting
    <span class="inlinecode"><span class="id" title="var">core</span></span>.  See the Coq reference manual for details. 
<div class="paragraph"> </div>

<a id="lab446"></a><h3 class="section"> </h3>

</div>
<div class="code">
<span class="id" title="keyword">Hint Resolve</span> <span class="id" title="var">le_antisym</span> : <span class="id" title="var">core</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Example</span> <span class="id" title="var">auto_example_6'</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">n</span> <span class="id" title="var">m</span> <span class="id" title="var">p</span> : <span class="id" title="var">nat</span>,<br/>
&nbsp;&nbsp;(<span class="id" title="var">n</span>≤ <span class="id" title="var">p</span> → (<span class="id" title="var">n</span> ≤ <span class="id" title="var">m</span> ∧ <span class="id" title="var">m</span> ≤ <span class="id" title="var">n</span>)) →<br/>
&nbsp;&nbsp;<span class="id" title="var">n</span> ≤ <span class="id" title="var">p</span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">n</span> = <span class="id" title="var">m</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">auto</span>. <span class="comment">(*&nbsp;picks&nbsp;up&nbsp;hint&nbsp;from&nbsp;database&nbsp;*)</span><br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab447"></a><h3 class="section"> </h3>

</div>
<div class="code">
<span class="id" title="keyword">Definition</span> <span class="id" title="var">is_fortytwo</span> <span class="id" title="var">x</span> := (<span class="id" title="var">x</span> = 42).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Example</span> <span class="id" title="var">auto_example_7</span>: <span class="id" title="keyword">∀</span> <span class="id" title="var">x</span>,<br/>
&nbsp;&nbsp;(<span class="id" title="var">x</span> ≤ 42 ∧ 42 ≤ <span class="id" title="var">x</span>) → <span class="id" title="var">is_fortytwo</span> <span class="id" title="var">x</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">auto</span>. <span class="comment">(*&nbsp;does&nbsp;nothing&nbsp;*)</span><br/>
<span class="id" title="keyword">Abort</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Hint Unfold</span> <span class="id" title="var">is_fortytwo</span> : <span class="id" title="var">core</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Example</span> <span class="id" title="var">auto_example_7'</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">x</span>,<br/>
&nbsp;&nbsp;(<span class="id" title="var">x</span> ≤ 42 ∧ 42 ≤ <span class="id" title="var">x</span>) → <span class="id" title="var">is_fortytwo</span> <span class="id" title="var">x</span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">auto</span>. <span class="comment">(*&nbsp;try&nbsp;also:&nbsp;info_auto.&nbsp;*)</span><br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab448"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 Let's take a first pass over <span class="inlinecode"><span class="id" title="var">ceval_deterministic</span></span> to simplify the
    proof script. 
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">ceval_deterministic'</span>: <span class="id" title="keyword">∀</span> <span class="id" title="var">c</span> <span class="id" title="var">st</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">st</span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">st<sub>1</sub></span>  →<br/>
&nbsp;&nbsp;<span class="id" title="var">st</span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">st<sub>2</sub></span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">st<sub>1</sub></span> = <span class="id" title="var">st<sub>2</sub></span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">c</span> <span class="id" title="var">st</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">E<sub>1</sub></span> <span class="id" title="var">E<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">st<sub>2</sub></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">E<sub>1</sub></span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">E<sub>2</sub></span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">E<sub>2</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;E_Seq&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">IHE1_1</span> <span class="id" title="var">st'0</span> <span class="id" title="var">H<sub>1</sub></span>) <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;E_IfTrue&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;b&nbsp;evaluates&nbsp;to&nbsp;false&nbsp;(contradiction)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>5</sub></span>. <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;E_IfFalse&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;b&nbsp;evaluates&nbsp;to&nbsp;true&nbsp;(contradiction)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>5</sub></span>. <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;E_WhileFalse&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;b&nbsp;evaluates&nbsp;to&nbsp;true&nbsp;(contradiction)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>2</sub></span>. <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;E_WhileTrue&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;b&nbsp;evaluates&nbsp;to&nbsp;false&nbsp;(contradiction)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>4</sub></span>. <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;b&nbsp;evaluates&nbsp;to&nbsp;true&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">IHE1_1</span> <span class="id" title="var">st'0</span> <span class="id" title="var">H<sub>3</sub></span>) <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab449"></a><h1 class="section">Searching For Hypotheses</h1>

<div class="paragraph"> </div>

 The proof has become simpler, but there is still an annoying
    amount of repetition.

<div class="paragraph"> </div>

    Let's first tackle the contradiction cases.  Each occurs where we
    have hypothesis of the form
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">H<sub>1</sub></span>: <span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">b</span> = <span class="id" title="var">false</span>
</span>    as well as:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">H<sub>2</sub></span>: <span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">b</span> = <span class="id" title="var">true</span>
</span>
<div class="paragraph"> </div>

    First step: abstracting out that piece as a script in Ltac.

</div>
<div class="code">

<span class="id" title="keyword">Ltac</span> <span class="id" title="var">rwd</span> <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">H<sub>2</sub></span> := <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>2</sub></span>; <span class="id" title="tactic">discriminate</span>.<br/>
</div>

<div class="doc">
<a id="lab450"></a><h3 class="section"> </h3>
 Using <span class="inlinecode"><span class="id" title="var">rwd</span></span>... 
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">ceval_deterministic''</span>: <span class="id" title="keyword">∀</span> <span class="id" title="var">c</span> <span class="id" title="var">st</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">st</span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">st<sub>1</sub></span>  →<br/>
&nbsp;&nbsp;<span class="id" title="var">st</span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">st<sub>2</sub></span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">st<sub>1</sub></span> = <span class="id" title="var">st<sub>2</sub></span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">c</span> <span class="id" title="var">st</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">E<sub>1</sub></span> <span class="id" title="var">E<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">st<sub>2</sub></span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">E<sub>1</sub></span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">E<sub>2</sub></span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">E<sub>2</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;E_Seq&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">IHE1_1</span> <span class="id" title="var">st'0</span> <span class="id" title="var">H<sub>1</sub></span>) <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;E_IfTrue&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;b&nbsp;evaluates&nbsp;to&nbsp;false&nbsp;(contradiction)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rwd</span> <span class="id" title="var">H</span> <span class="id" title="var">H<sub>5</sub></span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;E_IfFalse&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;b&nbsp;evaluates&nbsp;to&nbsp;true&nbsp;(contradiction)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rwd</span> <span class="id" title="var">H</span> <span class="id" title="var">H<sub>5</sub></span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;E_WhileFalse&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;b&nbsp;evaluates&nbsp;to&nbsp;true&nbsp;(contradiction)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rwd</span> <span class="id" title="var">H</span> <span class="id" title="var">H<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;E_WhileTrue&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;b&nbsp;evaluates&nbsp;to&nbsp;false&nbsp;(contradiction)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rwd</span> <span class="id" title="var">H</span> <span class="id" title="var">H<sub>4</sub></span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;b&nbsp;evaluates&nbsp;to&nbsp;true&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">IHE1_1</span> <span class="id" title="var">st'0</span> <span class="id" title="var">H<sub>3</sub></span>) <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab451"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 That was a bit better, but we really want Coq to discover the
    relevant hypotheses for us.  We can do this by using the <span class="inlinecode"><span class="id" title="keyword">match</span></span>
    <span class="inlinecode"><span class="id" title="keyword">goal</span></span> facility of Ltac. 
</div>
<div class="code">

<span class="id" title="keyword">Ltac</span> <span class="id" title="var">find_rwd</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">H<sub>1</sub></span>: ?<span class="id" title="var">E</span> = <span class="id" title="var">true</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">H<sub>2</sub></span>: ?<span class="id" title="var">E</span> = <span class="id" title="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&#x22A2; <span class="id" title="var">_</span> ⇒ <span class="id" title="var">rwd</span> <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">H<sub>2</sub></span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
The <span class="inlinecode"><span class="id" title="keyword">match</span></span> <span class="inlinecode"><span class="id" title="keyword">goal</span></span> tactic looks for hypotheses matching the
    pattern specified. In this case, we're looking for two equalities
    <span class="inlinecode"><span class="id" title="var">H<sub>1</sub></span></span> and <span class="inlinecode"><span class="id" title="var">H<sub>2</sub></span></span> equating the same expression <span class="inlinecode">?<span class="id" title="var">E</span></span> to both <span class="inlinecode"><span class="id" title="var">true</span></span> and
    <span class="inlinecode"><span class="id" title="var">false</span></span>. 
<div class="paragraph"> </div>

<a id="lab452"></a><h3 class="section"> </h3>

</div>
<div class="code">
<span class="id" title="keyword">Theorem</span> <span class="id" title="var">ceval_deterministic'''</span>: <span class="id" title="keyword">∀</span> <span class="id" title="var">c</span> <span class="id" title="var">st</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">st</span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">st<sub>1</sub></span>  →<br/>
&nbsp;&nbsp;<span class="id" title="var">st</span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">st<sub>2</sub></span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">st<sub>1</sub></span> = <span class="id" title="var">st<sub>2</sub></span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">c</span> <span class="id" title="var">st</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">E<sub>1</sub></span> <span class="id" title="var">E<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">st<sub>2</sub></span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">E<sub>1</sub></span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">E<sub>2</sub></span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">E<sub>2</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">find_rwd</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;E_Seq&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">IHE1_1</span> <span class="id" title="var">st'0</span> <span class="id" title="var">H<sub>1</sub></span>) <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;E_WhileTrue&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;b&nbsp;evaluates&nbsp;to&nbsp;true&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">IHE1_1</span> <span class="id" title="var">st'0</span> <span class="id" title="var">H<sub>3</sub></span>) <span class="id" title="keyword">in</span> ×.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">auto</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab453"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 Let's see about the remaining cases. Each of them involves
    rewriting a hypothesis after feeding it with the required
    condition. We can automate the task of finding the relevant
    hypotheses to rewrite with. 
</div>
<div class="code">

<span class="id" title="keyword">Ltac</span> <span class="id" title="var">find_eqn</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="keyword">goal</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">H<sub>1</sub></span>: <span class="id" title="keyword">∀</span> <span class="id" title="var">x</span>, ?<span class="id" title="var">P</span> <span class="id" title="var">x</span> → ?<span class="id" title="var">L</span> = ?<span class="id" title="var">R</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">H<sub>2</sub></span>: ?<span class="id" title="var">P</span> ?<span class="id" title="var">X</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&#x22A2; <span class="id" title="var">_</span> ⇒ <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">X</span> <span class="id" title="var">H<sub>2</sub></span>) <span class="id" title="keyword">in</span> ×<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
<a id="lab454"></a><h3 class="section"> </h3>
 Now we can make use of <span class="inlinecode"><span class="id" title="var">find_eqn</span></span> to repeatedly rewrite
    with the appropriate hypothesis, wherever it may be found. 
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">ceval_deterministic''''</span>: <span class="id" title="keyword">∀</span> <span class="id" title="var">c</span> <span class="id" title="var">st</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">st</span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">st<sub>1</sub></span>  →<br/>
&nbsp;&nbsp;<span class="id" title="var">st</span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">st<sub>2</sub></span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">st<sub>1</sub></span> = <span class="id" title="var">st<sub>2</sub></span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">c</span> <span class="id" title="var">st</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">E<sub>1</sub></span> <span class="id" title="var">E<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">st<sub>2</sub></span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">E<sub>1</sub></span>; <span class="id" title="tactic">intros</span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">E<sub>2</sub></span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">E<sub>2</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">find_rwd</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">try</span> <span class="id" title="var">find_eqn</span>; <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab455"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 The big payoff in this approach is that our proof script should be
    more robust in the face of modest changes to our language.  To
    test this, let's try adding a <span class="inlinecode"><span class="id" title="var">REPEAT</span></span> command to the language. 
</div>
<div class="code">

<span class="id" title="keyword">Module</span> <span class="id" title="var">Repeat</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">com</span> : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">CSkip</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">CAsgn</span> (<span class="id" title="var">x</span> : <span class="id" title="var">string</span>) (<span class="id" title="var">a</span> : <span class="id" title="var">aexp</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">CSeq</span> (<span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> : <span class="id" title="var">com</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">CIf</span> (<span class="id" title="var">b</span> : <span class="id" title="var">bexp</span>) (<span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> : <span class="id" title="var">com</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">CWhile</span> (<span class="id" title="var">b</span> : <span class="id" title="var">bexp</span>) (<span class="id" title="var">c</span> : <span class="id" title="var">com</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">CRepeat</span> (<span class="id" title="var">c</span> : <span class="id" title="var">com</span>) (<span class="id" title="var">b</span> : <span class="id" title="var">bexp</span>).<br/>
</div>

<div class="doc">
<span class="inlinecode"><span class="id" title="var">REPEAT</span></span> behaves like <span class="inlinecode"><span class="id" title="var">while</span></span>, except that the loop guard is
    checked <i>after</i> each execution of the body, with the loop
    repeating as long as the guard stays <i>false</i>.  Because of this,
    the body will always execute at least once. 
<div class="paragraph"> </div>

<a id="lab456"></a><h3 class="section"> </h3>

</div>
<div class="code">

<span class="id" title="keyword">Notation</span> &quot;'repeat' x 'until' y 'end'" :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">CRepeat</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">x</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 99, <span class="id" title="var">y</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 99).<br/>
<span class="id" title="keyword">Notation</span> &quot;'skip'"  :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">CSkip</span> (<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0).<br/>
<span class="id" title="keyword">Notation</span> &quot;x := y"  :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">CAsgn</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0, <span class="id" title="var">x</span> <span class="id" title="keyword">constr</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 0,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">y</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 85, <span class="id" title="keyword">no</span> <span class="id" title="keyword">associativity</span>).<br/>
<span class="id" title="keyword">Notation</span> &quot;x ; y" :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">CSeq</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 90, <span class="id" title="tactic">right</span> <span class="id" title="keyword">associativity</span>).<br/>
<span class="id" title="keyword">Notation</span> &quot;'if' x 'then' y 'else' z 'end'" :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">CIf</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span> <span class="id" title="var">z</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 89, <span class="id" title="var">x</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 99,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">y</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 99, <span class="id" title="var">z</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 99).<br/>
<span class="id" title="keyword">Notation</span> &quot;'while' x 'do' y 'end'" :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">CWhile</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">in</span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 89, <span class="id" title="var">x</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 99, <span class="id" title="var">y</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 99).<br/>
</div>

<div class="doc">
<a id="lab457"></a><h3 class="section"> </h3>

</div>
<div class="code">
<span class="id" title="keyword">Reserved Notation</span> &quot;st '=[' c ']=&gt;' st'"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 40, <span class="id" title="var">c</span> <span class="id" title="var">custom</span> <span class="id" title="var">com</span> <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 99, <span class="id" title="var">st'</span> <span class="id" title="keyword">constr</span> <span class="id" title="tactic">at</span> <span class="id" title="var">next</span> <span class="id" title="keyword">level</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">ceval</span> : <span class="id" title="var">com</span> → <span class="id" title="var">state</span> → <span class="id" title="var">state</span> → <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">E_Skip</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st</span> =[ <span class="id" title="var">skip</span> ]=&gt; <span class="id" title="var">st</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">E_Asgn</span>  : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">a<sub>1</sub></span> <span class="id" title="var">n</span> <span class="id" title="var">x</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">aeval</span> <span class="id" title="var">st</span> <span class="id" title="var">a<sub>1</sub></span> = <span class="id" title="var">n</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st</span> =[ <span class="id" title="var">x</span> := <span class="id" title="var">a<sub>1</sub></span> ]=&gt; (<span class="id" title="var">x</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> <span class="id" title="var">n</span> ; <span class="id" title="var">st</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">E_Seq</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">st</span> <span class="id" title="var">st'</span> <span class="id" title="var">st''</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st</span>  =[ <span class="id" title="var">c<sub>1</sub></span> ]=&gt; <span class="id" title="var">st'</span>  →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st'</span> =[ <span class="id" title="var">c<sub>2</sub></span> ]=&gt; <span class="id" title="var">st''</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st</span>  =[ <span class="id" title="var">c<sub>1</sub></span> ; <span class="id" title="var">c<sub>2</sub></span> ]=&gt; <span class="id" title="var">st''</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">E_IfTrue</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">st'</span> <span class="id" title="var">b</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">b</span> = <span class="id" title="var">true</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st</span> =[ <span class="id" title="var">c<sub>1</sub></span> ]=&gt; <span class="id" title="var">st'</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st</span> =[ <span class="id" title="keyword">if</span> <span class="id" title="var">b</span> <span class="id" title="keyword">then</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">end</span> ]=&gt; <span class="id" title="var">st'</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">E_IfFalse</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">st'</span> <span class="id" title="var">b</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">b</span> = <span class="id" title="var">false</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st</span> =[ <span class="id" title="var">c<sub>2</sub></span> ]=&gt; <span class="id" title="var">st'</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st</span> =[ <span class="id" title="keyword">if</span> <span class="id" title="var">b</span> <span class="id" title="keyword">then</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="keyword">else</span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="keyword">end</span> ]=&gt; <span class="id" title="var">st'</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">E_WhileFalse</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">b</span> <span class="id" title="var">st</span> <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">b</span> = <span class="id" title="var">false</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st</span> =[ <span class="id" title="var">while</span> <span class="id" title="var">b</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span> ]=&gt; <span class="id" title="var">st</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">E_WhileTrue</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">st'</span> <span class="id" title="var">st''</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">beval</span> <span class="id" title="var">st</span> <span class="id" title="var">b</span> = <span class="id" title="var">true</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st</span>  =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">st'</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st'</span> =[ <span class="id" title="var">while</span> <span class="id" title="var">b</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span> ]=&gt; <span class="id" title="var">st''</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st</span>  =[ <span class="id" title="var">while</span> <span class="id" title="var">b</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span> ]=&gt; <span class="id" title="var">st''</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">E_RepeatEnd</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">st'</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st</span>  =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">st'</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">beval</span> <span class="id" title="var">st'</span> <span class="id" title="var">b</span> = <span class="id" title="var">true</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st</span>  =[ <span class="id" title="tactic">repeat</span> <span class="id" title="var">c</span> <span class="id" title="tactic">until</span> <span class="id" title="var">b</span> <span class="id" title="keyword">end</span> ]=&gt; <span class="id" title="var">st'</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">E_RepeatLoop</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">st</span> <span class="id" title="var">st'</span> <span class="id" title="var">st''</span> <span class="id" title="var">b</span> <span class="id" title="var">c</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st</span>  =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">st'</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">beval</span> <span class="id" title="var">st'</span> <span class="id" title="var">b</span> = <span class="id" title="var">false</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st'</span> =[ <span class="id" title="tactic">repeat</span> <span class="id" title="var">c</span> <span class="id" title="tactic">until</span> <span class="id" title="var">b</span> <span class="id" title="keyword">end</span> ]=&gt; <span class="id" title="var">st''</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st</span>  =[ <span class="id" title="tactic">repeat</span> <span class="id" title="var">c</span> <span class="id" title="tactic">until</span> <span class="id" title="var">b</span> <span class="id" title="keyword">end</span> ]=&gt; <span class="id" title="var">st''</span><br/>
<br/>
&nbsp;&nbsp;<span class="id" title="keyword">where</span> &quot;st =[ c ]=&gt; st'" := (<span class="id" title="var">ceval</span> <span class="id" title="var">c</span> <span class="id" title="var">st</span> <span class="id" title="var">st'</span>).<br/>
</div>

<div class="doc">
<a id="lab458"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 Our first attempt at the determinacy proof does not quite succeed:
    the <span class="inlinecode"><span class="id" title="var">E_RepeatEnd</span></span> and <span class="inlinecode"><span class="id" title="var">E_RepeatLoop</span></span> cases are not handled by our
    previous automation. 
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">ceval_deterministic</span>: <span class="id" title="keyword">∀</span> <span class="id" title="var">c</span> <span class="id" title="var">st</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">st</span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">st<sub>1</sub></span>  →<br/>
&nbsp;&nbsp;<span class="id" title="var">st</span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">st<sub>2</sub></span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">st<sub>1</sub></span> = <span class="id" title="var">st<sub>2</sub></span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">c</span> <span class="id" title="var">st</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">E<sub>1</sub></span> <span class="id" title="var">E<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">st<sub>2</sub></span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">E<sub>1</sub></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">E<sub>2</sub></span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">E<sub>2</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">find_rwd</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">find_eqn</span>; <span class="id" title="tactic">auto</span>.<br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;E_RepeatEnd&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;b&nbsp;evaluates&nbsp;to&nbsp;false&nbsp;(contradiction)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">find_rwd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;oops:&nbsp;why&nbsp;didn't&nbsp;<span class="inlinecode"><span class="id" title="var">find_rwd</span></span>&nbsp;solve&nbsp;this&nbsp;for&nbsp;us&nbsp;already?<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;answer:&nbsp;we&nbsp;did&nbsp;things&nbsp;in&nbsp;the&nbsp;wrong&nbsp;order.&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;E_RepeatLoop&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="comment">(*&nbsp;b&nbsp;evaluates&nbsp;to&nbsp;true&nbsp;(contradiction)&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">find_rwd</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab459"></a><h3 class="section"> </h3>

<div class="paragraph"> </div>

 Fortunately, to fix this, we just have to swap the invocations of
    <span class="inlinecode"><span class="id" title="var">find_eqn</span></span> and <span class="inlinecode"><span class="id" title="var">find_rwd</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <span class="id" title="var">ceval_deterministic'</span>: <span class="id" title="keyword">∀</span> <span class="id" title="var">c</span> <span class="id" title="var">st</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span>,<br/>
&nbsp;&nbsp;<span class="id" title="var">st</span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">st<sub>1</sub></span>  →<br/>
&nbsp;&nbsp;<span class="id" title="var">st</span> =[ <span class="id" title="var">c</span> ]=&gt; <span class="id" title="var">st<sub>2</sub></span> →<br/>
&nbsp;&nbsp;<span class="id" title="var">st<sub>1</sub></span> = <span class="id" title="var">st<sub>2</sub></span>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">c</span> <span class="id" title="var">st</span> <span class="id" title="var">st<sub>1</sub></span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">E<sub>1</sub></span> <span class="id" title="var">E<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">generalize</span> <span class="id" title="tactic">dependent</span> <span class="id" title="var">st<sub>2</sub></span>;<br/>
&nbsp;&nbsp;<span class="id" title="tactic">induction</span> <span class="id" title="var">E<sub>1</sub></span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">st<sub>2</sub></span> <span class="id" title="var">E<sub>2</sub></span>; <span class="id" title="tactic">inversion</span> <span class="id" title="var">E<sub>2</sub></span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">find_eqn</span>; <span class="id" title="tactic">try</span> <span class="id" title="var">find_rwd</span>; <span class="id" title="tactic">auto</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">End</span> <span class="id" title="var">Repeat</span>.<br/>
</div>

<div class="doc">
<a id="lab460"></a><h1 class="section">Tactics <span class="inlinecode"><span class="id" title="tactic">eapply</span></span> and <span class="inlinecode"><span class="id" title="tactic">eauto</span></span></h1>

<div class="paragraph"> </div>

 Recall this example from the <a href="Imp.html"><span class="inlineref">Imp</span></a> chapter: 
</div>
<div class="code">

<span class="id" title="keyword">Example</span> <span class="id" title="var">ceval_example1</span>:<br/>
&nbsp;&nbsp;<span class="id" title="var">empty_st</span> =[<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := 2;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> (<span class="id" title="var">X</span> ≤ 1)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> <span class="id" title="var">Y</span> := 3<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">Z</span> := 4<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;]=&gt; (<span class="id" title="var">Z</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 4 ; <span class="id" title="var">X</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 2).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;We&nbsp;supply&nbsp;the&nbsp;intermediate&nbsp;state&nbsp;<span class="inlinecode"><span class="id" title="var">st'</span></span>...&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">E_Seq</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">X</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 2).<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">E_Asgn</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">E_IfFalse</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">E_Asgn</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab461"></a><h3 class="section"> </h3>
 In the first step of the proof, we had to explicitly provide
    the intermediate state <span class="inlinecode"><span class="id" title="var">X</span></span> <span class="inlinecode">!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span> <span class="inlinecode">2</span>, due to the "hidden" argument <span class="inlinecode"><span class="id" title="var">st'</span></span>
    to the <span class="inlinecode"><span class="id" title="var">E_Seq</span></span> constructor:
<br/>
<span class="inlinecode">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">E_Seq</span> : <span class="id" title="keyword">∀</span> <span class="id" title="var">c<sub>1</sub></span> <span class="id" title="var">c<sub>2</sub></span> <span class="id" title="var">st</span> <span class="id" title="var">st'</span> <span class="id" title="var">st''</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st</span>  =[ <span class="id" title="var">c<sub>1</sub></span> ]=&gt; <span class="id" title="var">st'</span>  →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st'</span> =[ <span class="id" title="var">c<sub>2</sub></span> ]=&gt; <span class="id" title="var">st''</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">st</span>  =[ <span class="id" title="var">c<sub>1</sub></span> ; <span class="id" title="var">c<sub>2</sub></span> ]=&gt; <span class="id" title="var">st''</span>
</span>
<div class="paragraph"> </div>

 If we leave out the <span class="inlinecode"><span class="id" title="keyword">with</span></span>, this step fails, because Coq cannot
    find an instance for the variable <span class="inlinecode"><span class="id" title="var">st'</span></span>. But this is silly! The appropriate
    value for <span class="inlinecode"><span class="id" title="var">st'</span></span> will become obvious in the very next step. 
<div class="paragraph"> </div>

<a id="lab462"></a><h3 class="section"> </h3>
 With <span class="inlinecode"><span class="id" title="tactic">eapply</span></span>, we can eliminate this silliness: 
</div>
<div class="code">

<span class="id" title="keyword">Example</span> <span class="id" title="var">ceval'_example1</span>:<br/>
&nbsp;&nbsp;<span class="id" title="var">empty_st</span> =[<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">X</span> := 2;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> (<span class="id" title="var">X</span> ≤ 1)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> <span class="id" title="var">Y</span> := 3<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">Z</span> := 4<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;]=&gt; (<span class="id" title="var">Z</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 4 ; <span class="id" title="var">X</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 2).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">eapply</span> <span class="id" title="var">E_Seq</span>. <span class="comment">(*&nbsp;1&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">E_Asgn</span>. <span class="comment">(*&nbsp;2&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>. <span class="comment">(*&nbsp;3&nbsp;*)</span><br/>
&nbsp;&nbsp;- <span class="comment">(*&nbsp;4&nbsp;*)</span> <span class="id" title="tactic">apply</span> <span class="id" title="var">E_IfFalse</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">E_Asgn</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Several of the tactics that we've seen so far, including <span class="inlinecode"><span class="id" title="tactic">∃</span></span>,
    <span class="inlinecode"><span class="id" title="tactic">constructor</span></span>, and <span class="inlinecode"><span class="id" title="tactic">auto</span></span>, have similar variants. The <span class="inlinecode"><span class="id" title="tactic">eauto</span></span>
    tactic works like <span class="inlinecode"><span class="id" title="tactic">auto</span></span>, except that it uses <span class="inlinecode"><span class="id" title="tactic">eapply</span></span> instead of
    <span class="inlinecode"><span class="id" title="tactic">apply</span></span>.  Tactic <span class="inlinecode"><span class="id" title="tactic">info_eauto</span></span> shows us which tactics <span class="inlinecode"><span class="id" title="tactic">eauto</span></span> uses
    in its proof search.

<div class="paragraph"> </div>

    Below is an example of <span class="inlinecode"><span class="id" title="tactic">eauto</span></span>.  Before using it, we need to give
    some hints to <span class="inlinecode"><span class="id" title="tactic">auto</span></span> about using the constructors of <span class="inlinecode"><span class="id" title="var">ceval</span></span>
    and the definitions of <span class="inlinecode"><span class="id" title="var">state</span></span> and <span class="inlinecode"><span class="id" title="var">total_map</span></span> as part of its
    proof search.

</div>
<div class="code">

<span class="id" title="keyword">Hint Constructors</span> <span class="id" title="var">ceval</span> : <span class="id" title="var">core</span>.<br/>
<span class="id" title="keyword">Hint Transparent</span> <span class="id" title="var">state</span> <span class="id" title="var">total_map</span> : <span class="id" title="var">core</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Example</span> <span class="id" title="var">eauto_example</span> : <span class="id" title="tactic">∃</span> <span class="id" title="var">s'</span>,<br/>
&nbsp;&nbsp;(<span class="id" title="var">Y</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 1 ; <span class="id" title="var">X</span> !<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span> 2) =[<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> (<span class="id" title="var">X</span> ≤ <span class="id" title="var">Y</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> <span class="id" title="var">Z</span> := <span class="id" title="var">Y</span> - <span class="id" title="var">X</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">Y</span> := <span class="id" title="var">X</span> + <span class="id" title="var">Z</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;]=&gt; <span class="id" title="var">s'</span>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">info_eauto</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The <span class="inlinecode"><span class="id" title="tactic">eauto</span></span> tactic works just like <span class="inlinecode"><span class="id" title="tactic">auto</span></span>, except that it uses
    <span class="inlinecode"><span class="id" title="tactic">eapply</span></span> instead of <span class="inlinecode"><span class="id" title="tactic">apply</span></span>; <span class="inlinecode"><span class="id" title="tactic">info_eauto</span></span> shows us which facts
    <span class="inlinecode"><span class="id" title="tactic">eauto</span></span> uses. 
<div class="paragraph"> </div>

<a id="lab463"></a><h3 class="section"> </h3>

</div>
</div>

<div id="footer">
<hr/><a href="coqindex.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>