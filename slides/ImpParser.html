<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="common/css/sf.css" rel="stylesheet" type="text/css" />
<title>ImpParser: Lexing and Parsing in Coq</title>
<link href="common/jquery-ui/jquery-ui.css" rel="stylesheet">
<script src="common/jquery-ui/external/jquery/jquery.js"></script>
<script src="common/jquery-ui/jquery-ui.js"></script>
<script src="common/toggleproofs.js"></script>
<link href="common/css/lf.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="common/slides.js"></script>
<link href="common/css/slides.css" rel="stylesheet" type="text/css"/>
</head>

<body>

<div id="page">

<div id="header">
<div id='logoinheader'><a href='https://softwarefoundations.cis.upenn.edu'>
<img src='common/media/image/sf_logo_sm.png' alt='Software Foundations Logo'></a></div>
<div class='booktitleinheader'><a href='index.html'>Volume 1: Logical Foundations</a></div>
<ul id='menu'>
   <li class='section_name'><a href='toc.html'>Table of Contents</a></li>
   <li class='section_name'><a href='coqindex.html'>Index</a></li>
   <li class='section_name'><a href='deps.html'>Roadmap</a></li>
</ul>
</div>

<div id="main">

<h1 class="libtitle">ImpParser<span class="subtitle">Lexing and Parsing in Coq</span></h1>


<div class="doc">

<div class="paragraph"> </div>

 The development of the Imp language in <span class="inlinecode"><span class="id" title="var">Imp.v</span></span> completely ignores
    issues of concrete syntax -- how an ascii string that a programmer
    might write gets translated into abstract syntax trees defined by
    the datatypes <span class="inlinecode"><span class="id" title="var">aexp</span></span>, <span class="inlinecode"><span class="id" title="var">bexp</span></span>, and <span class="inlinecode"><span class="id" title="var">com</span></span>.  In this chapter, we
    illustrate how the rest of the story can be filled in by building
    a simple lexical analyzer and parser using Coq's functional
    programming facilities. 
</div>

<div class="doc">
<a id="lab434"></a><h1 class="section">Internals</h1>

</div>

<div class="doc">
<a id="lab435"></a><h2 class="section">Lexical Analysis</h2>

</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">isWhite</span> (<span class="id" title="var">c</span> : <span class="id" title="var">ascii</span>) : <span class="id" title="var">bool</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">n</span> := <span class="id" title="var">nat_of_ascii</span> <span class="id" title="var">c</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;<span class="id" title="var">orb</span> (<span class="id" title="var">orb</span> (<span class="id" title="var">n</span> =? 32)   <span class="comment">(*&nbsp;space&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">n</span> =? 9))   <span class="comment">(*&nbsp;tab&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">orb</span> (<span class="id" title="var">n</span> =? 10)   <span class="comment">(*&nbsp;linefeed&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">n</span> =? 13)). <span class="comment">(*&nbsp;Carriage&nbsp;return.&nbsp;*)</span><br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> &quot;x '&lt;=?' y" := (<span class="id" title="var">x</span> &lt;=? <span class="id" title="var">y</span>)<br/>
&nbsp;&nbsp;(<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 70, <span class="id" title="keyword">no</span> <span class="id" title="keyword">associativity</span>) : <span class="id" title="var">nat_scope</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">isLowerAlpha</span> (<span class="id" title="var">c</span> : <span class="id" title="var">ascii</span>) : <span class="id" title="var">bool</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">n</span> := <span class="id" title="var">nat_of_ascii</span> <span class="id" title="var">c</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">andb</span> (97 &lt;=? <span class="id" title="var">n</span>) (<span class="id" title="var">n</span> &lt;=? 122).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">isAlpha</span> (<span class="id" title="var">c</span> : <span class="id" title="var">ascii</span>) : <span class="id" title="var">bool</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">n</span> := <span class="id" title="var">nat_of_ascii</span> <span class="id" title="var">c</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">orb</span> (<span class="id" title="var">andb</span> (65 &lt;=? <span class="id" title="var">n</span>) (<span class="id" title="var">n</span> &lt;=? 90))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">andb</span> (97 &lt;=? <span class="id" title="var">n</span>) (<span class="id" title="var">n</span> &lt;=? 122)).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">isDigit</span> (<span class="id" title="var">c</span> : <span class="id" title="var">ascii</span>) : <span class="id" title="var">bool</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">n</span> := <span class="id" title="var">nat_of_ascii</span> <span class="id" title="var">c</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">andb</span> (48 &lt;=? <span class="id" title="var">n</span>) (<span class="id" title="var">n</span> &lt;=? 57).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Inductive</span> <span class="id" title="var">chartype</span> := <span class="id" title="var">white</span> | <span class="id" title="var">alpha</span> | <span class="id" title="var">digit</span> | <span class="id" title="var">other</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">classifyChar</span> (<span class="id" title="var">c</span> : <span class="id" title="var">ascii</span>) : <span class="id" title="var">chartype</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">isWhite</span> <span class="id" title="var">c</span> <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">white</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="keyword">if</span> <span class="id" title="var">isAlpha</span> <span class="id" title="var">c</span> <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">alpha</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="keyword">if</span> <span class="id" title="var">isDigit</span> <span class="id" title="var">c</span> <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">digit</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">other</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">list_of_string</span> (<span class="id" title="var">s</span> : <span class="id" title="var">string</span>) : <span class="id" title="var">list</span> <span class="id" title="var">ascii</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">s</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">EmptyString</span> ⇒ []<br/>
&nbsp;&nbsp;| <span class="id" title="var">String</span> <span class="id" title="var">c</span> <span class="id" title="var">s</span> ⇒ <span class="id" title="var">c</span> :: (<span class="id" title="var">list_of_string</span> <span class="id" title="var">s</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">string_of_list</span> (<span class="id" title="var">xs</span> : <span class="id" title="var">list</span> <span class="id" title="var">ascii</span>) : <span class="id" title="var">string</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">fold_right</span> <span class="id" title="var">String</span> <span class="id" title="var">EmptyString</span> <span class="id" title="var">xs</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">token</span> := <span class="id" title="var">string</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">tokenize_helper</span> (<span class="id" title="var">cls</span> : <span class="id" title="var">chartype</span>) (<span class="id" title="var">acc</span> <span class="id" title="var">xs</span> : <span class="id" title="var">list</span> <span class="id" title="var">ascii</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">list</span> (<span class="id" title="var">list</span> <span class="id" title="var">ascii</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">tk</span> := <span class="id" title="keyword">match</span> <span class="id" title="var">acc</span> <span class="id" title="keyword">with</span> [] ⇒ [] | <span class="id" title="var">_</span>::<span class="id" title="var">_</span> ⇒ [<span class="id" title="var">rev</span> <span class="id" title="var">acc</span>] <span class="id" title="keyword">end</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">xs</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| [] ⇒ <span class="id" title="var">tk</span><br/>
&nbsp;&nbsp;| (<span class="id" title="var">x</span>::<span class="id" title="var">xs'</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">cls</span>, <span class="id" title="var">classifyChar</span> <span class="id" title="var">x</span>, <span class="id" title="var">x</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>, <span class="id" title="var">_</span>, "("      ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">tk</span> ++ ["("]::(<span class="id" title="var">tokenize_helper</span> <span class="id" title="var">other</span> [] <span class="id" title="var">xs'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>, <span class="id" title="var">_</span>, ")"      ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">tk</span> ++ [")"]::(<span class="id" title="var">tokenize_helper</span> <span class="id" title="var">other</span> [] <span class="id" title="var">xs'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>, <span class="id" title="var">white</span>, <span class="id" title="var">_</span>    ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">tk</span> ++ (<span class="id" title="var">tokenize_helper</span> <span class="id" title="var">white</span> [] <span class="id" title="var">xs'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">alpha</span>,<span class="id" title="var">alpha</span>,<span class="id" title="var">x</span>  ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">tokenize_helper</span> <span class="id" title="var">alpha</span> (<span class="id" title="var">x</span>::<span class="id" title="var">acc</span>) <span class="id" title="var">xs'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">digit</span>,<span class="id" title="var">digit</span>,<span class="id" title="var">x</span>  ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">tokenize_helper</span> <span class="id" title="var">digit</span> (<span class="id" title="var">x</span>::<span class="id" title="var">acc</span>) <span class="id" title="var">xs'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">other</span>,<span class="id" title="var">other</span>,<span class="id" title="var">x</span>  ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">tokenize_helper</span> <span class="id" title="var">other</span> (<span class="id" title="var">x</span>::<span class="id" title="var">acc</span>) <span class="id" title="var">xs'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">_</span>,<span class="id" title="var">tp</span>,<span class="id" title="var">x</span>         ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">tk</span> ++ (<span class="id" title="var">tokenize_helper</span> <span class="id" title="var">tp</span> [<span class="id" title="var">x</span>] <span class="id" title="var">xs'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span> %<span class="id" title="var">char</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">tokenize</span> (<span class="id" title="var">s</span> : <span class="id" title="var">string</span>) : <span class="id" title="var">list</span> <span class="id" title="var">string</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">map</span> <span class="id" title="var">string_of_list</span> (<span class="id" title="var">tokenize_helper</span> <span class="id" title="var">white</span> [] (<span class="id" title="var">list_of_string</span> <span class="id" title="var">s</span>)).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Example</span> <span class="id" title="var">tokenize_ex<sub>1</sub></span> :<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">tokenize</span> "abc12=3  223*(3+(a+c))" %<span class="id" title="var">string</span><br/>
&nbsp;&nbsp;= ["abc"; "12"; "="; "3"; "223";<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"*"; "("; "3"; "+"; "(";<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"a"; "+"; "c"; ")"; ")"]%<span class="id" title="var">string</span>.<br/>
<div class="togglescript" id="proofcontrol1" onclick="toggleDisplay('proof1');toggleDisplay('proofcontrol1')"><span class="show"></span></div>
<div class="proofscript" id="proof1" onclick="toggleDisplay('proof1');toggleDisplay('proofcontrol1')">
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div class="doc">
<a id="lab436"></a><h2 class="section">Parsing</h2>

<div class="paragraph"> </div>

<a id="lab437"></a><h3 class="section">Options With Errors</h3>

<div class="paragraph"> </div>

 An <span class="inlinecode"><span class="id" title="var">option</span></span> type with error messages: 
</div>
<div class="code">

<span class="id" title="keyword">Inductive</span> <span class="id" title="var">optionE</span> (<span class="id" title="var">X</span>:<span class="id" title="keyword">Type</span>) : <span class="id" title="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id" title="var">SomeE</span> (<span class="id" title="var">x</span> : <span class="id" title="var">X</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">NoneE</span> (<span class="id" title="var">s</span> : <span class="id" title="var">string</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Arguments</span> <span class="id" title="var">SomeE</span> {<span class="id" title="var">X</span>}.<br/>
<span class="id" title="keyword">Arguments</span> <span class="id" title="var">NoneE</span> {<span class="id" title="var">X</span>}.<br/>
</div>

<div class="doc">
Some syntactic sugar to make writing nested match-expressions on
    optionE more convenient. 
</div>
<div class="code">

<span class="id" title="keyword">Notation</span> &quot;' p &lt;- e<sub>1</sub> ;; e<sub>2</sub>"<br/>
&nbsp;&nbsp;&nbsp;:= (<span class="id" title="keyword">match</span> <span class="id" title="var">e<sub>1</sub></span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">SomeE</span> <span class="id" title="var">p</span> ⇒ <span class="id" title="var">e<sub>2</sub></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">NoneE</span> <span class="id" title="var">err</span> ⇒ <span class="id" title="var">NoneE</span> <span class="id" title="var">err</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>)<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">right</span> <span class="id" title="keyword">associativity</span>, <span class="id" title="var">p</span> <span class="id" title="tactic">pattern</span>, <span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 60, <span class="id" title="var">e<sub>1</sub></span> <span class="id" title="tactic">at</span> <span class="id" title="var">next</span> <span class="id" title="keyword">level</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Notation</span> &quot;'TRY' ' p &lt;- e<sub>1</sub> ;; e<sub>2</sub> 'OR' e<sub>3</sub>"<br/>
&nbsp;&nbsp;&nbsp;:= (<span class="id" title="keyword">match</span> <span class="id" title="var">e<sub>1</sub></span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">SomeE</span> <span class="id" title="var">p</span> ⇒ <span class="id" title="var">e<sub>2</sub></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">NoneE</span> <span class="id" title="var">_</span> ⇒ <span class="id" title="var">e<sub>3</sub></span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>)<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" title="tactic">right</span> <span class="id" title="keyword">associativity</span>, <span class="id" title="var">p</span> <span class="id" title="tactic">pattern</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">at</span> <span class="id" title="keyword">level</span> 60, <span class="id" title="var">e<sub>1</sub></span> <span class="id" title="tactic">at</span> <span class="id" title="var">next</span> <span class="id" title="keyword">level</span>, <span class="id" title="var">e<sub>2</sub></span> <span class="id" title="tactic">at</span> <span class="id" title="var">next</span> <span class="id" title="keyword">level</span>).<br/>
</div>

<div class="doc">
<a id="lab438"></a><h3 class="section">Generic Combinators for Building Parsers</h3>

</div>
<div class="code">

<span class="id" title="keyword">Open</span> <span class="id" title="keyword">Scope</span> <span class="id" title="var">string_scope</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">parser</span> (<span class="id" title="var">T</span> : <span class="id" title="keyword">Type</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">list</span> <span class="id" title="var">token</span> → <span class="id" title="var">optionE</span> (<span class="id" title="var">T</span> × <span class="id" title="var">list</span> <span class="id" title="var">token</span>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">many_helper</span> {<span class="id" title="var">T</span>} (<span class="id" title="var">p</span> : <span class="id" title="var">parser</span> <span class="id" title="var">T</span>) <span class="id" title="var">acc</span> <span class="id" title="var">steps</span> <span class="id" title="var">xs</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">steps</span>, <span class="id" title="var">p</span> <span class="id" title="var">xs</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| 0, <span class="id" title="var">_</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">NoneE</span> "Too many recursive calls"<br/>
&nbsp;&nbsp;| <span class="id" title="var">_</span>, <span class="id" title="var">NoneE</span> <span class="id" title="var">_</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SomeE</span> ((<span class="id" title="var">rev</span> <span class="id" title="var">acc</span>), <span class="id" title="var">xs</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">steps'</span>, <span class="id" title="var">SomeE</span> (<span class="id" title="var">t</span>, <span class="id" title="var">xs'</span>) ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">many_helper</span> <span class="id" title="var">p</span> (<span class="id" title="var">t</span> :: <span class="id" title="var">acc</span>) <span class="id" title="var">steps'</span> <span class="id" title="var">xs'</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
A (step-indexed) parser that expects zero or more <span class="inlinecode"><span class="id" title="var">p</span></span>s: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">many</span> {<span class="id" title="var">T</span>} (<span class="id" title="var">p</span> : <span class="id" title="var">parser</span> <span class="id" title="var">T</span>) (<span class="id" title="var">steps</span> : <span class="id" title="var">nat</span>) : <span class="id" title="var">parser</span> (<span class="id" title="var">list</span> <span class="id" title="var">T</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="var">many_helper</span> <span class="id" title="var">p</span> [] <span class="id" title="var">steps</span>.<br/>
</div>

<div class="doc">
A parser that expects a given token, followed by <span class="inlinecode"><span class="id" title="var">p</span></span>: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">firstExpect</span> {<span class="id" title="var">T</span>} (<span class="id" title="var">t</span> : <span class="id" title="var">token</span>) (<span class="id" title="var">p</span> : <span class="id" title="var">parser</span> <span class="id" title="var">T</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">parser</span> <span class="id" title="var">T</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <span class="id" title="var">xs</span> ⇒ <span class="id" title="keyword">match</span> <span class="id" title="var">xs</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" title="var">x</span>::<span class="id" title="var">xs'</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">string_dec</span> <span class="id" title="var">x</span> <span class="id" title="var">t</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">then</span> <span class="id" title="var">p</span> <span class="id" title="var">xs'</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span> <span class="id" title="var">NoneE</span> ("expected '" ++ <span class="id" title="var">t</span> ++ "'.")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [] ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">NoneE</span> ("expected '" ++ <span class="id" title="var">t</span> ++ "'.")<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
A parser that expects a particular token: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">expect</span> (<span class="id" title="var">t</span> : <span class="id" title="var">token</span>) : <span class="id" title="var">parser</span> <span class="id" title="var">unit</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="var">firstExpect</span> <span class="id" title="var">t</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">xs</span> ⇒ <span class="id" title="var">SomeE</span> (<span class="id" title="var">tt</span>, <span class="id" title="var">xs</span>)).<br/>
</div>

<div class="doc">
<a id="lab439"></a><h3 class="section">A Recursive-Descent Parser for Imp</h3>

<div class="paragraph"> </div>

 Identifiers: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">parseIdentifier</span> (<span class="id" title="var">xs</span> : <span class="id" title="var">list</span> <span class="id" title="var">token</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">optionE</span> (<span class="id" title="var">string</span> × <span class="id" title="var">list</span> <span class="id" title="var">token</span>) :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">xs</span> <span class="id" title="keyword">with</span><br/>
| [] ⇒ <span class="id" title="var">NoneE</span> "Expected identifier"<br/>
| <span class="id" title="var">x</span>::<span class="id" title="var">xs'</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">forallb</span> <span class="id" title="var">isLowerAlpha</span> (<span class="id" title="var">list_of_string</span> <span class="id" title="var">x</span>) <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SomeE</span> (<span class="id" title="var">x</span>, <span class="id" title="var">xs'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">NoneE</span> ("Illegal identifier:'" ++ <span class="id" title="var">x</span> ++ "'")<br/>
<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
Numbers: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <span class="id" title="var">parseNumber</span> (<span class="id" title="var">xs</span> : <span class="id" title="var">list</span> <span class="id" title="var">token</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">optionE</span> (<span class="id" title="var">nat</span> × <span class="id" title="var">list</span> <span class="id" title="var">token</span>) :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">xs</span> <span class="id" title="keyword">with</span><br/>
| [] ⇒ <span class="id" title="var">NoneE</span> "Expected number"<br/>
| <span class="id" title="var">x</span>::<span class="id" title="var">xs'</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> <span class="id" title="var">forallb</span> <span class="id" title="var">isDigit</span> (<span class="id" title="var">list_of_string</span> <span class="id" title="var">x</span>) <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SomeE</span> (<span class="id" title="var">fold_left</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="keyword">fun</span> <span class="id" title="var">n</span> <span class="id" title="var">d</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;10 × <span class="id" title="var">n</span> + (<span class="id" title="var">nat_of_ascii</span> <span class="id" title="var">d</span> -<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">nat_of_ascii</span> "0"%<span class="id" title="var">char</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">list_of_string</span> <span class="id" title="var">x</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;0,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xs'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">NoneE</span> "Expected number"<br/>
<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
Parse arithmetic expressions 
</div>
<div class="code">

<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">parsePrimaryExp</span> (<span class="id" title="var">steps</span>:<span class="id" title="var">nat</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">xs</span> : <span class="id" title="var">list</span> <span class="id" title="var">token</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" title="var">optionE</span> (<span class="id" title="var">aexp</span> × <span class="id" title="var">list</span> <span class="id" title="var">token</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">steps</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| 0 ⇒ <span class="id" title="var">NoneE</span> "Too many recursive calls"<br/>
&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">steps'</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">TRY</span> ' (<span class="id" title="var">i</span>, <span class="id" title="var">rest</span>) &lt;- <span class="id" title="var">parseIdentifier</span> <span class="id" title="var">xs</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SomeE</span> (<span class="id" title="var">AId</span> <span class="id" title="var">i</span>, <span class="id" title="var">rest</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">OR</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">TRY</span> ' (<span class="id" title="var">n</span>, <span class="id" title="var">rest</span>) &lt;- <span class="id" title="var">parseNumber</span> <span class="id" title="var">xs</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SomeE</span> (<span class="id" title="var">ANum</span> <span class="id" title="var">n</span>, <span class="id" title="var">rest</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">OR</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' (<span class="id" title="var">e</span>, <span class="id" title="var">rest</span>) &lt;- <span class="id" title="var">firstExpect</span> "(" (<span class="id" title="var">parseSumExp</span> <span class="id" title="var">steps'</span>) <span class="id" title="var">xs</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' (<span class="id" title="var">u</span>, <span class="id" title="var">rest'</span>) &lt;- <span class="id" title="var">expect</span> ")" <span class="id" title="var">rest</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SomeE</span> (<span class="id" title="var">e</span>,<span class="id" title="var">rest'</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
<br/>
<span class="id" title="keyword">with</span> <span class="id" title="var">parseProductExp</span> (<span class="id" title="var">steps</span>:<span class="id" title="var">nat</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">xs</span> : <span class="id" title="var">list</span> <span class="id" title="var">token</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">steps</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| 0 ⇒ <span class="id" title="var">NoneE</span> "Too many recursive calls"<br/>
&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">steps'</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;' (<span class="id" title="var">e</span>, <span class="id" title="var">rest</span>) &lt;- <span class="id" title="var">parsePrimaryExp</span> <span class="id" title="var">steps'</span> <span class="id" title="var">xs</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;' (<span class="id" title="var">es</span>, <span class="id" title="var">rest'</span>) &lt;- <span class="id" title="var">many</span> (<span class="id" title="var">firstExpect</span> "*" (<span class="id" title="var">parsePrimaryExp</span> <span class="id" title="var">steps'</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">steps'</span> <span class="id" title="var">rest</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SomeE</span> (<span class="id" title="var">fold_left</span> <span class="id" title="var">AMult</span> <span class="id" title="var">es</span> <span class="id" title="var">e</span>, <span class="id" title="var">rest'</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span><br/>
<br/>
<span class="id" title="keyword">with</span> <span class="id" title="var">parseSumExp</span> (<span class="id" title="var">steps</span>:<span class="id" title="var">nat</span>) (<span class="id" title="var">xs</span> : <span class="id" title="var">list</span> <span class="id" title="var">token</span>)  :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">steps</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| 0 ⇒ <span class="id" title="var">NoneE</span> "Too many recursive calls"<br/>
&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">steps'</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;' (<span class="id" title="var">e</span>, <span class="id" title="var">rest</span>) &lt;- <span class="id" title="var">parseProductExp</span> <span class="id" title="var">steps'</span> <span class="id" title="var">xs</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;' (<span class="id" title="var">es</span>, <span class="id" title="var">rest'</span>) &lt;-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">many</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">xs</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">TRY</span> ' (<span class="id" title="var">e</span>,<span class="id" title="var">rest'</span>) &lt;-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">firstExpect</span> "+"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">parseProductExp</span> <span class="id" title="var">steps'</span>) <span class="id" title="var">xs</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SomeE</span> ( (<span class="id" title="var">true</span>, <span class="id" title="var">e</span>), <span class="id" title="var">rest'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">OR</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' (<span class="id" title="var">e</span>, <span class="id" title="var">rest'</span>) &lt;-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">firstExpect</span> "-"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">parseProductExp</span> <span class="id" title="var">steps'</span>) <span class="id" title="var">xs</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SomeE</span> ( (<span class="id" title="var">false</span>, <span class="id" title="var">e</span>), <span class="id" title="var">rest'</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">steps'</span> <span class="id" title="var">rest</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SomeE</span> (<span class="id" title="var">fold_left</span> (<span class="id" title="keyword">fun</span> <span class="id" title="var">e<sub>0</sub></span> <span class="id" title="var">term</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">term</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" title="var">true</span>,  <span class="id" title="var">e</span>) ⇒ <span class="id" title="var">APlus</span> <span class="id" title="var">e<sub>0</sub></span> <span class="id" title="var">e</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| (<span class="id" title="var">false</span>, <span class="id" title="var">e</span>) ⇒ <span class="id" title="var">AMinus</span> <span class="id" title="var">e<sub>0</sub></span> <span class="id" title="var">e</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">es</span> <span class="id" title="var">e</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">rest'</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">parseAExp</span> := <span class="id" title="var">parseSumExp</span>.<br/>
</div>

<div class="doc">
Parsing boolean expressions: 
</div>
<div class="code">

<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">parseAtomicExp</span> (<span class="id" title="var">steps</span>:<span class="id" title="var">nat</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">xs</span> : <span class="id" title="var">list</span> <span class="id" title="var">token</span>)  :=<br/>
<span class="id" title="keyword">match</span> <span class="id" title="var">steps</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| 0 ⇒ <span class="id" title="var">NoneE</span> "Too many recursive calls"<br/>
&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">steps'</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">TRY</span> ' (<span class="id" title="var">u</span>,<span class="id" title="var">rest</span>) &lt;- <span class="id" title="var">expect</span> "true" <span class="id" title="var">xs</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SomeE</span> (<span class="id" title="var">BTrue</span>,<span class="id" title="var">rest</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">OR</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">TRY</span> ' (<span class="id" title="var">u</span>,<span class="id" title="var">rest</span>) &lt;- <span class="id" title="var">expect</span> "false" <span class="id" title="var">xs</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SomeE</span> (<span class="id" title="var">BFalse</span>,<span class="id" title="var">rest</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">OR</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">TRY</span> ' (<span class="id" title="var">e</span>,<span class="id" title="var">rest</span>) &lt;- <span class="id" title="var">firstExpect</span> "~"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">parseAtomicExp</span> <span class="id" title="var">steps'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xs</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SomeE</span> (<span class="id" title="var">BNot</span> <span class="id" title="var">e</span>, <span class="id" title="var">rest</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">OR</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">TRY</span> ' (<span class="id" title="var">e</span>,<span class="id" title="var">rest</span>) &lt;- <span class="id" title="var">firstExpect</span> "("<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">parseConjunctionExp</span> <span class="id" title="var">steps'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">xs</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' (<span class="id" title="var">u</span>,<span class="id" title="var">rest'</span>) &lt;- <span class="id" title="var">expect</span> ")" <span class="id" title="var">rest</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SomeE</span> (<span class="id" title="var">e</span>, <span class="id" title="var">rest'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">OR</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' (<span class="id" title="var">e</span>, <span class="id" title="var">rest</span>) &lt;- <span class="id" title="var">parseProductExp</span> <span class="id" title="var">steps'</span> <span class="id" title="var">xs</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">TRY</span> ' (<span class="id" title="var">e'</span>, <span class="id" title="var">rest'</span>) &lt;- <span class="id" title="var">firstExpect</span> "="<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">parseAExp</span> <span class="id" title="var">steps'</span>) <span class="id" title="var">rest</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SomeE</span> (<span class="id" title="var">BEq</span> <span class="id" title="var">e</span> <span class="id" title="var">e'</span>, <span class="id" title="var">rest'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">OR</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">TRY</span> ' (<span class="id" title="var">e'</span>, <span class="id" title="var">rest'</span>) &lt;- <span class="id" title="var">firstExpect</span> "&lt;="<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">parseAExp</span> <span class="id" title="var">steps'</span>) <span class="id" title="var">rest</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SomeE</span> (<span class="id" title="var">BLe</span> <span class="id" title="var">e</span> <span class="id" title="var">e'</span>, <span class="id" title="var">rest'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">OR</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">NoneE</span> "Expected '=' or '&lt;=' after arithmetic expression"<br/>
<span class="id" title="keyword">end</span><br/>
<br/>
<span class="id" title="keyword">with</span> <span class="id" title="var">parseConjunctionExp</span> (<span class="id" title="var">steps</span>:<span class="id" title="var">nat</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">xs</span> : <span class="id" title="var">list</span> <span class="id" title="var">token</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">steps</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| 0 ⇒ <span class="id" title="var">NoneE</span> "Too many recursive calls"<br/>
&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">steps'</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;' (<span class="id" title="var">e</span>, <span class="id" title="var">rest</span>) &lt;- <span class="id" title="var">parseAtomicExp</span> <span class="id" title="var">steps'</span> <span class="id" title="var">xs</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;' (<span class="id" title="var">es</span>, <span class="id" title="var">rest'</span>) &lt;- <span class="id" title="var">many</span> (<span class="id" title="var">firstExpect</span> "&amp;&amp;"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">parseAtomicExp</span> <span class="id" title="var">steps'</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">steps'</span> <span class="id" title="var">rest</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SomeE</span> (<span class="id" title="var">fold_left</span> <span class="id" title="var">BAnd</span> <span class="id" title="var">es</span> <span class="id" title="var">e</span>, <span class="id" title="var">rest'</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">parseBExp</span> := <span class="id" title="var">parseConjunctionExp</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Check</span> <span class="id" title="var">parseConjunctionExp</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">testParsing</span> {<span class="id" title="var">X</span> : <span class="id" title="keyword">Type</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">p</span> : <span class="id" title="var">nat</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">list</span> <span class="id" title="var">token</span> →<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">optionE</span> (<span class="id" title="var">X</span> × <span class="id" title="var">list</span> <span class="id" title="var">token</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">s</span> : <span class="id" title="var">string</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">t</span> := <span class="id" title="var">tokenize</span> <span class="id" title="var">s</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;<span class="id" title="var">p</span> 100 <span class="id" title="var">t</span>.<br/><hr class='doublespaceincode'/>
<span class="comment">(*<br/>
Eval&nbsp;compute&nbsp;in<br/>
&nbsp;&nbsp;testParsing&nbsp;parseProductExp&nbsp;"x.y.(x.x).x".<br/>
<br/>
Eval&nbsp;compute&nbsp;in<br/>
&nbsp;&nbsp;testParsing&nbsp;parseConjunctionExp&nbsp;"~(x=x&amp;&amp;x*x&lt;=(x*x)*x)&amp;&amp;x=x".<br/>
*)</span><br/>
</div>

<div class="doc">
Parsing commands: 
</div>
<div class="code">

<span class="id" title="keyword">Fixpoint</span> <span class="id" title="var">parseSimpleCommand</span> (<span class="id" title="var">steps</span>:<span class="id" title="var">nat</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">xs</span> : <span class="id" title="var">list</span> <span class="id" title="var">token</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">steps</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| 0 ⇒ <span class="id" title="var">NoneE</span> "Too many recursive calls"<br/>
&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">steps'</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">TRY</span> ' (<span class="id" title="var">u</span>, <span class="id" title="var">rest</span>) &lt;- <span class="id" title="var">expect</span> "skip" <span class="id" title="var">xs</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SomeE</span> (&lt;{<span class="id" title="var">skip</span>}&gt;, <span class="id" title="var">rest</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">OR</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">TRY</span> ' (<span class="id" title="var">e</span>,<span class="id" title="var">rest</span>) &lt;-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">firstExpect</span> "if"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">parseBExp</span> <span class="id" title="var">steps'</span>) <span class="id" title="var">xs</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' (<span class="id" title="var">c</span>,<span class="id" title="var">rest'</span>) &lt;-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">firstExpect</span> "then"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">parseSequencedCommand</span> <span class="id" title="var">steps'</span>) <span class="id" title="var">rest</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' (<span class="id" title="var">c'</span>,<span class="id" title="var">rest''</span>) &lt;-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">firstExpect</span> "else"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">parseSequencedCommand</span> <span class="id" title="var">steps'</span>) <span class="id" title="var">rest'</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' (<span class="id" title="var">tt</span>,<span class="id" title="var">rest'''</span>) &lt;-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">expect</span> "end" <span class="id" title="var">rest''</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SomeE</span>(&lt;{<span class="id" title="keyword">if</span> <span class="id" title="var">e</span> <span class="id" title="keyword">then</span> <span class="id" title="var">c</span> <span class="id" title="keyword">else</span> <span class="id" title="var">c'</span> <span class="id" title="keyword">end</span>}&gt;, <span class="id" title="var">rest'''</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">OR</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">TRY</span> ' (<span class="id" title="var">e</span>,<span class="id" title="var">rest</span>) &lt;-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">firstExpect</span> "while"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">parseBExp</span> <span class="id" title="var">steps'</span>) <span class="id" title="var">xs</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' (<span class="id" title="var">c</span>,<span class="id" title="var">rest'</span>) &lt;-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">firstExpect</span> "do"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">parseSequencedCommand</span> <span class="id" title="var">steps'</span>) <span class="id" title="var">rest</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' (<span class="id" title="var">u</span>,<span class="id" title="var">rest''</span>) &lt;-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">expect</span> "end" <span class="id" title="var">rest'</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SomeE</span>(&lt;{<span class="id" title="var">while</span> <span class="id" title="var">e</span> <span class="id" title="tactic">do</span> <span class="id" title="var">c</span> <span class="id" title="keyword">end</span>}&gt;, <span class="id" title="var">rest''</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">OR</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">TRY</span> ' (<span class="id" title="var">i</span>, <span class="id" title="var">rest</span>) &lt;- <span class="id" title="var">parseIdentifier</span> <span class="id" title="var">xs</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;' (<span class="id" title="var">e</span>, <span class="id" title="var">rest'</span>) &lt;- <span class="id" title="var">firstExpect</span> ":=" (<span class="id" title="var">parseAExp</span> <span class="id" title="var">steps'</span>) <span class="id" title="var">rest</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SomeE</span> (&lt;{<span class="id" title="var">i</span> := <span class="id" title="var">e</span>}&gt;, <span class="id" title="var">rest'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">OR</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">NoneE</span> "Expecting a command"<br/>
<span class="id" title="keyword">end</span><br/>
<br/>
<span class="id" title="keyword">with</span> <span class="id" title="var">parseSequencedCommand</span> (<span class="id" title="var">steps</span>:<span class="id" title="var">nat</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">xs</span> : <span class="id" title="var">list</span> <span class="id" title="var">token</span>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">steps</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| 0 ⇒ <span class="id" title="var">NoneE</span> "Too many recursive calls"<br/>
&nbsp;&nbsp;| <span class="id" title="var">S</span> <span class="id" title="var">steps'</span> ⇒<br/>
&nbsp;&nbsp;&nbsp;&nbsp;' (<span class="id" title="var">c</span>, <span class="id" title="var">rest</span>) &lt;- <span class="id" title="var">parseSimpleCommand</span> <span class="id" title="var">steps'</span> <span class="id" title="var">xs</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">TRY</span> ' (<span class="id" title="var">c'</span>, <span class="id" title="var">rest'</span>) &lt;-<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">firstExpect</span> ";"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" title="var">parseSequencedCommand</span> <span class="id" title="var">steps'</span>) <span class="id" title="var">rest</span> ;;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SomeE</span> (&lt;{<span class="id" title="var">c</span> ; <span class="id" title="var">c'</span>}&gt;, <span class="id" title="var">rest'</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">OR</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">SomeE</span> (<span class="id" title="var">c</span>, <span class="id" title="var">rest</span>)<br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">bignumber</span> := 1000.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <span class="id" title="var">parse</span> (<span class="id" title="var">str</span> : <span class="id" title="var">string</span>) : <span class="id" title="var">optionE</span> <span class="id" title="var">com</span> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">let</span> <span class="id" title="var">tokens</span> := <span class="id" title="var">tokenize</span> <span class="id" title="var">str</span> <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">match</span> <span class="id" title="var">parseSequencedCommand</span> <span class="id" title="var">bignumber</span> <span class="id" title="var">tokens</span> <span class="id" title="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">SomeE</span> (<span class="id" title="var">c</span>, []) ⇒ <span class="id" title="var">SomeE</span> <span class="id" title="var">c</span><br/>
&nbsp;&nbsp;| <span class="id" title="var">SomeE</span> (<span class="id" title="var">_</span>, <span class="id" title="var">t</span>::<span class="id" title="var">_</span>) ⇒ <span class="id" title="var">NoneE</span> ("Trailing tokens remaining: " ++ <span class="id" title="var">t</span>)<br/>
&nbsp;&nbsp;| <span class="id" title="var">NoneE</span> <span class="id" title="var">err</span> ⇒ <span class="id" title="var">NoneE</span> <span class="id" title="var">err</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">end</span>.<br/>
</div>

<div class="doc">
<a id="lab440"></a><h1 class="section">Examples</h1>

</div>
<div class="code">

<span class="id" title="keyword">Example</span> <span class="id" title="var">eg<sub>1</sub></span> : <span class="id" title="var">parse</span> "
  if x = y + 1 + 2 - y * 6 + 3 then
    x := x * 1;
    y := 0
  else
    skip
  end  "<br/>
=<br/>
&nbsp;&nbsp;<span class="id" title="var">SomeE</span> &lt;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> ("x" = ("y" + 1 + 2 - "y" × 6 + 3)) <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"x" := "x" × 1;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"y" := 0<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">skip</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span> }&gt;.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">cbv</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Example</span> <span class="id" title="var">eg<sub>2</sub></span> : <span class="id" title="var">parse</span> "
  skip;
  z:=x*y*(x*x);
  while x=x do
    if (z &lt;= z*z) &amp;&amp; ~(x = 2) then
      x := z;
      y := z
    else
      skip
    end;
    skip
  end;
  x:=z  "<br/>
=<br/>
&nbsp;&nbsp;<span class="id" title="var">SomeE</span> &lt;{<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">skip</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"z" := "x" × "y" × ("x" × "x");<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">while</span> ("x" = "x") <span class="id" title="tactic">do</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">if</span> ("z" ≤ "z" × "z") &amp;&amp; ~("x" = 2) <span class="id" title="keyword">then</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"x" := "z";<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"y" := "z"<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">else</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">skip</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">skip</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">end</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;"x" := "z" }&gt;.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">cbv</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>
</div>

<div id="footer">
<hr/><a href="coqindex.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>