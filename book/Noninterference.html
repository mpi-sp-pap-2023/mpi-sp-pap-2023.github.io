<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<link href="common/css/sf.css" rel="stylesheet" type="text/css" />
<title>Noninterference: Defining Secrecy and Secure Multi-Execution</title>
<link href="common/jquery-ui/jquery-ui.css" rel="stylesheet">
<script src="common/jquery-ui/external/jquery/jquery.js"></script>
<script src="common/jquery-ui/jquery-ui.js"></script>
<script src="common/toggleproofs.js"></script>
<link href="common/css/lf.css" rel="stylesheet" type="text/css"/>
</head>

<body>

<div id="page">

<div id="header">
<div id='logoinheader'><a href='https://softwarefoundations.cis.upenn.edu'>
<img src='common/media/image/sf_logo_sm.png' alt='Software Foundations Logo'></a></div>
<div class='booktitleinheader'><a href='index.html'>Volume 1: Logical Foundations</a></div>
<ul id='menu'>
   <li class='section_name'><a href='toc.html'>Table of Contents</a></li>
   <li class='section_name'><a href='coqindex.html'>Index</a></li>
   <li class='section_name'><a href='deps.html'>Roadmap</a></li>
</ul>
</div>

<div id="main">

<h1 class="libtitle">Noninterference<span class="subtitle">Defining Secrecy and Secure Multi-Execution</span></h1>


<div class="doc">

<div class="paragraph"> </div>

 Information flow control tries to prevent the leak of secret information to
    public outputs.

<div class="paragraph"> </div>

    But how does one formalize that a program doesn't leak secret information?

<div class="paragraph"> </div>

    We first investigate this question in the very simple setting of Coq
    functions taking two arguments, one we call the public input and the other
    one we call the secret input. Our functions return a pair containing one
    public output and one secret output. 
<div class="paragraph"> </div>

 Say we have the following function working on natural numbers: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="secure_f" class="idref" href="#secure_f"><span class="id" title="definition">secure_f</span></a> (<a id="pi:1" class="idref" href="#pi:1"><span class="id" title="binder">pi</span></a> <a id="si:2" class="idref" href="#si:2"><span class="id" title="binder">si</span></a> : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac<sub>4</sub>"><span class="id" title="notation">×</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> := <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Noninterference.html#pi:1"><span class="id" title="variable">pi</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a>1<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="Noninterference.html#pi:1"><span class="id" title="variable">pi</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a><a class="idref" href="Noninterference.html#si:2"><span class="id" title="variable">si</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#ea2ff3d561159081cea6fb2e8113cc<sub>54</sub>"><span class="id" title="notation">×</span></a>2<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>
</div>

<div class="doc">
This function seems intuitively secure, since the first output <span class="inlinecode"><span class="id" title="var">pi</span>+1</span>, which
    we assume to be public, only depends on the public input <span class="inlinecode"><span class="id" title="var">pi</span></span>, but not on
    the secret input <span class="inlinecode"><span class="id" title="var">si</span></span>. The second output <span class="inlinecode"><span class="id" title="var">pi</span>+<span class="id" title="var">si</span>*2</span> depends on both the
    public input and the secret input, but that's okay, since we assume this
    second output to be secret. Still, what security notion does this function
    satisfy? Let's try it on a couple of inputs: 
</div>
<div class="code">

<span class="id" title="keyword">Example</span> <a id="example1_secure_f" class="idref" href="#example1_secure_f"><span class="id" title="definition">example1_secure_f</span></a> : <a class="idref" href="Noninterference.html#secure_f"><span class="id" title="definition">secure_f</span></a> 0 0 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a>1<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a>0<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Example</span> <a id="example2_secure_f" class="idref" href="#example2_secure_f"><span class="id" title="definition">example2_secure_f</span></a> : <a class="idref" href="Noninterference.html#secure_f"><span class="id" title="definition">secure_f</span></a> 0 1 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a>1<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a>2<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Example</span> <a id="example3_secure_f" class="idref" href="#example3_secure_f"><span class="id" title="definition">example3_secure_f</span></a> : <a class="idref" href="Noninterference.html#secure_f"><span class="id" title="definition">secure_f</span></a> 1 2 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a>2<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a>5<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
In the last two cases the value of the public output is equal to the value
    of secret input. But that's just a coincidence, and has nothing to do with
    the public output leaking the secret input, which wasn't used in computing
    the public output.

<div class="paragraph"> </div>

    So a naive security definition, which we'll only use as a strawman, is one
    that simply compares secret inputs with public outputs: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="broken_security" class="idref" href="#broken_security"><span class="id" title="definition">broken_security</span></a> (<a id="f:3" class="idref" href="#f:3"><span class="id" title="binder">f</span></a> : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac<sub>4</sub>"><span class="id" title="notation">×</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="pi:4" class="idref" href="#pi:4"><span class="id" title="binder">pi</span></a> <a id="si:5" class="idref" href="#si:5"><span class="id" title="binder">si</span></a>, <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Noninterference.html#f:3"><span class="id" title="variable">f</span></a> <a class="idref" href="Noninterference.html#pi:4"><span class="id" title="variable">pi</span></a> <a class="idref" href="Noninterference.html#si:5"><span class="id" title="variable">si</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">≠</span></a> <a class="idref" href="Noninterference.html#si:5"><span class="id" title="variable">si</span></a>.<br/>
</div>

<div class="doc">
This definition would reject our secure function above as insecure: 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="broken_security_rejects_secure_f" class="idref" href="#broken_security_rejects_secure_f"><span class="id" title="lemma">broken_security_rejects_secure_f</span></a> : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">¬</span></a><a class="idref" href="Noninterference.html#broken_security"><span class="id" title="definition">broken_security</span></a> <a class="idref" href="Noninterference.html#secure_f"><span class="id" title="definition">secure_f</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Noninterference.html#broken_security"><span class="id" title="definition">broken_security</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">contra</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> (<span class="id" title="var">contra</span> 0 1). <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Even worse, this broken definition of security allows insecure functions,
    such as the following one whose public output is <span class="inlinecode"><span class="id" title="var">si</span>+1</span>: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="insecure_f" class="idref" href="#insecure_f"><span class="id" title="definition">insecure_f</span></a> (<a id="pi:6" class="idref" href="#pi:6"><span class="id" title="binder">pi</span></a> <a id="si:7" class="idref" href="#si:7"><span class="id" title="binder">si</span></a> : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a>) : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac<sub>4</sub>"><span class="id" title="notation">×</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#nat"><span class="id" title="inductive">nat</span></a> := <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Noninterference.html#si:7"><span class="id" title="variable">si</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a>1<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="Noninterference.html#pi:6"><span class="id" title="variable">pi</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a><a class="idref" href="Noninterference.html#si:7"><span class="id" title="variable">si</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#ea2ff3d561159081cea6fb2e8113cc<sub>54</sub>"><span class="id" title="notation">×</span></a>2<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>
</div>

<div class="doc">
This function's public output is never equal to its secret input, yet an
    attacker can easily compute one from the other by just subtracting <span class="inlinecode">1</span>. So
    the secret is entirely leaked, yet our broken definition accepts this: 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="broken_security_accepts_insecure_f" class="idref" href="#broken_security_accepts_insecure_f"><span class="id" title="lemma">broken_security_accepts_insecure_f</span></a> : <a class="idref" href="Noninterference.html#broken_security"><span class="id" title="definition">broken_security</span></a> <a class="idref" href="Noninterference.html#insecure_f"><span class="id" title="definition">insecure_f</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Noninterference.html#broken_security"><span class="id" title="definition">broken_security</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">pi</span> <span class="id" title="var">si</span>. <span class="id" title="tactic">induction</span> <span class="id" title="var">si</span> <span class="id" title="keyword">as</span> [| <span class="id" title="var">si'</span> <span class="id" title="var">IH</span>].<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">contra</span>. <span class="id" title="tactic">discriminate</span> <span class="id" title="var">contra</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> ×. <span class="id" title="tactic">intro</span> <span class="id" title="var">Hc</span>. <span class="id" title="tactic">injection</span> <span class="id" title="var">Hc</span> <span class="id" title="keyword">as</span> <span class="id" title="var">Hc</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">IH</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Hc</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
This attempt at defining secure information flow by looking at how inputs
    and outputs are related for a single execution of the program has failed.
    In fact, it is well known that secure information flow cannot be defined by
    looking at just one single program execution. 
<div class="paragraph"> </div>


<div class="paragraph"> </div>

 The usual way to define secure information flow is a property called
    <i>noninterference</i>, which in its most standard form looks at <i>two</i> program
    executions: for two different secret inputs the public outputs should not
    change: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="noninterferent" class="idref" href="#noninterferent"><span class="id" title="definition">noninterferent</span></a> {<a id="PI:8" class="idref" href="#PI:8"><span class="id" title="binder">PI</span></a> <a id="SI:9" class="idref" href="#SI:9"><span class="id" title="binder">SI</span></a> <a id="PO:10" class="idref" href="#PO:10"><span class="id" title="binder">PO</span></a> <a id="SO:11" class="idref" href="#SO:11"><span class="id" title="binder">SO</span></a> : <span class="id" title="keyword">Type</span>} (<a id="f:12" class="idref" href="#f:12"><span class="id" title="binder">f</span></a> : <a class="idref" href="Noninterference.html#PI:8"><span class="id" title="variable">PI</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Noninterference.html#SI:9"><span class="id" title="variable">SI</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Noninterference.html#PO:10"><span class="id" title="variable">PO</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac<sub>4</sub>"><span class="id" title="notation">×</span></a><a class="idref" href="Noninterference.html#SO:11"><span class="id" title="variable">SO</span></a>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<a id="pi:13" class="idref" href="#pi:13"><span class="id" title="binder">pi</span></a>:<a class="idref" href="Noninterference.html#PI:8"><span class="id" title="variable">PI</span></a>) (<a id="si<sub>1</sub>:14" class="idref" href="#si<sub>1</sub>:14"><span class="id" title="binder">si<sub>1</sub></span></a> <a id="si<sub>2</sub>:15" class="idref" href="#si<sub>2</sub>:15"><span class="id" title="binder">si<sub>2</sub></span></a>:<a class="idref" href="Noninterference.html#SI:9"><span class="id" title="variable">SI</span></a>), <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Noninterference.html#f:12"><span class="id" title="variable">f</span></a> <a class="idref" href="Noninterference.html#pi:13"><span class="id" title="variable">pi</span></a> <a class="idref" href="Noninterference.html#si<sub>1</sub>:14"><span class="id" title="variable">si<sub>1</sub></span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Noninterference.html#f:12"><span class="id" title="variable">f</span></a> <a class="idref" href="Noninterference.html#pi:13"><span class="id" title="variable">pi</span></a> <a class="idref" href="Noninterference.html#si<sub>2</sub>:15"><span class="id" title="variable">si<sub>2</sub></span></a>).<br/>
</div>

<div class="doc">
We defined this for arbitrary types of inputs and outputs, but we can still
    instantiate them to <span class="inlinecode"><span class="id" title="var">nat</span></span> when looking at our example functions above: 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="noninterferent_secure_f" class="idref" href="#noninterferent_secure_f"><span class="id" title="lemma">noninterferent_secure_f</span></a> : <a class="idref" href="Noninterference.html#noninterferent"><span class="id" title="definition">noninterferent</span></a> <a class="idref" href="Noninterference.html#secure_f"><span class="id" title="definition">secure_f</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Noninterference.html#noninterferent"><span class="id" title="definition">noninterferent</span></a>, <a class="idref" href="Noninterference.html#secure_f"><span class="id" title="definition">secure_f</span></a>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="interferent_insecure_f" class="idref" href="#interferent_insecure_f"><span class="id" title="lemma">interferent_insecure_f</span></a> : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">¬</span></a><a class="idref" href="Noninterference.html#noninterferent"><span class="id" title="definition">noninterferent</span></a> <a class="idref" href="Noninterference.html#insecure_f"><span class="id" title="definition">insecure_f</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Noninterference.html#noninterferent"><span class="id" title="definition">noninterferent</span></a>, <a class="idref" href="Noninterference.html#insecure_f"><span class="id" title="definition">insecure_f</span></a>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">contra</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H</span> : 0 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> 1 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> 1 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> 1). {<span class="id" title="tactic">apply</span> (<span class="id" title="var">contra</span> 42). }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">discriminate</span> <span class="id" title="var">H</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
In the definition of noninterference we pass the same public inputs to the
    two executions, since this allows public outputs to depend on public
    inputs. To convince ourselves of this, let's look at the following too
    strong definition of security: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="too_strong_security" class="idref" href="#too_strong_security"><span class="id" title="definition">too_strong_security</span></a> {<a id="PI:16" class="idref" href="#PI:16"><span class="id" title="binder">PI</span></a> <a id="SI:17" class="idref" href="#SI:17"><span class="id" title="binder">SI</span></a> <a id="PO:18" class="idref" href="#PO:18"><span class="id" title="binder">PO</span></a> <a id="SO:19" class="idref" href="#SO:19"><span class="id" title="binder">SO</span></a> : <span class="id" title="keyword">Type</span>} (<a id="f:20" class="idref" href="#f:20"><span class="id" title="binder">f</span></a> : <a class="idref" href="Noninterference.html#PI:16"><span class="id" title="variable">PI</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Noninterference.html#SI:17"><span class="id" title="variable">SI</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Noninterference.html#PO:18"><span class="id" title="variable">PO</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac<sub>4</sub>"><span class="id" title="notation">×</span></a><a class="idref" href="Noninterference.html#SO:19"><span class="id" title="variable">SO</span></a>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> (<a id="x<sub>1</sub>:21" class="idref" href="#x<sub>1</sub>:21"><span class="id" title="binder">x<sub>1</sub></span></a> <a id="x<sub>2</sub>:22" class="idref" href="#x<sub>2</sub>:22"><span class="id" title="binder">x<sub>2</sub></span></a>:<a class="idref" href="Noninterference.html#PI:16"><span class="id" title="variable">PI</span></a>) (<a id="y<sub>1</sub>:23" class="idref" href="#y<sub>1</sub>:23"><span class="id" title="binder">y<sub>1</sub></span></a> <a id="y<sub>2</sub>:24" class="idref" href="#y<sub>2</sub>:24"><span class="id" title="binder">y<sub>2</sub></span></a>:<a class="idref" href="Noninterference.html#SI:17"><span class="id" title="variable">SI</span></a>), <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Noninterference.html#f:20"><span class="id" title="variable">f</span></a> <a class="idref" href="Noninterference.html#x<sub>1</sub>:21"><span class="id" title="variable">x<sub>1</sub></span></a> <a class="idref" href="Noninterference.html#y<sub>1</sub>:23"><span class="id" title="variable">y<sub>1</sub></span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Noninterference.html#f:20"><span class="id" title="variable">f</span></a> <a class="idref" href="Noninterference.html#x<sub>2</sub>:22"><span class="id" title="variable">x<sub>2</sub></span></a> <a class="idref" href="Noninterference.html#y<sub>2</sub>:24"><span class="id" title="variable">y<sub>2</sub></span></a>).<br/>
</div>

<div class="doc">
This basically says that the first output of <span class="inlinecode"><span class="id" title="var">f</span></span> has to be constant, which
    is not the case for our <span class="inlinecode"><span class="id" title="var">secure_f</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="secure_f_rejected_again" class="idref" href="#secure_f_rejected_again"><span class="id" title="lemma">secure_f_rejected_again</span></a> : <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">¬</span></a><a class="idref" href="Noninterference.html#too_strong_security"><span class="id" title="definition">too_strong_security</span></a> <a class="idref" href="Noninterference.html#secure_f"><span class="id" title="definition">secure_f</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Noninterference.html#too_strong_security"><span class="id" title="definition">too_strong_security</span></a>, <a class="idref" href="Noninterference.html#secure_f"><span class="id" title="definition">secure_f</span></a>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">contra</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H</span> : 0 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> 1 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> 1 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Peano.html#0dacc1786c5ba797d47dd85006231633"><span class="id" title="notation">+</span></a> 1). { <span class="id" title="tactic">apply</span> (<span class="id" title="var">contra</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> 42 43). }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">discriminate</span> <span class="id" title="var">H</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Noninterference is still a very strong property. In particular, <span class="inlinecode"><span class="id" title="var">f</span></span> being
    noninterferent is equivalent to <span class="inlinecode"><span class="id" title="var">f</span></span> being splittable into two different
    functions, one of which doesn't get the secret at all. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="splittable" class="idref" href="#splittable"><span class="id" title="definition">splittable</span></a> {<a id="PI:25" class="idref" href="#PI:25"><span class="id" title="binder">PI</span></a> <a id="SI:26" class="idref" href="#SI:26"><span class="id" title="binder">SI</span></a> <a id="PO:27" class="idref" href="#PO:27"><span class="id" title="binder">PO</span></a> <a id="SO:28" class="idref" href="#SO:28"><span class="id" title="binder">SO</span></a> : <span class="id" title="keyword">Type</span>} (<a id="f:29" class="idref" href="#f:29"><span class="id" title="binder">f</span></a> : <a class="idref" href="Noninterference.html#PI:25"><span class="id" title="variable">PI</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Noninterference.html#SI:26"><span class="id" title="variable">SI</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Noninterference.html#PO:27"><span class="id" title="variable">PO</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac<sub>4</sub>"><span class="id" title="notation">×</span></a><a class="idref" href="Noninterference.html#SO:28"><span class="id" title="variable">SO</span></a>) :=<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">∃</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">(</span></a><a id="pf:30" class="idref" href="#pf:30"><span class="id" title="binder">pf</span></a> : <a class="idref" href="Noninterference.html#PI:25"><span class="id" title="variable">PI</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Noninterference.html#PO:27"><span class="id" title="variable">PO</span></a>) (<a id="sf:31" class="idref" href="#sf:31"><span class="id" title="binder">sf</span></a>:<a class="idref" href="Noninterference.html#PI:25"><span class="id" title="variable">PI</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Noninterference.html#SI:26"><span class="id" title="variable">SI</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Noninterference.html#SO:28"><span class="id" title="variable">SO</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">),</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="x:32" class="idref" href="#x:32"><span class="id" title="binder">x</span></a> <a id="y:33" class="idref" href="#y:33"><span class="id" title="binder">y</span></a>, <a class="idref" href="Noninterference.html#f:29"><span class="id" title="variable">f</span></a> <a class="idref" href="Noninterference.html#x:32"><span class="id" title="variable">x</span></a> <a class="idref" href="Noninterference.html#y:33"><span class="id" title="variable">y</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Noninterference.html#pf:30"><span class="id" title="variable">pf</span></a> <a class="idref" href="Noninterference.html#x:32"><span class="id" title="variable">x</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="Noninterference.html#sf:31"><span class="id" title="variable">sf</span></a> <a class="idref" href="Noninterference.html#x:32"><span class="id" title="variable">x</span></a> <a class="idref" href="Noninterference.html#y:33"><span class="id" title="variable">y</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Theorem</span> <a id="splittable_noninterferent" class="idref" href="#splittable_noninterferent"><span class="id" title="lemma">splittable_noninterferent</span></a> : <span class="id" title="keyword">∀</span> <a id="PI:34" class="idref" href="#PI:34"><span class="id" title="binder">PI</span></a> <a id="SI:35" class="idref" href="#SI:35"><span class="id" title="binder">SI</span></a> <a id="PO:36" class="idref" href="#PO:36"><span class="id" title="binder">PO</span></a> <a id="SO:37" class="idref" href="#SO:37"><span class="id" title="binder">SO</span></a> : <span class="id" title="keyword">Type</span>,<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="f:38" class="idref" href="#f:38"><span class="id" title="binder">f</span></a> : <a class="idref" href="Noninterference.html#PI:34"><span class="id" title="variable">PI</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Noninterference.html#SI:35"><span class="id" title="variable">SI</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Noninterference.html#PO:36"><span class="id" title="variable">PO</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac<sub>4</sub>"><span class="id" title="notation">×</span></a><a class="idref" href="Noninterference.html#SO:37"><span class="id" title="variable">SO</span></a>, <a class="idref" href="Noninterference.html#splittable"><span class="id" title="definition">splittable</span></a> <a class="idref" href="Noninterference.html#f:38"><span class="id" title="variable">f</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Noninterference.html#noninterferent"><span class="id" title="definition">noninterferent</span></a> <a class="idref" href="Noninterference.html#f:38"><span class="id" title="variable">f</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Noninterference.html#splittable"><span class="id" title="definition">splittable</span></a>, <a class="idref" href="Noninterference.html#noninterferent"><span class="id" title="definition">noninterferent</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">PI</span> <span class="id" title="var">SI</span> <span class="id" title="var">PO</span> <span class="id" title="var">SO</span> <span class="id" title="var">f</span> [<span class="id" title="var">pf</span> [<span class="id" title="var">sf</span> <span class="id" title="var">H</span>]] <span class="id" title="var">x</span> <span class="id" title="var">y<sub>1</sub></span> <span class="id" title="var">y<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Theorem</span> <a id="noninterferent_splittable" class="idref" href="#noninterferent_splittable"><span class="id" title="lemma">noninterferent_splittable</span></a> : <span class="id" title="keyword">∀</span> <a id="PI:39" class="idref" href="#PI:39"><span class="id" title="binder">PI</span></a> <a id="SI:40" class="idref" href="#SI:40"><span class="id" title="binder">SI</span></a> <a id="PO:41" class="idref" href="#PO:41"><span class="id" title="binder">PO</span></a> <a id="SO:42" class="idref" href="#SO:42"><span class="id" title="binder">SO</span></a> : <span class="id" title="keyword">Type</span>,<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="some_si:43" class="idref" href="#some_si:43"><span class="id" title="binder">some_si</span></a> : <a class="idref" href="Noninterference.html#SI:40"><span class="id" title="variable">SI</span></a>, <span class="comment">(*&nbsp;we&nbsp;require&nbsp;SI&nbsp;to&nbsp;be&nbsp;an&nbsp;inhabited&nbsp;type!&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="f:44" class="idref" href="#f:44"><span class="id" title="binder">f</span></a> : <a class="idref" href="Noninterference.html#PI:39"><span class="id" title="variable">PI</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Noninterference.html#SI:40"><span class="id" title="variable">SI</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Noninterference.html#PO:41"><span class="id" title="variable">PO</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac<sub>4</sub>"><span class="id" title="notation">×</span></a><a class="idref" href="Noninterference.html#SO:42"><span class="id" title="variable">SO</span></a>, <a class="idref" href="Noninterference.html#noninterferent"><span class="id" title="definition">noninterferent</span></a> <a class="idref" href="Noninterference.html#f:44"><span class="id" title="variable">f</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Noninterference.html#splittable"><span class="id" title="definition">splittable</span></a> <a class="idref" href="Noninterference.html#f:44"><span class="id" title="variable">f</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Noninterference.html#splittable"><span class="id" title="definition">splittable</span></a>, <a class="idref" href="Noninterference.html#noninterferent"><span class="id" title="definition">noninterferent</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">PI</span> <span class="id" title="var">SI</span> <span class="id" title="var">PO</span> <span class="id" title="var">SO</span> <span class="id" title="var">some_si</span> <span class="id" title="var">f</span> <span class="id" title="var">Hni</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;we&nbsp;pass&nbsp;the&nbsp;SI&nbsp;inhabitant&nbsp;as&nbsp;a&nbsp;dummy&nbsp;secret&nbsp;value!&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">∃</span> (<span class="id" title="keyword">fun</span> <a id="x:46" class="idref" href="#x:46"><span class="id" title="binder">x</span></a> ⇒ <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<span class="id" title="var">f</span> <a class="idref" href="Noninterference.html#x:45"><span class="id" title="variable">x</span></a> <span class="id" title="var">some_si</span>)).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">∃</span> (<span class="id" title="keyword">fun</span> <a id="x:49" class="idref" href="#x:49"><span class="id" title="binder">x</span></a> <a id="y:50" class="idref" href="#y:50"><span class="id" title="binder">y</span></a> ⇒ <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> (<span class="id" title="var">f</span> <a class="idref" href="Noninterference.html#x:47"><span class="id" title="variable">x</span></a> <a class="idref" href="Noninterference.html#y:48"><span class="id" title="variable">y</span></a>)).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>. <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">Hni</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">y</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">f</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">x'</span> <span class="id" title="var">y'</span>]. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab429"></a><h2 class="section">Secure Multi-Execution (SME)</h2>

<div class="paragraph"> </div>

 The previous proof also captures the key idea behind Secure Multi-Execution
    (SME), an enforcement mechanism that can make <i>any</i> function
    noninterferent. To achieve this SME runs the function twice, once passing a
    dummy secret as input to obtain the public output, and once using the real
    secrets to obtain the secret output. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="sme" class="idref" href="#sme"><span class="id" title="definition">sme</span></a> {<a id="PI:51" class="idref" href="#PI:51"><span class="id" title="binder">PI</span></a> <a id="SI:52" class="idref" href="#SI:52"><span class="id" title="binder">SI</span></a> <a id="PO:53" class="idref" href="#PO:53"><span class="id" title="binder">PO</span></a> <a id="SO:54" class="idref" href="#SO:54"><span class="id" title="binder">SO</span></a> : <span class="id" title="keyword">Type</span>} (<a id="some_si:55" class="idref" href="#some_si:55"><span class="id" title="binder">some_si</span></a> : <a class="idref" href="Noninterference.html#SI:52"><span class="id" title="variable">SI</span></a>)<br/>
&nbsp;&nbsp;(<a id="f:56" class="idref" href="#f:56"><span class="id" title="binder">f</span></a> : <a class="idref" href="Noninterference.html#PI:51"><span class="id" title="variable">PI</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Noninterference.html#SI:52"><span class="id" title="variable">SI</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Noninterference.html#PO:53"><span class="id" title="variable">PO</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac<sub>4</sub>"><span class="id" title="notation">×</span></a><a class="idref" href="Noninterference.html#SO:54"><span class="id" title="variable">SO</span></a>) <a id="x:57" class="idref" href="#x:57"><span class="id" title="binder">x</span></a> <a id="y:58" class="idref" href="#y:58"><span class="id" title="binder">y</span></a> :=<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Noninterference.html#f:56"><span class="id" title="variable">f</span></a> <a class="idref" href="Noninterference.html#x:57"><span class="id" title="variable">x</span></a> <a class="idref" href="Noninterference.html#some_si:55"><span class="id" title="variable">some_si</span></a>)<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#snd"><span class="id" title="definition">snd</span></a> (<a class="idref" href="Noninterference.html#f:56"><span class="id" title="variable">f</span></a> <a class="idref" href="Noninterference.html#x:57"><span class="id" title="variable">x</span></a> <a class="idref" href="Noninterference.html#y:58"><span class="id" title="variable">y</span></a>)<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>
</div>

<div class="doc">
Functions protected by <span class="inlinecode"><span class="id" title="var">sme</span></span> are guaranteed to satisfy noninterference: 
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <a id="noninterferent_sme" class="idref" href="#noninterferent_sme"><span class="id" title="lemma">noninterferent_sme</span></a> :  <span class="id" title="keyword">∀</span> <a id="PI:59" class="idref" href="#PI:59"><span class="id" title="binder">PI</span></a> <a id="SI:60" class="idref" href="#SI:60"><span class="id" title="binder">SI</span></a> <a id="PO:61" class="idref" href="#PO:61"><span class="id" title="binder">PO</span></a> <a id="SO:62" class="idref" href="#SO:62"><span class="id" title="binder">SO</span></a> : <span class="id" title="keyword">Type</span>,<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="some_si:63" class="idref" href="#some_si:63"><span class="id" title="binder">some_si</span></a> : <a class="idref" href="Noninterference.html#SI:60"><span class="id" title="variable">SI</span></a>,<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="f:64" class="idref" href="#f:64"><span class="id" title="binder">f</span></a> : <a class="idref" href="Noninterference.html#PI:59"><span class="id" title="variable">PI</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Noninterference.html#SI:60"><span class="id" title="variable">SI</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Noninterference.html#PO:61"><span class="id" title="variable">PO</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac<sub>4</sub>"><span class="id" title="notation">×</span></a><a class="idref" href="Noninterference.html#SO:62"><span class="id" title="variable">SO</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Noninterference.html#noninterferent"><span class="id" title="definition">noninterferent</span></a> (<a class="idref" href="Noninterference.html#sme"><span class="id" title="definition">sme</span></a> <a class="idref" href="Noninterference.html#some_si:63"><span class="id" title="variable">some_si</span></a> <a class="idref" href="Noninterference.html#f:64"><span class="id" title="variable">f</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">PI</span> <span class="id" title="var">SI</span> <span class="id" title="var">PO</span> <span class="id" title="var">SO</span> <span class="id" title="var">some_si</span> <span class="id" title="var">f</span> <span class="id" title="var">x</span> <span class="id" title="var">y<sub>1</sub></span> <span class="id" title="var">y<sub>2</sub></span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Moreover, if the function we pass to <span class="inlinecode"><span class="id" title="var">sme</span></span> is already noninterferent,
    then its behavior will not change; so we say that <span class="inlinecode"><span class="id" title="var">sme</span></span> is a <i>transparent</i>
    enforcement mechanism for noninterference: 
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <a id="transparent_sme" class="idref" href="#transparent_sme"><span class="id" title="lemma">transparent_sme</span></a> : <span class="id" title="keyword">∀</span> <a id="PI:65" class="idref" href="#PI:65"><span class="id" title="binder">PI</span></a> <a id="SI:66" class="idref" href="#SI:66"><span class="id" title="binder">SI</span></a> <a id="PO:67" class="idref" href="#PO:67"><span class="id" title="binder">PO</span></a> <a id="SO:68" class="idref" href="#SO:68"><span class="id" title="binder">SO</span></a> : <span class="id" title="keyword">Type</span>,<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="some_si:69" class="idref" href="#some_si:69"><span class="id" title="binder">some_si</span></a> : <a class="idref" href="Noninterference.html#SI:66"><span class="id" title="variable">SI</span></a>,<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="f:70" class="idref" href="#f:70"><span class="id" title="binder">f</span></a> : <a class="idref" href="Noninterference.html#PI:65"><span class="id" title="variable">PI</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Noninterference.html#SI:66"><span class="id" title="variable">SI</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Noninterference.html#PO:67"><span class="id" title="variable">PO</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#11c698c8685bb8ab1cf725545c085ac<sub>4</sub>"><span class="id" title="notation">×</span></a><a class="idref" href="Noninterference.html#SO:68"><span class="id" title="variable">SO</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Noninterference.html#noninterferent"><span class="id" title="definition">noninterferent</span></a> <a class="idref" href="Noninterference.html#f:70"><span class="id" title="variable">f</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">∀</span> <a id="x:71" class="idref" href="#x:71"><span class="id" title="binder">x</span></a> <a id="y:72" class="idref" href="#y:72"><span class="id" title="binder">y</span></a>, <a class="idref" href="Noninterference.html#f:70"><span class="id" title="variable">f</span></a> <a class="idref" href="Noninterference.html#x:71"><span class="id" title="variable">x</span></a> <a class="idref" href="Noninterference.html#y:72"><span class="id" title="variable">y</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Noninterference.html#sme"><span class="id" title="definition">sme</span></a> <a class="idref" href="Noninterference.html#some_si:69"><span class="id" title="variable">some_si</span></a> <a class="idref" href="Noninterference.html#f:70"><span class="id" title="variable">f</span></a> <a class="idref" href="Noninterference.html#x:71"><span class="id" title="variable">x</span></a> <a class="idref" href="Noninterference.html#y:72"><span class="id" title="variable">y</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Noninterference.html#noninterferent"><span class="id" title="definition">noninterferent</span></a>, <a class="idref" href="Noninterference.html#sme"><span class="id" title="definition">sme</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">PI</span> <span class="id" title="var">SI</span> <span class="id" title="var">PO</span> <span class="id" title="var">SP</span> <span class="id" title="var">some_si</span> <span class="id" title="var">f</span> <span class="id" title="var">Hni</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">Hni</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">y</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">f</span> <span class="id" title="var">x</span> <span class="id" title="var">y</span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">x'</span> <span class="id" title="var">y'</span>]. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
It is interesting to look at what <span class="inlinecode"><span class="id" title="var">sme</span></span> does for interferent functions,
    like <span class="inlinecode"><span class="id" title="var">insecure_f</span></span>, whose public output was one plus its secret input: 
</div>
<div class="code">

<span class="id" title="keyword">Example</span> <a id="example1_sme_insecure_f" class="idref" href="#example1_sme_insecure_f"><span class="id" title="definition">example1_sme_insecure_f</span></a>: <a class="idref" href="Noninterference.html#sme"><span class="id" title="definition">sme</span></a> 0 <a class="idref" href="Noninterference.html#insecure_f"><span class="id" title="definition">insecure_f</span></a> 0 0 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a>1<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> 0<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Example</span> <a id="example2_sme_insecure_f" class="idref" href="#example2_sme_insecure_f"><span class="id" title="definition">example2_sme_insecure_f</span></a>: <a class="idref" href="Noninterference.html#sme"><span class="id" title="definition">sme</span></a> 0 <a class="idref" href="Noninterference.html#insecure_f"><span class="id" title="definition">insecure_f</span></a> 0 1 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a>1<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> 2<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Example</span> <a id="example3_sme_insecure_f" class="idref" href="#example3_sme_insecure_f"><span class="id" title="definition">example3_sme_insecure_f</span></a>: <a class="idref" href="Noninterference.html#sme"><span class="id" title="definition">sme</span></a> 0 <a class="idref" href="Noninterference.html#insecure_f"><span class="id" title="definition">insecure_f</span></a> 1 1 <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a>1<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> 3<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Now the public output is one plus the dummy constant <span class="inlinecode">0</span> we passed to the
   <span class="inlinecode"><span class="id" title="var">sme</span></span> function, so always the constant <span class="inlinecode">1</span>. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="constant_sme_insecure_f" class="idref" href="#constant_sme_insecure_f"><span class="id" title="lemma">constant_sme_insecure_f</span></a>: <span class="id" title="keyword">∀</span> <a id="pi:73" class="idref" href="#pi:73"><span class="id" title="binder">pi</span></a> <a id="si:74" class="idref" href="#si:74"><span class="id" title="binder">si</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#fst"><span class="id" title="definition">fst</span></a> (<a class="idref" href="Noninterference.html#sme"><span class="id" title="definition">sme</span></a> 0 <a class="idref" href="Noninterference.html#insecure_f"><span class="id" title="definition">insecure_f</span></a> <a class="idref" href="Noninterference.html#pi:73"><span class="id" title="variable">pi</span></a> <a class="idref" href="Noninterference.html#si:74"><span class="id" title="variable">si</span></a>) <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> 1.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
This is a secure behavior, but a behavior that's different than that of the
    original <span class="inlinecode"><span class="id" title="var">insecure_f</span></span> function. So we are giving up some correctness for
    security. There is no free lunch! 
<div class="paragraph"> </div>

 The other downside of <span class="inlinecode"><span class="id" title="var">sme</span></span> is that we have to run the function twice for
    our two security levels, public and secret. In general, we need to run the
    program as many times as we have security levels, which is often an
    exponential number, say if we take our security levels to be sets of
    principals. Other information flow control mechanisms overcome this
    downside, but have other downsides, for instance by using static
    overapproximations that reject some secure programs, or dynamic
    overapproximations that unnecessarily change program behavior, for instance
    stopping even some secure to prevent leaks (in which case they are not
    transparent). Again, there is no free lunch! 
<div class="paragraph"> </div>

<a id="lab430"></a><h2 class="section">State transformers</h2>

<div class="paragraph"> </div>

 This development is easy to adapt to functions that transform states
    (<span class="inlinecode"><span class="id" title="var">state</span>→<span class="id" title="var">state</span></span>), where we label each variable as public or secret. 
</div>
<div class="code">

<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Bool.Bool.html#"><span class="id" title="library">Bool.Bool</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Nat.html#"><span class="id" title="library">Init.Nat</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Arith.Arith.html#"><span class="id" title="library">Arith.Arith</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">Coq</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Arith.EqNat.html#"><span class="id" title="library">Arith.EqNat</span></a>. <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Arith.PeanoNat.html#Nat"><span class="id" title="module">Nat</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">LF</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="Maps.html#"><span class="id" title="library">Maps</span></a>.<br/>
<span class="id" title="keyword">From</span> <span class="id" title="var">LF</span> <span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="Imp.html#"><span class="id" title="library">Imp</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Print</span> <a class="idref" href="Imp.html#state"><span class="id" title="definition">state</span></a>. <span class="comment">(*&nbsp;state&nbsp;=&nbsp;total_map&nbsp;nat&nbsp;*)</span><br/>
<span class="id" title="keyword">Definition</span> <a id="pub_map" class="idref" href="#pub_map"><span class="id" title="definition">pub_map</span></a> := <a class="idref" href="Maps.html#total_map"><span class="id" title="definition">total_map</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <a id="pub_equiv" class="idref" href="#pub_equiv"><span class="id" title="definition">pub_equiv</span></a> (<a id="pub:75" class="idref" href="#pub:75"><span class="id" title="binder">pub</span></a> : <a class="idref" href="Noninterference.html#pub_map"><span class="id" title="definition">pub_map</span></a>) (<a id="s<sub>1</sub>:76" class="idref" href="#s<sub>1</sub>:76"><span class="id" title="binder">s<sub>1</sub></span></a> <a id="s<sub>2</sub>:77" class="idref" href="#s<sub>2</sub>:77"><span class="id" title="binder">s<sub>2</sub></span></a> : <a class="idref" href="Imp.html#state"><span class="id" title="definition">state</span></a>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="x:78" class="idref" href="#x:78"><span class="id" title="binder">x</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a>, <a class="idref" href="Noninterference.html#pub:75"><span class="id" title="variable">pub</span></a> <a class="idref" href="Noninterference.html#x:78"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Imp.html#:::'true'"><span class="id" title="notation">true</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Noninterference.html#s<sub>1</sub>:76"><span class="id" title="variable">s<sub>1</sub></span></a> <a class="idref" href="Noninterference.html#x:78"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Noninterference.html#s<sub>2</sub>:77"><span class="id" title="variable">s<sub>2</sub></span></a> <a class="idref" href="Noninterference.html#x:78"><span class="id" title="variable">x</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <a id="noninterferent_state" class="idref" href="#noninterferent_state"><span class="id" title="definition">noninterferent_state</span></a> (<a id="pub:79" class="idref" href="#pub:79"><span class="id" title="binder">pub</span></a> : <a class="idref" href="Noninterference.html#pub_map"><span class="id" title="definition">pub_map</span></a>) (<a id="f:80" class="idref" href="#f:80"><span class="id" title="binder">f</span></a> : <a class="idref" href="Imp.html#state"><span class="id" title="definition">state</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Imp.html#state"><span class="id" title="definition">state</span></a>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="s<sub>1</sub>:81" class="idref" href="#s<sub>1</sub>:81"><span class="id" title="binder">s<sub>1</sub></span></a> <a id="s<sub>2</sub>:82" class="idref" href="#s<sub>2</sub>:82"><span class="id" title="binder">s<sub>2</sub></span></a>, <a class="idref" href="Noninterference.html#pub_equiv"><span class="id" title="definition">pub_equiv</span></a> <a class="idref" href="Noninterference.html#pub:79"><span class="id" title="variable">pub</span></a> <a class="idref" href="Noninterference.html#s<sub>1</sub>:81"><span class="id" title="variable">s<sub>1</sub></span></a> <a class="idref" href="Noninterference.html#s<sub>2</sub>:82"><span class="id" title="variable">s<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Noninterference.html#pub_equiv"><span class="id" title="definition">pub_equiv</span></a> <a class="idref" href="Noninterference.html#pub:79"><span class="id" title="variable">pub</span></a> (<a class="idref" href="Noninterference.html#f:80"><span class="id" title="variable">f</span></a> <a class="idref" href="Noninterference.html#s<sub>1</sub>:81"><span class="id" title="variable">s<sub>1</sub></span></a>) (<a class="idref" href="Noninterference.html#f:80"><span class="id" title="variable">f</span></a> <a class="idref" href="Noninterference.html#s<sub>2</sub>:82"><span class="id" title="variable">s<sub>2</sub></span></a>).<br/>
</div>

<div class="doc">
We can prove an equivalence between noninterferent_state and our original
    noninterferent definition. For this we need to split and merge states,
    and a few helper lemmas. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="split_state" class="idref" href="#split_state"><span class="id" title="definition">split_state</span></a> (<a id="s:83" class="idref" href="#s:83"><span class="id" title="binder">s</span></a>:<a class="idref" href="Imp.html#state"><span class="id" title="definition">state</span></a>) (<a id="pub:84" class="idref" href="#pub:84"><span class="id" title="binder">pub</span></a>:<a class="idref" href="Noninterference.html#pub_map"><span class="id" title="definition">pub_map</span></a>) (<a id="b:85" class="idref" href="#b:85"><span class="id" title="binder">b</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#bool"><span class="id" title="inductive">bool</span></a>) : <a class="idref" href="Imp.html#state"><span class="id" title="definition">state</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="x:86" class="idref" href="#x:86"><span class="id" title="binder">x</span></a> : <a class="idref" href="http://coq.inria.fr/library//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a> ⇒ <span class="id" title="keyword">if</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Bool.Bool.html#eqb"><span class="id" title="definition">Bool.eqb</span></a> (<a class="idref" href="Noninterference.html#pub:84"><span class="id" title="variable">pub</span></a> <a class="idref" href="Noninterference.html#x:86"><span class="id" title="variable">x</span></a>) <a class="idref" href="Noninterference.html#b:85"><span class="id" title="variable">b</span></a> <span class="id" title="keyword">then</span> <a class="idref" href="Noninterference.html#s:83"><span class="id" title="variable">s</span></a> <a class="idref" href="Noninterference.html#x:86"><span class="id" title="variable">x</span></a> <span class="id" title="keyword">else</span> 0.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <a id="merge_states" class="idref" href="#merge_states"><span class="id" title="definition">merge_states</span></a> (<a id="s<sub>1</sub>:87" class="idref" href="#s<sub>1</sub>:87"><span class="id" title="binder">s<sub>1</sub></span></a> <a id="s<sub>2</sub>:88" class="idref" href="#s<sub>2</sub>:88"><span class="id" title="binder">s<sub>2</sub></span></a>:<a class="idref" href="Imp.html#state"><span class="id" title="definition">state</span></a>) (<a id="pub:89" class="idref" href="#pub:89"><span class="id" title="binder">pub</span></a>:<a class="idref" href="Noninterference.html#pub_map"><span class="id" title="definition">pub_map</span></a>) : <a class="idref" href="Imp.html#state"><span class="id" title="definition">state</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="x:90" class="idref" href="#x:90"><span class="id" title="binder">x</span></a> : <a class="idref" href="http://coq.inria.fr/library//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a> ⇒ <span class="id" title="keyword">if</span> <a class="idref" href="Noninterference.html#pub:89"><span class="id" title="variable">pub</span></a> <a class="idref" href="Noninterference.html#x:90"><span class="id" title="variable">x</span></a> <span class="id" title="keyword">then</span> <a class="idref" href="Noninterference.html#s<sub>1</sub>:87"><span class="id" title="variable">s<sub>1</sub></span></a> <a class="idref" href="Noninterference.html#x:90"><span class="id" title="variable">x</span></a> <span class="id" title="keyword">else</span> <a class="idref" href="Noninterference.html#s<sub>2</sub>:88"><span class="id" title="variable">s<sub>2</sub></span></a> <a class="idref" href="Noninterference.html#x:90"><span class="id" title="variable">x</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <a id="split_state_fun" class="idref" href="#split_state_fun"><span class="id" title="definition">split_state_fun</span></a> (<a id="pub:91" class="idref" href="#pub:91"><span class="id" title="binder">pub</span></a> : <a class="idref" href="Noninterference.html#pub_map"><span class="id" title="definition">pub_map</span></a>) (<a id="mf:92" class="idref" href="#mf:92"><span class="id" title="binder">mf</span></a> : <a class="idref" href="Imp.html#state"><span class="id" title="definition">state</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Imp.html#state"><span class="id" title="definition">state</span></a>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="s<sub>1</sub>:93" class="idref" href="#s<sub>1</sub>:93"><span class="id" title="binder">s<sub>1</sub></span></a> <a id="s<sub>2</sub>:94" class="idref" href="#s<sub>2</sub>:94"><span class="id" title="binder">s<sub>2</sub></span></a> : <a class="idref" href="Imp.html#state"><span class="id" title="definition">state</span></a> ⇒ <span class="id" title="keyword">let</span> <a id="ms:95" class="idref" href="#ms:95"><span class="id" title="binder">ms</span></a> := <a class="idref" href="Noninterference.html#mf:92"><span class="id" title="variable">mf</span></a> (<a class="idref" href="Noninterference.html#merge_states"><span class="id" title="definition">merge_states</span></a> <a class="idref" href="Noninterference.html#s<sub>1</sub>:93"><span class="id" title="variable">s<sub>1</sub></span></a> <a class="idref" href="Noninterference.html#s<sub>2</sub>:94"><span class="id" title="variable">s<sub>2</sub></span></a> <a class="idref" href="Noninterference.html#pub:91"><span class="id" title="variable">pub</span></a>) <span class="id" title="keyword">in</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">(</span></a><a class="idref" href="Noninterference.html#split_state"><span class="id" title="definition">split_state</span></a> <a class="idref" href="Noninterference.html#ms:95"><span class="id" title="variable">ms</span></a> <a class="idref" href="Noninterference.html#pub:91"><span class="id" title="variable">pub</span></a> <a class="idref" href="Imp.html#:::'true'"><span class="id" title="notation">true</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">,</span></a> <a class="idref" href="Noninterference.html#split_state"><span class="id" title="definition">split_state</span></a> <a class="idref" href="Noninterference.html#ms:95"><span class="id" title="variable">ms</span></a> <a class="idref" href="Noninterference.html#pub:91"><span class="id" title="variable">pub</span></a> <a class="idref" href="Imp.html#:::'false'"><span class="id" title="notation">false</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Datatypes.html#e6756e10c36f149b18b4a8741ed83079"><span class="id" title="notation">)</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <a id="pub_equiv_split" class="idref" href="#pub_equiv_split"><span class="id" title="definition">pub_equiv_split</span></a> (<a id="pub:96" class="idref" href="#pub:96"><span class="id" title="binder">pub</span></a> : <a class="idref" href="Noninterference.html#pub_map"><span class="id" title="definition">pub_map</span></a>) (<a id="s<sub>1</sub>:97" class="idref" href="#s<sub>1</sub>:97"><span class="id" title="binder">s<sub>1</sub></span></a> <a id="s<sub>2</sub>:98" class="idref" href="#s<sub>2</sub>:98"><span class="id" title="binder">s<sub>2</sub></span></a> : <a class="idref" href="Imp.html#state"><span class="id" title="definition">state</span></a>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="x:99" class="idref" href="#x:99"><span class="id" title="binder">x</span></a>:<a class="idref" href="http://coq.inria.fr/library//Coq.Strings.String.html#string"><span class="id" title="inductive">string</span></a>, (<a class="idref" href="Noninterference.html#split_state"><span class="id" title="definition">split_state</span></a> <a class="idref" href="Noninterference.html#s<sub>1</sub>:97"><span class="id" title="variable">s<sub>1</sub></span></a> <a class="idref" href="Noninterference.html#pub:96"><span class="id" title="variable">pub</span></a> <a class="idref" href="Imp.html#:::'true'"><span class="id" title="notation">true</span></a>) <a class="idref" href="Noninterference.html#x:99"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> (<a class="idref" href="Noninterference.html#split_state"><span class="id" title="definition">split_state</span></a> <a class="idref" href="Noninterference.html#s<sub>2</sub>:98"><span class="id" title="variable">s<sub>2</sub></span></a> <a class="idref" href="Noninterference.html#pub:96"><span class="id" title="variable">pub</span></a> <a class="idref" href="Imp.html#:::'true'"><span class="id" title="notation">true</span></a>) <a class="idref" href="Noninterference.html#x:99"><span class="id" title="variable">x</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Theorem</span> <a id="pub_equiv_split_iff" class="idref" href="#pub_equiv_split_iff"><span class="id" title="lemma">pub_equiv_split_iff</span></a> : <span class="id" title="keyword">∀</span> <a id="pub:100" class="idref" href="#pub:100"><span class="id" title="binder">pub</span></a> <a id="s<sub>1</sub>:101" class="idref" href="#s<sub>1</sub>:101"><span class="id" title="binder">s<sub>1</sub></span></a> <a id="s<sub>2</sub>:102" class="idref" href="#s<sub>2</sub>:102"><span class="id" title="binder">s<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Noninterference.html#pub_equiv"><span class="id" title="definition">pub_equiv</span></a> <a class="idref" href="Noninterference.html#pub:100"><span class="id" title="variable">pub</span></a> <a class="idref" href="Noninterference.html#s<sub>1</sub>:101"><span class="id" title="variable">s<sub>1</sub></span></a> <a class="idref" href="Noninterference.html#s<sub>2</sub>:102"><span class="id" title="variable">s<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">↔</span></a> <a class="idref" href="Noninterference.html#pub_equiv_split"><span class="id" title="definition">pub_equiv_split</span></a> <a class="idref" href="Noninterference.html#pub:100"><span class="id" title="variable">pub</span></a> <a class="idref" href="Noninterference.html#s<sub>1</sub>:101"><span class="id" title="variable">s<sub>1</sub></span></a> <a class="idref" href="Noninterference.html#s<sub>2</sub>:102"><span class="id" title="variable">s<sub>2</sub></span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Noninterference.html#pub_equiv"><span class="id" title="definition">pub_equiv</span></a>, <a class="idref" href="Noninterference.html#pub_equiv_split"><span class="id" title="definition">pub_equiv_split</span></a>, <a class="idref" href="Noninterference.html#split_state"><span class="id" title="definition">split_state</span></a>. <span class="id" title="tactic">intros</span>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">H</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">destruct</span> (<a class="idref" href="http://coq.inria.fr/library//Coq.Bool.Bool.html#eqb_spec"><span class="id" title="lemma">Bool.eqb_spec</span></a> (<span class="id" title="var">pub</span> <span class="id" title="var">x</span>) <a class="idref" href="Imp.html#:::'true'"><span class="id" title="notation">true</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">e</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">H</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> <span class="id" title="var">x</span>). <span class="id" title="tactic">destruct</span> (<a class="idref" href="http://coq.inria.fr/library//Coq.Bool.Bool.html#eqb_spec"><span class="id" title="lemma">Bool.eqb_spec</span></a> (<span class="id" title="var">pub</span> <span class="id" title="var">x</span>) <a class="idref" href="Imp.html#:::'true'"><span class="id" title="notation">true</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">intros</span> <span class="id" title="var">_</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">contradiction</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Theorem</span> <a id="pub_equiv_merge_states" class="idref" href="#pub_equiv_merge_states"><span class="id" title="lemma">pub_equiv_merge_states</span></a> : <span class="id" title="keyword">∀</span> <a id="pub:103" class="idref" href="#pub:103"><span class="id" title="binder">pub</span></a> <a id="s:104" class="idref" href="#s:104"><span class="id" title="binder">s</span></a> <a id="z<sub>1</sub>:105" class="idref" href="#z<sub>1</sub>:105"><span class="id" title="binder">z<sub>1</sub></span></a> <a id="z<sub>2</sub>:106" class="idref" href="#z<sub>2</sub>:106"><span class="id" title="binder">z<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Noninterference.html#pub_equiv"><span class="id" title="definition">pub_equiv</span></a> <a class="idref" href="Noninterference.html#pub:103"><span class="id" title="variable">pub</span></a> (<a class="idref" href="Noninterference.html#merge_states"><span class="id" title="definition">merge_states</span></a> <a class="idref" href="Noninterference.html#s:104"><span class="id" title="variable">s</span></a> <a class="idref" href="Noninterference.html#z<sub>1</sub>:105"><span class="id" title="variable">z<sub>1</sub></span></a> <a class="idref" href="Noninterference.html#pub:103"><span class="id" title="variable">pub</span></a>) (<a class="idref" href="Noninterference.html#merge_states"><span class="id" title="definition">merge_states</span></a> <a class="idref" href="Noninterference.html#s:104"><span class="id" title="variable">s</span></a> <a class="idref" href="Noninterference.html#z<sub>2</sub>:106"><span class="id" title="variable">z<sub>2</sub></span></a> <a class="idref" href="Noninterference.html#pub:103"><span class="id" title="variable">pub</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Noninterference.html#pub_equiv"><span class="id" title="definition">pub_equiv</span></a>, <a class="idref" href="Noninterference.html#merge_states"><span class="id" title="definition">merge_states</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">pub</span> <span class="id" title="var">s</span> <span class="id" title="var">z<sub>1</sub></span> <span class="id" title="var">z<sub>2</sub></span> <span class="id" title="var">x</span> <span class="id" title="var">Hx</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hx</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Require</span> <span class="id" title="keyword">Import</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Logic.FunctionalExtensionality.html#"><span class="id" title="library">FunctionalExtensionality</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Theorem</span> <a id="merge_states_split_state" class="idref" href="#merge_states_split_state"><span class="id" title="lemma">merge_states_split_state</span></a> : <span class="id" title="keyword">∀</span> <a id="s:107" class="idref" href="#s:107"><span class="id" title="binder">s</span></a> <a id="pub:108" class="idref" href="#pub:108"><span class="id" title="binder">pub</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Noninterference.html#merge_states"><span class="id" title="definition">merge_states</span></a> (<a class="idref" href="Noninterference.html#split_state"><span class="id" title="definition">split_state</span></a> <a class="idref" href="Noninterference.html#s:107"><span class="id" title="variable">s</span></a> <a class="idref" href="Noninterference.html#pub:108"><span class="id" title="variable">pub</span></a> <a class="idref" href="Imp.html#:::'true'"><span class="id" title="notation">true</span></a>) (<a class="idref" href="Noninterference.html#split_state"><span class="id" title="definition">split_state</span></a> <a class="idref" href="Noninterference.html#s:107"><span class="id" title="variable">s</span></a> <a class="idref" href="Noninterference.html#pub:108"><span class="id" title="variable">pub</span></a> <a class="idref" href="Imp.html#:::'false'"><span class="id" title="notation">false</span></a>) <a class="idref" href="Noninterference.html#pub:108"><span class="id" title="variable">pub</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Noninterference.html#s:107"><span class="id" title="variable">s</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Noninterference.html#merge_states"><span class="id" title="definition">merge_states</span></a>, <a class="idref" href="Noninterference.html#split_state"><span class="id" title="definition">split_state</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">s</span> <span class="id" title="var">pub</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Logic.FunctionalExtensionality.html#functional_extensionality"><span class="id" title="lemma">functional_extensionality</span></a>. <span class="id" title="tactic">intro</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">pub</span> <span class="id" title="var">x</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Heq</span>; <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Now we can finally state our theorem about the equivalence between
    non_interferent_state and noninterferent: 
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <a id="noninterferent_state_ni" class="idref" href="#noninterferent_state_ni"><span class="id" title="lemma">noninterferent_state_ni</span></a> : <span class="id" title="keyword">∀</span> <a id="pub:109" class="idref" href="#pub:109"><span class="id" title="binder">pub</span></a> <a id="f:110" class="idref" href="#f:110"><span class="id" title="binder">f</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Noninterference.html#noninterferent_state"><span class="id" title="definition">noninterferent_state</span></a> <a class="idref" href="Noninterference.html#pub:109"><span class="id" title="variable">pub</span></a> <a class="idref" href="Noninterference.html#f:110"><span class="id" title="variable">f</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">↔</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Noninterference.html#noninterferent"><span class="id" title="definition">noninterferent</span></a> (<a class="idref" href="Noninterference.html#split_state_fun"><span class="id" title="definition">split_state_fun</span></a> <a class="idref" href="Noninterference.html#pub:109"><span class="id" title="variable">pub</span></a> <a class="idref" href="Noninterference.html#f:110"><span class="id" title="variable">f</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Noninterference.html#noninterferent_state"><span class="id" title="definition">noninterferent_state</span></a>, <a class="idref" href="Noninterference.html#noninterferent"><span class="id" title="definition">noninterferent</span></a>, <a class="idref" href="Noninterference.html#split_state_fun"><span class="id" title="definition">split_state_fun</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">pub</span> <span class="id" title="var">f</span>. <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">H</span> <span class="id" title="var">s</span> <span class="id" title="var">z<sub>1</sub></span> <span class="id" title="var">z<sub>2</sub></span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H'</span> : <a class="idref" href="Noninterference.html#pub_equiv"><span class="id" title="definition">pub_equiv</span></a> <span class="id" title="var">pub</span> (<a class="idref" href="Noninterference.html#merge_states"><span class="id" title="definition">merge_states</span></a> <span class="id" title="var">s</span> <span class="id" title="var">z<sub>1</sub></span> <span class="id" title="var">pub</span>) (<a class="idref" href="Noninterference.html#merge_states"><span class="id" title="definition">merge_states</span></a> <span class="id" title="var">s</span> <span class="id" title="var">z<sub>2</sub></span> <span class="id" title="var">pub</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">by</span> <span class="id" title="tactic">apply</span> <a class="idref" href="Noninterference.html#pub_equiv_merge_states"><span class="id" title="lemma">pub_equiv_merge_states</span></a>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H'</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="Noninterference.html#pub_equiv_split_iff"><span class="id" title="lemma">pub_equiv_split_iff</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">H'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Noninterference.html#pub_equiv_split"><span class="id" title="definition">pub_equiv_split</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">H'</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Logic.FunctionalExtensionality.html#functional_extensionality"><span class="id" title="lemma">functional_extensionality</span></a>. <span class="id" title="tactic">apply</span> <span class="id" title="var">H'</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">H</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">Hequiv</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="Noninterference.html#pub_equiv_split_iff"><span class="id" title="lemma">pub_equiv_split_iff</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">Hequiv</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Noninterference.html#pub_equiv_split"><span class="id" title="definition">pub_equiv_split</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">Hequiv</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="Noninterference.html#pub_equiv_split_iff"><span class="id" title="lemma">pub_equiv_split_iff</span></a>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Noninterference.html#pub_equiv_split"><span class="id" title="definition">pub_equiv_split</span></a>. <span class="id" title="tactic">intro</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> (<a class="idref" href="Noninterference.html#split_state"><span class="id" title="definition">split_state</span></a> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">pub</span> <a class="idref" href="Imp.html#:::'true'"><span class="id" title="notation">true</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Noninterference.html#split_state"><span class="id" title="definition">split_state</span></a> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">pub</span> <a class="idref" href="Imp.html#:::'false'"><span class="id" title="notation">false</span></a>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Noninterference.html#split_state"><span class="id" title="definition">split_state</span></a> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">pub</span> <a class="idref" href="Imp.html#:::'false'"><span class="id" title="notation">false</span></a>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="Noninterference.html#merge_states_split_state"><span class="id" title="lemma">merge_states_split_state</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Logic.FunctionalExtensionality.html#functional_extensionality"><span class="id" title="lemma">functional_extensionality</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">Hequiv</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hequiv</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="Noninterference.html#merge_states_split_state"><span class="id" title="lemma">merge_states_split_state</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab431"></a><h2 class="section">SME with state</h2>

</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="sme_state" class="idref" href="#sme_state"><span class="id" title="definition">sme_state</span></a> (<a id="f:111" class="idref" href="#f:111"><span class="id" title="binder">f</span></a> : <a class="idref" href="Imp.html#state"><span class="id" title="definition">state</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Imp.html#state"><span class="id" title="definition">state</span></a>) (<a id="pub:112" class="idref" href="#pub:112"><span class="id" title="binder">pub</span></a>:<a class="idref" href="Noninterference.html#pub_map"><span class="id" title="definition">pub_map</span></a>) :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">fun</span> <a id="s:113" class="idref" href="#s:113"><span class="id" title="binder">s</span></a> ⇒ <a class="idref" href="Noninterference.html#merge_states"><span class="id" title="definition">merge_states</span></a> (<a class="idref" href="Noninterference.html#f:111"><span class="id" title="variable">f</span></a> (<a class="idref" href="Noninterference.html#split_state"><span class="id" title="definition">split_state</span></a> <a class="idref" href="Noninterference.html#s:113"><span class="id" title="variable">s</span></a> <a class="idref" href="Noninterference.html#pub:112"><span class="id" title="variable">pub</span></a> <a class="idref" href="Imp.html#:::'true'"><span class="id" title="notation">true</span></a>)) (<a class="idref" href="Noninterference.html#f:111"><span class="id" title="variable">f</span></a> <a class="idref" href="Noninterference.html#s:113"><span class="id" title="variable">s</span></a>) <a class="idref" href="Noninterference.html#pub:112"><span class="id" title="variable">pub</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Theorem</span> <a id="noninterferent_sme_state" class="idref" href="#noninterferent_sme_state"><span class="id" title="lemma">noninterferent_sme_state</span></a> : <span class="id" title="keyword">∀</span> <a id="pub:114" class="idref" href="#pub:114"><span class="id" title="binder">pub</span></a> <a id="f:115" class="idref" href="#f:115"><span class="id" title="binder">f</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Noninterference.html#noninterferent_state"><span class="id" title="definition">noninterferent_state</span></a> <a class="idref" href="Noninterference.html#pub:114"><span class="id" title="variable">pub</span></a> (<a class="idref" href="Noninterference.html#sme_state"><span class="id" title="definition">sme_state</span></a> <a class="idref" href="Noninterference.html#f:115"><span class="id" title="variable">f</span></a> <a class="idref" href="Noninterference.html#pub:114"><span class="id" title="variable">pub</span></a>).<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Noninterference.html#noninterferent_state"><span class="id" title="definition">noninterferent_state</span></a>, <a class="idref" href="Noninterference.html#sme_state"><span class="id" title="definition">sme_state</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">pub</span> <span class="id" title="var">f</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">Hequiv</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <a class="idref" href="Noninterference.html#pub_equiv_split_iff"><span class="id" title="lemma">pub_equiv_split_iff</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">Hequiv</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Noninterference.html#pub_equiv_split"><span class="id" title="definition">pub_equiv_split</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">Hequiv</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Logic.FunctionalExtensionality.html#functional_extensionality"><span class="id" title="lemma">functional_extensionality</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">Hequiv</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hequiv</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Noninterference.html#pub_equiv_merge_states"><span class="id" title="lemma">pub_equiv_merge_states</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Theorem</span> <a id="transparent_sme_state" class="idref" href="#transparent_sme_state"><span class="id" title="lemma">transparent_sme_state</span></a> : <span class="id" title="keyword">∀</span> <a id="f:116" class="idref" href="#f:116"><span class="id" title="binder">f</span></a> <a id="pub:117" class="idref" href="#pub:117"><span class="id" title="binder">pub</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Noninterference.html#noninterferent_state"><span class="id" title="definition">noninterferent_state</span></a> <a class="idref" href="Noninterference.html#pub:117"><span class="id" title="variable">pub</span></a> <a class="idref" href="Noninterference.html#f:116"><span class="id" title="variable">f</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <span class="id" title="keyword">∀</span> <a id="s:118" class="idref" href="#s:118"><span class="id" title="binder">s</span></a>, <a class="idref" href="Noninterference.html#f:116"><span class="id" title="variable">f</span></a> <a class="idref" href="Noninterference.html#s:118"><span class="id" title="variable">s</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Noninterference.html#sme_state"><span class="id" title="definition">sme_state</span></a> <a class="idref" href="Noninterference.html#f:116"><span class="id" title="variable">f</span></a> <a class="idref" href="Noninterference.html#pub:117"><span class="id" title="variable">pub</span></a> <a class="idref" href="Noninterference.html#s:118"><span class="id" title="variable">s</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Noninterference.html#noninterferent_state"><span class="id" title="definition">noninterferent_state</span></a>, <a class="idref" href="Noninterference.html#sme_state"><span class="id" title="definition">sme_state</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">f</span> <span class="id" title="var">pub</span> <span class="id" title="var">Hni</span> <span class="id" title="var">s</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Noninterference.html#merge_states"><span class="id" title="definition">merge_states</span></a>, <a class="idref" href="Noninterference.html#split_state"><span class="id" title="definition">split_state</span></a>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Noninterference.html#pub_equiv"><span class="id" title="definition">pub_equiv</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">Hni</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Logic.FunctionalExtensionality.html#functional_extensionality"><span class="id" title="lemma">functional_extensionality</span></a>. <span class="id" title="tactic">intro</span> <span class="id" title="var">x</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">pub</span> <span class="id" title="var">x</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Eq</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">Hni</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">x'</span> <span class="id" title="var">Hx'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="http://coq.inria.fr/library//Coq.Bool.Bool.html#eqb_spec"><span class="id" title="lemma">Bool.eqb_spec</span></a> (<span class="id" title="var">pub</span> <span class="id" title="var">x'</span>) <a class="idref" href="Imp.html#:::'true'"><span class="id" title="notation">true</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab432"></a><h2 class="section">Noninterference and SME for Imp programs without loops</h2>

<div class="paragraph"> </div>

 For programs without loops the "failed attempt" evaluation function from
   <a href="Imp.html"><span class="inlineref">Imp</span></a> works well and allows us to easily define a state transformer
   function for each command. 
</div>
<div class="code">

<span class="id" title="keyword">Print</span> <a class="idref" href="Imp.html#ceval_fun_no_while"><span class="id" title="definition">ceval_fun_no_while</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <a id="noninterferent_no_while" class="idref" href="#noninterferent_no_while"><span class="id" title="definition">noninterferent_no_while</span></a> <a id="pub:119" class="idref" href="#pub:119"><span class="id" title="binder">pub</span></a> <a id="c:120" class="idref" href="#c:120"><span class="id" title="binder">c</span></a> : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Noninterference.html#noninterferent_state"><span class="id" title="definition">noninterferent_state</span></a> <a class="idref" href="Noninterference.html#pub:119"><span class="id" title="variable">pub</span></a> (<span class="id" title="keyword">fun</span> <a id="s:121" class="idref" href="#s:121"><span class="id" title="binder">s</span></a> ⇒ <a class="idref" href="Imp.html#ceval_fun_no_while"><span class="id" title="definition">ceval_fun_no_while</span></a> <a class="idref" href="Noninterference.html#s:121"><span class="id" title="variable">s</span></a> <a class="idref" href="Noninterference.html#c:120"><span class="id" title="variable">c</span></a>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <a id="xpub" class="idref" href="#xpub"><span class="id" title="definition">xpub</span></a> : <a class="idref" href="Noninterference.html#pub_map"><span class="id" title="definition">pub_map</span></a> :=<br/>
&nbsp;&nbsp;(<a class="idref" href="Imp.html#X"><span class="id" title="definition">X</span></a> <a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> <a class="idref" href="Imp.html#:::'true'"><span class="id" title="notation">true</span></a><a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;<a class="idref" href="Maps.html#b26b31fedd72ecba0f79904d3f161f8b"><span class="id" title="notation">_</span></a> <a class="idref" href="Maps.html#b26b31fedd72ecba0f79904d3f161f8b"><span class="id" title="notation">!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> <a class="idref" href="Imp.html#:::'false'"><span class="id" title="notation">false</span></a>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <a id="secure_com" class="idref" href="#secure_com"><span class="id" title="definition">secure_com</span></a> : <a class="idref" href="Imp.html#com"><span class="id" title="inductive">com</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Imp.html#23430cd9e427d30c054d4f029e39cb7f"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="Imp.html#X"><span class="id" title="definition">X</span></a> <a class="idref" href="Imp.html#91e9aa710642047a93142bdf557f1a1b"><span class="id" title="notation">:=</span></a> <a class="idref" href="Imp.html#X"><span class="id" title="definition">X</span></a><a class="idref" href="Imp.html#ad27fd091d9c8494ce7e5135135d19a<sub>8</sub>"><span class="id" title="notation">+</span></a>1<a class="idref" href="Imp.html#313afe74ec81f2da17d8e7bca3b042e<sub>7</sub>"><span class="id" title="notation">;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Imp.html#Y"><span class="id" title="definition">Y</span></a> <a class="idref" href="Imp.html#91e9aa710642047a93142bdf557f1a1b"><span class="id" title="notation">:=</span></a> <a class="idref" href="Imp.html#X"><span class="id" title="definition">X</span></a><a class="idref" href="Imp.html#ad27fd091d9c8494ce7e5135135d19a<sub>8</sub>"><span class="id" title="notation">+</span></a><a class="idref" href="Imp.html#Y"><span class="id" title="definition">Y</span></a><a class="idref" href="Imp.html#a73c7b35e67094dc8ae672f3a93da066"><span class="id" title="notation">×</span></a>2 <a class="idref" href="Imp.html#23430cd9e427d30c054d4f029e39cb7f"><span class="id" title="notation">}&gt;</span></a>.<br/>
</div>

<div class="doc">
For proving <span class="inlinecode"><span class="id" title="var">secure_com</span></span> noninterferent we first prove a few helper lemmas. 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="xpub_true" class="idref" href="#xpub_true"><span class="id" title="lemma">xpub_true</span></a> : <span class="id" title="keyword">∀</span> <a id="x:122" class="idref" href="#x:122"><span class="id" title="binder">x</span></a>, <a class="idref" href="Noninterference.html#xpub"><span class="id" title="definition">xpub</span></a> <a class="idref" href="Noninterference.html#x:122"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Imp.html#:::'true'"><span class="id" title="notation">true</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Noninterference.html#x:122"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Imp.html#X"><span class="id" title="definition">X</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Noninterference.html#xpub"><span class="id" title="definition">xpub</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">Hx</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<a class="idref" href="http://coq.inria.fr/library//Coq.Strings.String.html#eqb_spec"><span class="id" title="lemma">eqb_spec</span></a> <span class="id" title="var">x</span> <a class="idref" href="Imp.html#X"><span class="id" title="definition">X</span></a>).<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <a class="idref" href="Maps.html#t_update_neq"><span class="id" title="axiom">t_update_neq</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">Hx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">rewrite</span> <a class="idref" href="Maps.html#t_apply_empty"><span class="id" title="axiom">t_apply_empty</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">Hx</span>. <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">intro</span> <span class="id" title="var">contra</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="var">contradiction</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="xpubX" class="idref" href="#xpubX"><span class="id" title="lemma">xpubX</span></a> : <a class="idref" href="Noninterference.html#xpub"><span class="id" title="definition">xpub</span></a> <a class="idref" href="Imp.html#X"><span class="id" title="definition">X</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Imp.html#:::'true'"><span class="id" title="notation">true</span></a>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="noninterferent_secore_com" class="idref" href="#noninterferent_secore_com"><span class="id" title="lemma">noninterferent_secore_com</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Noninterference.html#noninterferent_no_while"><span class="id" title="definition">noninterferent_no_while</span></a> <a class="idref" href="Noninterference.html#xpub"><span class="id" title="definition">xpub</span></a> <a class="idref" href="Noninterference.html#secure_com"><span class="id" title="definition">secure_com</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Noninterference.html#noninterferent_no_while"><span class="id" title="definition">noninterferent_no_while</span></a>, <a class="idref" href="Noninterference.html#noninterferent_state"><span class="id" title="definition">noninterferent_state</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Noninterference.html#secure_com"><span class="id" title="definition">secure_com</span></a>, <a class="idref" href="Noninterference.html#pub_equiv"><span class="id" title="definition">pub_equiv</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">H</span> <span class="id" title="var">x</span> <span class="id" title="var">Hx</span>. <span class="id" title="tactic">simpl</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="Noninterference.html#xpub_true"><span class="id" title="lemma">xpub_true</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">Hx</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">subst</span>. <span class="id" title="tactic">rewrite</span> (<span class="id" title="var">H</span> <a class="idref" href="Imp.html#X"><span class="id" title="definition">X</span></a> <a class="idref" href="Noninterference.html#xpubX"><span class="id" title="lemma">xpubX</span></a>). <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Now let's look at a couple of insecure commands: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="insecure_com1" class="idref" href="#insecure_com1"><span class="id" title="definition">insecure_com1</span></a> : <a class="idref" href="Imp.html#com"><span class="id" title="inductive">com</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Imp.html#23430cd9e427d30c054d4f029e39cb7f"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="Imp.html#X"><span class="id" title="definition">X</span></a> <a class="idref" href="Imp.html#91e9aa710642047a93142bdf557f1a1b"><span class="id" title="notation">:=</span></a> <a class="idref" href="Imp.html#Y"><span class="id" title="definition">Y</span></a><a class="idref" href="Imp.html#ad27fd091d9c8494ce7e5135135d19a<sub>8</sub>"><span class="id" title="notation">+</span></a>1<a class="idref" href="Imp.html#313afe74ec81f2da17d8e7bca3b042e<sub>7</sub>"><span class="id" title="notation">;</span></a> <span class="comment">(*&nbsp;&lt;-&nbsp;bad&nbsp;explicit&nbsp;flow!&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Imp.html#Y"><span class="id" title="definition">Y</span></a> <a class="idref" href="Imp.html#91e9aa710642047a93142bdf557f1a1b"><span class="id" title="notation">:=</span></a> <a class="idref" href="Imp.html#X"><span class="id" title="definition">X</span></a><a class="idref" href="Imp.html#ad27fd091d9c8494ce7e5135135d19a<sub>8</sub>"><span class="id" title="notation">+</span></a><a class="idref" href="Imp.html#Y"><span class="id" title="definition">Y</span></a><a class="idref" href="Imp.html#a73c7b35e67094dc8ae672f3a93da066"><span class="id" title="notation">×</span></a>2 <a class="idref" href="Imp.html#23430cd9e427d30c054d4f029e39cb7f"><span class="id" title="notation">}&gt;</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="interferent_secore_com1" class="idref" href="#interferent_secore_com1"><span class="id" title="lemma">interferent_secore_com1</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">¬</span></a><a class="idref" href="Noninterference.html#noninterferent_no_while"><span class="id" title="definition">noninterferent_no_while</span></a> <a class="idref" href="Noninterference.html#xpub"><span class="id" title="definition">xpub</span></a> <a class="idref" href="Noninterference.html#insecure_com1"><span class="id" title="definition">insecure_com1</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Noninterference.html#noninterferent_no_while"><span class="id" title="definition">noninterferent_no_while</span></a>, <a class="idref" href="Noninterference.html#noninterferent_state"><span class="id" title="definition">noninterferent_state</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Noninterference.html#insecure_com1"><span class="id" title="definition">insecure_com1</span></a>, <a class="idref" href="Noninterference.html#pub_equiv"><span class="id" title="definition">pub_equiv</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intro</span> <span class="id" title="var">Hc</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hc</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hc</span> (<a class="idref" href="Imp.html#X"><span class="id" title="definition">X</span></a> <a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> 0 <a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">;</span></a> <a class="idref" href="Imp.html#Y"><span class="id" title="definition">Y</span></a> <a class="idref" href="Imp.html#c78e6ed7f05f8146dc2bcb368255bece"><span class="id" title="notation">!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> 0) (<a class="idref" href="Imp.html#X"><span class="id" title="definition">X</span></a> <a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> 0 <a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">;</span></a> <a class="idref" href="Imp.html#Y"><span class="id" title="definition">Y</span></a> <a class="idref" href="Imp.html#c78e6ed7f05f8146dc2bcb368255bece"><span class="id" title="notation">!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> 1)).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H</span>: <span class="id" title="keyword">∀</span> <a id="x:124" class="idref" href="#x:124"><span class="id" title="binder">x</span></a>, <a class="idref" href="Noninterference.html#xpub"><span class="id" title="definition">xpub</span></a> <a class="idref" href="Noninterference.html#x:123"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Imp.html#:::'true'"><span class="id" title="notation">true</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="Imp.html#X"><span class="id" title="definition">X</span></a> <a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> 0<a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">;</span></a> <a class="idref" href="Imp.html#Y"><span class="id" title="definition">Y</span></a> <a class="idref" href="Imp.html#c78e6ed7f05f8146dc2bcb368255bece"><span class="id" title="notation">!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> 0<a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">)</span></a> <a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">x</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="Imp.html#X"><span class="id" title="definition">X</span></a> <a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> 0<a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">;</span></a> <a class="idref" href="Imp.html#Y"><span class="id" title="definition">Y</span></a> <a class="idref" href="Imp.html#c78e6ed7f05f8146dc2bcb368255bece"><span class="id" title="notation">!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> 1<a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">)</span></a> <a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">x</span></a>).<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">clear</span> <span class="id" title="var">Hc</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="Noninterference.html#xpub_true"><span class="id" title="lemma">xpub_true</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hc</span> <span class="id" title="var">H</span> <a class="idref" href="Imp.html#X"><span class="id" title="definition">X</span></a> <a class="idref" href="Noninterference.html#xpubX"><span class="id" title="lemma">xpubX</span></a>). <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hc</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="Maps.html#t_update_eq"><span class="id" title="axiom">t_update_eq</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">Hc</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">discriminate</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Noninterference can be violated not only by <i>explicit flows</i> (i.e. assigning
    values that depend on secret variables into public variables), but also by
    <i>implicit flows</i>, which leak secret information via the control-flow of the
    program. Here is a simple example: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="insecure_com2" class="idref" href="#insecure_com2"><span class="id" title="definition">insecure_com2</span></a> : <a class="idref" href="Imp.html#com"><span class="id" title="inductive">com</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Imp.html#23430cd9e427d30c054d4f029e39cb7f"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="Imp.html#:com:com_scope:'if'_x_'then'_x_'else'_x_'end'"><span class="id" title="notation">if</span></a> <a class="idref" href="Imp.html#Y"><span class="id" title="definition">Y</span></a> <a class="idref" href="Imp.html#9e5b22caf5d7cf490e97976162618c2a"><span class="id" title="notation">=</span></a> 0 <a class="idref" href="Imp.html#:com:com_scope:'if'_x_'then'_x_'else'_x_'end'"><span class="id" title="notation">then</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Imp.html#Y"><span class="id" title="definition">Y</span></a> <a class="idref" href="Imp.html#91e9aa710642047a93142bdf557f1a1b"><span class="id" title="notation">:=</span></a> 42<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Imp.html#:com:com_scope:'if'_x_'then'_x_'else'_x_'end'"><span class="id" title="notation">else</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Imp.html#X"><span class="id" title="definition">X</span></a> <a class="idref" href="Imp.html#91e9aa710642047a93142bdf557f1a1b"><span class="id" title="notation">:=</span></a> <a class="idref" href="Imp.html#X"><span class="id" title="definition">X</span></a><a class="idref" href="Imp.html#ad27fd091d9c8494ce7e5135135d19a<sub>8</sub>"><span class="id" title="notation">+</span></a>1 <span class="comment">(*&nbsp;&lt;-&nbsp;bad&nbsp;implicit&nbsp;flow!&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Imp.html#:com:com_scope:'if'_x_'then'_x_'else'_x_'end'"><span class="id" title="notation">end</span></a> <a class="idref" href="Imp.html#23430cd9e427d30c054d4f029e39cb7f"><span class="id" title="notation">}&gt;</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="interferent_secore_com2" class="idref" href="#interferent_secore_com2"><span class="id" title="lemma">interferent_secore_com2</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">¬</span></a><a class="idref" href="Noninterference.html#noninterferent_no_while"><span class="id" title="definition">noninterferent_no_while</span></a> <a class="idref" href="Noninterference.html#xpub"><span class="id" title="definition">xpub</span></a> <a class="idref" href="Noninterference.html#insecure_com2"><span class="id" title="definition">insecure_com2</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;same&nbsp;proof&nbsp;as&nbsp;for&nbsp;<span class="inlinecode"><span class="id" title="var">insecure_com1</span></span>&nbsp;does&nbsp;the&nbsp;job&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Noninterference.html#noninterferent_no_while"><span class="id" title="definition">noninterferent_no_while</span></a>, <a class="idref" href="Noninterference.html#noninterferent_state"><span class="id" title="definition">noninterferent_state</span></a>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Noninterference.html#insecure_com2"><span class="id" title="definition">insecure_com2</span></a>, <a class="idref" href="Noninterference.html#pub_equiv"><span class="id" title="definition">pub_equiv</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intro</span> <span class="id" title="var">Hc</span>. <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hc</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hc</span> (<a class="idref" href="Imp.html#X"><span class="id" title="definition">X</span></a> <a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> 0 <a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">;</span></a> <a class="idref" href="Imp.html#Y"><span class="id" title="definition">Y</span></a> <a class="idref" href="Imp.html#c78e6ed7f05f8146dc2bcb368255bece"><span class="id" title="notation">!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> 0) (<a class="idref" href="Imp.html#X"><span class="id" title="definition">X</span></a> <a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> 0 <a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">;</span></a> <a class="idref" href="Imp.html#Y"><span class="id" title="definition">Y</span></a> <a class="idref" href="Imp.html#c78e6ed7f05f8146dc2bcb368255bece"><span class="id" title="notation">!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> 1)).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H</span>: <span class="id" title="keyword">∀</span> <a id="x:126" class="idref" href="#x:126"><span class="id" title="binder">x</span></a>, <a class="idref" href="Noninterference.html#xpub"><span class="id" title="definition">xpub</span></a> <a class="idref" href="Noninterference.html#x:125"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Imp.html#:::'true'"><span class="id" title="notation">true</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="Imp.html#X"><span class="id" title="definition">X</span></a> <a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> 0<a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">;</span></a> <a class="idref" href="Imp.html#Y"><span class="id" title="definition">Y</span></a> <a class="idref" href="Imp.html#c78e6ed7f05f8146dc2bcb368255bece"><span class="id" title="notation">!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> 0<a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">)</span></a> <a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">x</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="Imp.html#X"><span class="id" title="definition">X</span></a> <a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> 0<a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">;</span></a> <a class="idref" href="Imp.html#Y"><span class="id" title="definition">Y</span></a> <a class="idref" href="Imp.html#c78e6ed7f05f8146dc2bcb368255bece"><span class="id" title="notation">!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> 1<a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">)</span></a> <a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">x</span></a>).<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">clear</span> <span class="id" title="var">Hc</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="Noninterference.html#xpub_true"><span class="id" title="lemma">xpub_true</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hc</span> <span class="id" title="var">H</span> <a class="idref" href="Imp.html#X"><span class="id" title="definition">X</span></a> <a class="idref" href="Noninterference.html#xpubX"><span class="id" title="lemma">xpubX</span></a>). <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">Hc</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">repeat</span> <span class="id" title="tactic">try</span> <span class="id" title="tactic">rewrite</span> <a class="idref" href="Maps.html#t_update_eq"><span class="id" title="axiom">t_update_eq</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">Hc</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">discriminate</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
We can use <span class="inlinecode"><span class="id" title="var">sme_state</span></span> to execute such programs to obtain a noninterferent
    state transformer, by running them 2 times, once on a state without secrets
    and once on the input state and then merging the state. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="sme_cmd" class="idref" href="#sme_cmd"><span class="id" title="definition">sme_cmd</span></a> <a id="c:127" class="idref" href="#c:127"><span class="id" title="binder">c</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Noninterference.html#sme_state"><span class="id" title="definition">sme_state</span></a> (<span class="id" title="keyword">fun</span> <a id="s:128" class="idref" href="#s:128"><span class="id" title="binder">s</span></a> ⇒ <a class="idref" href="Imp.html#ceval_fun_no_while"><span class="id" title="definition">ceval_fun_no_while</span></a> <a class="idref" href="Noninterference.html#s:128"><span class="id" title="variable">s</span></a> <a class="idref" href="Noninterference.html#c:127"><span class="id" title="variable">c</span></a>).<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <a id="sme_insecure_com1" class="idref" href="#sme_insecure_com1"><span class="id" title="definition">sme_insecure_com1</span></a> := <a class="idref" href="Noninterference.html#sme_cmd"><span class="id" title="definition">sme_cmd</span></a> <a class="idref" href="Noninterference.html#insecure_com1"><span class="id" title="definition">insecure_com1</span></a> <a class="idref" href="Noninterference.html#xpub"><span class="id" title="definition">xpub</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <a id="sme_insecure_com2" class="idref" href="#sme_insecure_com2"><span class="id" title="definition">sme_insecure_com2</span></a> := <a class="idref" href="Noninterference.html#sme_cmd"><span class="id" title="definition">sme_cmd</span></a> <a class="idref" href="Noninterference.html#insecure_com2"><span class="id" title="definition">insecure_com2</span></a> <a class="idref" href="Noninterference.html#xpub"><span class="id" title="definition">xpub</span></a>.<br/>
</div>

<div class="doc">
The result of applying <span class="inlinecode"><span class="id" title="var">sme_cmd</span></span> is no longer a program, but a state
    transformer. We can prove them noninterferent as state transformers using
    our noninterference theorem about <span class="inlinecode"><span class="id" title="var">sme_state</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <a id="noninterferent_sme_insecure_com1" class="idref" href="#noninterferent_sme_insecure_com1"><span class="id" title="lemma">noninterferent_sme_insecure_com1</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Noninterference.html#noninterferent_state"><span class="id" title="definition">noninterferent_state</span></a> <a class="idref" href="Noninterference.html#xpub"><span class="id" title="definition">xpub</span></a> <a class="idref" href="Noninterference.html#sme_insecure_com1"><span class="id" title="definition">sme_insecure_com1</span></a>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="Noninterference.html#noninterferent_sme_state"><span class="id" title="lemma">noninterferent_sme_state</span></a>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Theorem</span> <a id="noninterferent_sme_insecure_com2" class="idref" href="#noninterferent_sme_insecure_com2"><span class="id" title="lemma">noninterferent_sme_insecure_com2</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Noninterference.html#noninterferent_state"><span class="id" title="definition">noninterferent_state</span></a> <a class="idref" href="Noninterference.html#xpub"><span class="id" title="definition">xpub</span></a> <a class="idref" href="Noninterference.html#sme_insecure_com2"><span class="id" title="definition">sme_insecure_com2</span></a>.<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="Noninterference.html#noninterferent_sme_state"><span class="id" title="lemma">noninterferent_sme_state</span></a>. <span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab433"></a><h2 class="section">Noninterference and SME for Imp programs with loops</h2>

<div class="paragraph"> </div>

 In the presence of loops, we need to define noninterference using the
    evaluation relation of Imp: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="noninterferent_while" class="idref" href="#noninterferent_while"><span class="id" title="definition">noninterferent_while</span></a> <a id="pub:129" class="idref" href="#pub:129"><span class="id" title="binder">pub</span></a> <a id="c:130" class="idref" href="#c:130"><span class="id" title="binder">c</span></a> := <span class="id" title="keyword">∀</span> <a id="s<sub>1</sub>:131" class="idref" href="#s<sub>1</sub>:131"><span class="id" title="binder">s<sub>1</sub></span></a> <a id="s<sub>2</sub>:132" class="idref" href="#s<sub>2</sub>:132"><span class="id" title="binder">s<sub>2</sub></span></a> <a id="s<sub>1</sub>':133" class="idref" href="#s<sub>1</sub>':133"><span class="id" title="binder">s<sub>1</sub>'</span></a> <a id="s<sub>2</sub>':134" class="idref" href="#s<sub>2</sub>':134"><span class="id" title="binder">s<sub>2</sub>'</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Noninterference.html#pub_equiv"><span class="id" title="definition">pub_equiv</span></a> <a class="idref" href="Noninterference.html#pub:129"><span class="id" title="variable">pub</span></a> <a class="idref" href="Noninterference.html#s<sub>1</sub>:131"><span class="id" title="variable">s<sub>1</sub></span></a> <a class="idref" href="Noninterference.html#s<sub>2</sub>:132"><span class="id" title="variable">s<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Noninterference.html#s<sub>1</sub>:131"><span class="id" title="variable">s<sub>1</sub></span></a> <a class="idref" href="Imp.html#6037d1f4787d63984beccd5510872ee<sub>9</sub>"><span class="id" title="notation">=[</span></a> <a class="idref" href="Noninterference.html#c:130"><span class="id" title="variable">c</span></a> <a class="idref" href="Imp.html#6037d1f4787d63984beccd5510872ee<sub>9</sub>"><span class="id" title="notation">]=&gt;</span></a> <a class="idref" href="Noninterference.html#s<sub>1</sub>':133"><span class="id" title="variable">s<sub>1</sub>'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Noninterference.html#s<sub>2</sub>:132"><span class="id" title="variable">s<sub>2</sub></span></a> <a class="idref" href="Imp.html#6037d1f4787d63984beccd5510872ee<sub>9</sub>"><span class="id" title="notation">=[</span></a> <a class="idref" href="Noninterference.html#c:130"><span class="id" title="variable">c</span></a> <a class="idref" href="Imp.html#6037d1f4787d63984beccd5510872ee<sub>9</sub>"><span class="id" title="notation">]=&gt;</span></a> <a class="idref" href="Noninterference.html#s<sub>2</sub>':134"><span class="id" title="variable">s<sub>2</sub>'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Noninterference.html#pub_equiv"><span class="id" title="definition">pub_equiv</span></a> <a class="idref" href="Noninterference.html#pub:129"><span class="id" title="variable">pub</span></a> <a class="idref" href="Noninterference.html#s<sub>1</sub>':133"><span class="id" title="variable">s<sub>1</sub>'</span></a> <a class="idref" href="Noninterference.html#s<sub>2</sub>':134"><span class="id" title="variable">s<sub>2</sub>'</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Ltac</span> <span class="id" title="var">invert</span> <span class="id" title="var">H</span> := <span class="id" title="tactic">inversion</span> <span class="id" title="var">H</span>; <span class="id" title="tactic">subst</span>; <span class="id" title="tactic">clear</span> <span class="id" title="var">H</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="noninterferent_secore_com'" class="idref" href="#noninterferent_secore_com'"><span class="id" title="lemma">noninterferent_secore_com'</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Noninterference.html#noninterferent_while"><span class="id" title="definition">noninterferent_while</span></a> <a class="idref" href="Noninterference.html#xpub"><span class="id" title="definition">xpub</span></a> <a class="idref" href="Noninterference.html#secure_com"><span class="id" title="definition">secure_com</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Noninterference.html#noninterferent_while"><span class="id" title="definition">noninterferent_while</span></a>, <a class="idref" href="Noninterference.html#secure_com"><span class="id" title="definition">secure_com</span></a>, <a class="idref" href="Noninterference.html#pub_equiv"><span class="id" title="definition">pub_equiv</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">H</span> <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">H<sub>2</sub></span> <span class="id" title="var">x</span> <span class="id" title="var">Hx</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Noninterference.html#xpub_true"><span class="id" title="lemma">xpub_true</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">Hx</span>. <span class="id" title="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;the&nbsp;proof&nbsp;is&nbsp;the&nbsp;same,&nbsp;but&nbsp;with&nbsp;some&nbsp;extra&nbsp;ugly&nbsp;<span class="inlinecode"><span class="id" title="var">invert</span></span>s&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="var">invert</span> <span class="id" title="var">H<sub>1</sub></span>. <span class="id" title="var">invert</span> <span class="id" title="var">H<sub>4</sub></span>. <span class="id" title="var">invert</span> <span class="id" title="var">H<sub>7</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="var">invert</span> <span class="id" title="var">H<sub>2</sub></span>. <span class="id" title="var">invert</span> <span class="id" title="var">H<sub>3</sub></span>. <span class="id" title="var">invert</span> <span class="id" title="var">H<sub>6</sub></span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<span class="id" title="var">H</span> <a class="idref" href="Imp.html#X"><span class="id" title="definition">X</span></a> <a class="idref" href="Noninterference.html#xpubX"><span class="id" title="lemma">xpubX</span></a>). <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Now to define SME we also need to use a relation: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="sme_while" class="idref" href="#sme_while"><span class="id" title="definition">sme_while</span></a> (<a id="pub:135" class="idref" href="#pub:135"><span class="id" title="binder">pub</span></a>:<a class="idref" href="Noninterference.html#pub_map"><span class="id" title="definition">pub_map</span></a>) (<a id="c:136" class="idref" href="#c:136"><span class="id" title="binder">c</span></a>:<a class="idref" href="Imp.html#com"><span class="id" title="inductive">com</span></a>) (<a id="s:137" class="idref" href="#s:137"><span class="id" title="binder">s</span></a> <a id="s':138" class="idref" href="#s':138"><span class="id" title="binder">s'</span></a>:<a class="idref" href="Imp.html#state"><span class="id" title="definition">state</span></a>) : <span class="id" title="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">∃</span></a> <a id="ps:139" class="idref" href="#ps:139"><span class="id" title="binder">ps</span></a> <a id="ss:140" class="idref" href="#ss:140"><span class="id" title="binder">ss</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="Noninterference.html#split_state"><span class="id" title="definition">split_state</span></a> <a class="idref" href="Noninterference.html#s:137"><span class="id" title="variable">s</span></a> <a class="idref" href="Noninterference.html#pub:135"><span class="id" title="variable">pub</span></a> <a class="idref" href="Imp.html#:::'true'"><span class="id" title="notation">true</span></a> <a class="idref" href="Imp.html#6037d1f4787d63984beccd5510872ee<sub>9</sub>"><span class="id" title="notation">=[</span></a> <a class="idref" href="Noninterference.html#c:136"><span class="id" title="variable">c</span></a> <a class="idref" href="Imp.html#6037d1f4787d63984beccd5510872ee<sub>9</sub>"><span class="id" title="notation">]=&gt;</span></a> <a class="idref" href="Noninterference.html#ps:139"><span class="id" title="variable">ps</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Noninterference.html#s:137"><span class="id" title="variable">s</span></a> <a class="idref" href="Imp.html#6037d1f4787d63984beccd5510872ee<sub>9</sub>"><span class="id" title="notation">=[</span></a> <a class="idref" href="Noninterference.html#c:136"><span class="id" title="variable">c</span></a> <a class="idref" href="Imp.html#6037d1f4787d63984beccd5510872ee<sub>9</sub>"><span class="id" title="notation">]=&gt;</span></a> <a class="idref" href="Noninterference.html#ss:140"><span class="id" title="variable">ss</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Noninterference.html#merge_states"><span class="id" title="definition">merge_states</span></a> <a class="idref" href="Noninterference.html#ps:139"><span class="id" title="variable">ps</span></a> <a class="idref" href="Noninterference.html#ss:140"><span class="id" title="variable">ss</span></a> <a class="idref" href="Noninterference.html#pub:135"><span class="id" title="variable">pub</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Noninterference.html#s':138"><span class="id" title="variable">s'</span></a>.<br/>
</div>

<div class="doc">
To state that sme_eval is secure, we need to generalize our noninterference
    definition, so that it works not only with <span class="inlinecode"><span class="id" title="var">ceval</span></span>, but with any evaluation
    relation, including <span class="inlinecode"><span class="id" title="var">sme_while</span></span> <span class="inlinecode"><span class="id" title="var">pub</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="noninterferent_while_R" class="idref" href="#noninterferent_while_R"><span class="id" title="definition">noninterferent_while_R</span></a> (<a id="R:141" class="idref" href="#R:141"><span class="id" title="binder">R</span></a>:<a class="idref" href="Imp.html#com"><span class="id" title="inductive">com</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="Imp.html#state"><span class="id" title="definition">state</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="Imp.html#state"><span class="id" title="definition">state</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><span class="id" title="keyword">Prop</span>) <a id="pub:142" class="idref" href="#pub:142"><span class="id" title="binder">pub</span></a> <a id="c:143" class="idref" href="#c:143"><span class="id" title="binder">c</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="s<sub>1</sub>:144" class="idref" href="#s<sub>1</sub>:144"><span class="id" title="binder">s<sub>1</sub></span></a> <a id="s<sub>2</sub>:145" class="idref" href="#s<sub>2</sub>:145"><span class="id" title="binder">s<sub>2</sub></span></a> <a id="s<sub>1</sub>':146" class="idref" href="#s<sub>1</sub>':146"><span class="id" title="binder">s<sub>1</sub>'</span></a> <a id="s<sub>2</sub>':147" class="idref" href="#s<sub>2</sub>':147"><span class="id" title="binder">s<sub>2</sub>'</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Noninterference.html#pub_equiv"><span class="id" title="definition">pub_equiv</span></a> <a class="idref" href="Noninterference.html#pub:142"><span class="id" title="variable">pub</span></a> <a class="idref" href="Noninterference.html#s<sub>1</sub>:144"><span class="id" title="variable">s<sub>1</sub></span></a> <a class="idref" href="Noninterference.html#s<sub>2</sub>:145"><span class="id" title="variable">s<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Noninterference.html#R:141"><span class="id" title="variable">R</span></a> <a class="idref" href="Noninterference.html#c:143"><span class="id" title="variable">c</span></a> <a class="idref" href="Noninterference.html#s<sub>1</sub>:144"><span class="id" title="variable">s<sub>1</sub></span></a> <a class="idref" href="Noninterference.html#s<sub>1</sub>':146"><span class="id" title="variable">s<sub>1</sub>'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Noninterference.html#R:141"><span class="id" title="variable">R</span></a> <a class="idref" href="Noninterference.html#c:143"><span class="id" title="variable">c</span></a> <a class="idref" href="Noninterference.html#s<sub>2</sub>:145"><span class="id" title="variable">s<sub>2</sub></span></a> <a class="idref" href="Noninterference.html#s<sub>2</sub>':147"><span class="id" title="variable">s<sub>2</sub>'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Noninterference.html#pub_equiv"><span class="id" title="definition">pub_equiv</span></a> <a class="idref" href="Noninterference.html#pub:142"><span class="id" title="variable">pub</span></a> <a class="idref" href="Noninterference.html#s<sub>1</sub>':146"><span class="id" title="variable">s<sub>1</sub>'</span></a> <a class="idref" href="Noninterference.html#s<sub>2</sub>':147"><span class="id" title="variable">s<sub>2</sub>'</span></a>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Theorem</span> <a id="noninterferent_while_sme" class="idref" href="#noninterferent_while_sme"><span class="id" title="lemma">noninterferent_while_sme</span></a> : <span class="id" title="keyword">∀</span> <a id="pub:148" class="idref" href="#pub:148"><span class="id" title="binder">pub</span></a> <a id="c:149" class="idref" href="#c:149"><span class="id" title="binder">c</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Noninterference.html#noninterferent_while_R"><span class="id" title="definition">noninterferent_while_R</span></a> (<a class="idref" href="Noninterference.html#sme_while"><span class="id" title="definition">sme_while</span></a> <a class="idref" href="Noninterference.html#pub:148"><span class="id" title="variable">pub</span></a>) <a class="idref" href="Noninterference.html#pub:148"><span class="id" title="variable">pub</span></a> <a class="idref" href="Noninterference.html#c:149"><span class="id" title="variable">c</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;proof&nbsp;is&nbsp;as&nbsp;before,&nbsp;but&nbsp;now&nbsp;needs&nbsp;determinism&nbsp;of&nbsp;ceval&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Noninterference.html#noninterferent_while_R"><span class="id" title="definition">noninterferent_while_R</span></a>, <a class="idref" href="Noninterference.html#sme_while"><span class="id" title="definition">sme_while</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">pub</span> <span class="id" title="var">c</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">H</span> [<span class="id" title="var">ps<sub>1</sub></span> [<span class="id" title="var">ss<sub>1</sub></span> [<span class="id" title="var">H1p</span> [<span class="id" title="var">H1s</span> <span class="id" title="var">H1m</span>]]]]<br/>
                               [<span class="id" title="var">ps<sub>2</sub></span> [<span class="id" title="var">ss<sub>2</sub></span> [<span class="id" title="var">H2p</span> [<span class="id" title="var">H2s</span> <span class="id" title="var">H2m</span>]]]].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">subst</span>. <span class="id" title="tactic">rewrite</span> <a class="idref" href="Noninterference.html#pub_equiv_split_iff"><span class="id" title="lemma">pub_equiv_split_iff</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Noninterference.html#pub_equiv_split"><span class="id" title="definition">pub_equiv_split</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Logic.FunctionalExtensionality.html#functional_extensionality"><span class="id" title="lemma">functional_extensionality</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H1p</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<a class="idref" href="Imp.html#ceval_deterministic"><span class="id" title="lemma">ceval_deterministic</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">H1p</span> <span class="id" title="var">H2p</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Noninterference.html#pub_equiv_merge_states"><span class="id" title="lemma">pub_equiv_merge_states</span></a>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Turns out we can only prove a weak version of transparency, and this has to
    do with nontermination (more later). But first we need a few lemmas:  
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="pub_equiv_split_state" class="idref" href="#pub_equiv_split_state"><span class="id" title="lemma">pub_equiv_split_state</span></a> : <span class="id" title="keyword">∀</span> (<a id="pub:150" class="idref" href="#pub:150"><span class="id" title="binder">pub</span></a>:<a class="idref" href="Noninterference.html#pub_map"><span class="id" title="definition">pub_map</span></a>) <a id="s:151" class="idref" href="#s:151"><span class="id" title="binder">s</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Noninterference.html#pub_equiv"><span class="id" title="definition">pub_equiv</span></a> <a class="idref" href="Noninterference.html#pub:150"><span class="id" title="variable">pub</span></a> (<a class="idref" href="Noninterference.html#split_state"><span class="id" title="definition">split_state</span></a> <a class="idref" href="Noninterference.html#s:151"><span class="id" title="variable">s</span></a> <a class="idref" href="Noninterference.html#pub:150"><span class="id" title="variable">pub</span></a> <a class="idref" href="Imp.html#:::'true'"><span class="id" title="notation">true</span></a>) <a class="idref" href="Noninterference.html#s:151"><span class="id" title="variable">s</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Noninterference.html#pub_equiv"><span class="id" title="definition">pub_equiv</span></a>, <a class="idref" href="Noninterference.html#split_state"><span class="id" title="definition">split_state</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">pub</span> <span class="id" title="var">s</span> <span class="id" title="var">x</span> <span class="id" title="var">Hx</span>. <span class="id" title="tactic">destruct</span> (<a class="idref" href="http://coq.inria.fr/library//Coq.Bool.Bool.html#eqb_spec"><span class="id" title="lemma">Bool.eqb_spec</span></a> (<span class="id" title="var">pub</span> <span class="id" title="var">x</span>) <a class="idref" href="Imp.html#:::'true'"><span class="id" title="notation">true</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">reflexivity</span>. <span class="id" title="var">contradiction</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="pub_equiv_sym" class="idref" href="#pub_equiv_sym"><span class="id" title="lemma">pub_equiv_sym</span></a> : <span class="id" title="keyword">∀</span> (<a id="pub:152" class="idref" href="#pub:152"><span class="id" title="binder">pub</span></a>:<a class="idref" href="Noninterference.html#pub_map"><span class="id" title="definition">pub_map</span></a>) <a id="s<sub>1</sub>:153" class="idref" href="#s<sub>1</sub>:153"><span class="id" title="binder">s<sub>1</sub></span></a> <a id="s<sub>2</sub>:154" class="idref" href="#s<sub>2</sub>:154"><span class="id" title="binder">s<sub>2</sub></span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Noninterference.html#pub_equiv"><span class="id" title="definition">pub_equiv</span></a> <a class="idref" href="Noninterference.html#pub:152"><span class="id" title="variable">pub</span></a> <a class="idref" href="Noninterference.html#s<sub>1</sub>:153"><span class="id" title="variable">s<sub>1</sub></span></a> <a class="idref" href="Noninterference.html#s<sub>2</sub>:154"><span class="id" title="variable">s<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Noninterference.html#pub_equiv"><span class="id" title="definition">pub_equiv</span></a> <a class="idref" href="Noninterference.html#pub:152"><span class="id" title="variable">pub</span></a> <a class="idref" href="Noninterference.html#s<sub>2</sub>:154"><span class="id" title="variable">s<sub>2</sub></span></a> <a class="idref" href="Noninterference.html#s<sub>1</sub>:153"><span class="id" title="variable">s<sub>1</sub></span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Noninterference.html#pub_equiv"><span class="id" title="definition">pub_equiv</span></a>. <span class="id" title="tactic">intros</span> <span class="id" title="var">pub</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">H</span> <span class="id" title="var">x</span> <span class="id" title="var">Hx</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Lemma</span> <a id="merge_state_pub_equiv" class="idref" href="#merge_state_pub_equiv"><span class="id" title="lemma">merge_state_pub_equiv</span></a> : <span class="id" title="keyword">∀</span> <a id="pub:155" class="idref" href="#pub:155"><span class="id" title="binder">pub</span></a> <a id="ss:156" class="idref" href="#ss:156"><span class="id" title="binder">ss</span></a> <a id="ps:157" class="idref" href="#ps:157"><span class="id" title="binder">ps</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Noninterference.html#pub_equiv"><span class="id" title="definition">pub_equiv</span></a> <a class="idref" href="Noninterference.html#pub:155"><span class="id" title="variable">pub</span></a> <a class="idref" href="Noninterference.html#ss:156"><span class="id" title="variable">ss</span></a> <a class="idref" href="Noninterference.html#ps:157"><span class="id" title="variable">ps</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Noninterference.html#merge_states"><span class="id" title="definition">merge_states</span></a> <a class="idref" href="Noninterference.html#ps:157"><span class="id" title="variable">ps</span></a> <a class="idref" href="Noninterference.html#ss:156"><span class="id" title="variable">ss</span></a> <a class="idref" href="Noninterference.html#pub:155"><span class="id" title="variable">pub</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Noninterference.html#ss:156"><span class="id" title="variable">ss</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Noninterference.html#pub_equiv"><span class="id" title="definition">pub_equiv</span></a>, <a class="idref" href="Noninterference.html#merge_states"><span class="id" title="definition">merge_states</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">pub</span> <span class="id" title="var">ss</span> <span class="id" title="var">ps</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="http://coq.inria.fr/library//Coq.Logic.FunctionalExtensionality.html#functional_extensionality"><span class="id" title="lemma">functional_extensionality</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">x</span>. <span class="id" title="tactic">destruct</span> (<span class="id" title="var">pub</span> <span class="id" title="var">x</span>) <span class="id" title="var">eqn</span>:<span class="id" title="var">Heq</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">rewrite</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">reflexivity</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">reflexivity</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
More specifically, we can only prove that <span class="inlinecode"><span class="id" title="var">sme_while</span></span> execution implies
    <span class="inlinecode"><span class="id" title="var">ceval</span></span>. But we cannot prove the reverse implication, since a command
    terminating when starting in state <span class="inlinecode"><span class="id" title="var">s</span></span>, does not imply that it still
    terminates when starting in state <span class="inlinecode"><span class="id" title="var">split_state</span></span> <span class="inlinecode"><span class="id" title="var">s</span></span> <span class="inlinecode"><span class="id" title="var">pub</span></span> <span class="inlinecode"><span class="id" title="var">true</span></span>, as would be
    needed for showing <span class="inlinecode"><span class="id" title="var">sme_while</span></span>. 
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <a id="somewhat_transparent_while_sme" class="idref" href="#somewhat_transparent_while_sme"><span class="id" title="lemma">somewhat_transparent_while_sme</span></a> : <span class="id" title="keyword">∀</span> <a id="pub:158" class="idref" href="#pub:158"><span class="id" title="binder">pub</span></a> <a id="c:159" class="idref" href="#c:159"><span class="id" title="binder">c</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Noninterference.html#noninterferent_while"><span class="id" title="definition">noninterferent_while</span></a> <a class="idref" href="Noninterference.html#pub:158"><span class="id" title="variable">pub</span></a> <a class="idref" href="Noninterference.html#c:159"><span class="id" title="variable">c</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="s:160" class="idref" href="#s:160"><span class="id" title="binder">s</span></a> <a id="s':161" class="idref" href="#s':161"><span class="id" title="binder">s'</span></a>, (<a class="idref" href="Noninterference.html#sme_while"><span class="id" title="definition">sme_while</span></a> <a class="idref" href="Noninterference.html#pub:158"><span class="id" title="variable">pub</span></a>) <a class="idref" href="Noninterference.html#c:159"><span class="id" title="variable">c</span></a> <a class="idref" href="Noninterference.html#s:160"><span class="id" title="variable">s</span></a> <a class="idref" href="Noninterference.html#s':161"><span class="id" title="variable">s'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a> <a class="idref" href="Noninterference.html#s:160"><span class="id" title="variable">s</span></a> <a class="idref" href="Imp.html#6037d1f4787d63984beccd5510872ee<sub>9</sub>"><span class="id" title="notation">=[</span></a> <a class="idref" href="Noninterference.html#c:159"><span class="id" title="variable">c</span></a> <a class="idref" href="Imp.html#6037d1f4787d63984beccd5510872ee<sub>9</sub>"><span class="id" title="notation">]=&gt;</span></a> <a class="idref" href="Noninterference.html#s':161"><span class="id" title="variable">s'</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Noninterference.html#noninterferent_while"><span class="id" title="definition">noninterferent_while</span></a>, <a class="idref" href="Noninterference.html#sme_while"><span class="id" title="definition">sme_while</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">pub</span> <span class="id" title="var">c</span> <span class="id" title="var">Hni</span> <span class="id" title="var">s</span> <span class="id" title="var">s'</span> [<span class="id" title="var">ps</span> [<span class="id" title="var">ss</span> [<span class="id" title="var">Hp</span> [<span class="id" title="var">Hs</span> <span class="id" title="var">Hm</span>]]]]. <span class="id" title="tactic">subst</span> <span class="id" title="var">s'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">assert</span>(<span class="id" title="var">H</span>:<a class="idref" href="Noninterference.html#pub_equiv"><span class="id" title="definition">pub_equiv</span></a> <span class="id" title="var">pub</span> <span class="id" title="var">s</span> (<a class="idref" href="Noninterference.html#split_state"><span class="id" title="definition">split_state</span></a> <span class="id" title="var">s</span> <span class="id" title="var">pub</span> <a class="idref" href="Imp.html#:::'true'"><span class="id" title="notation">true</span></a>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <a class="idref" href="Noninterference.html#pub_equiv_sym"><span class="id" title="lemma">pub_equiv_sym</span></a>. <span class="id" title="tactic">apply</span> <a class="idref" href="Noninterference.html#pub_equiv_split_state"><span class="id" title="lemma">pub_equiv_split_state</span></a>. }<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hni</span> <span class="id" title="var">s</span> (<a class="idref" href="Noninterference.html#split_state"><span class="id" title="definition">split_state</span></a> <span class="id" title="var">s</span> <span class="id" title="var">pub</span> <a class="idref" href="Imp.html#:::'true'"><span class="id" title="notation">true</span></a>) <span class="id" title="var">ss</span> <span class="id" title="var">ps</span> <span class="id" title="var">H</span> <span class="id" title="var">Hs</span> <span class="id" title="var">Hp</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Noninterference.html#merge_state_pub_equiv"><span class="id" title="lemma">merge_state_pub_equiv</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">Hni</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hni</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Hs</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Still, it seems we can still do the same things as in the setting without
    while loops, including SME (just not fully transparent). So is there
    anything special about loops and nontermination?

<div class="paragraph"> </div>

    Yes, there is! Let's look at our noninterference definition again: 
</div>
<div class="code">

<span class="id" title="keyword">Print</span> <a class="idref" href="Noninterference.html#noninterferent_while"><span class="id" title="definition">noninterferent_while</span></a>.<br/>
</div>

<div class="doc">
It says that for any two <i>terminating</i> executions, if the initial states
    agree on their public variables, then so do the final states. This is
    traditionally called <i>termination-insensitive</i> noninterference (TINI),
    since it doesn't consider nontermination to be observable to an attacker.

<div class="paragraph"> </div>

    In particular, the following program is considered secure wrt TINI: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="termination_leak" class="idref" href="#termination_leak"><span class="id" title="definition">termination_leak</span></a> : <a class="idref" href="Imp.html#com"><span class="id" title="inductive">com</span></a> :=<br/>
&nbsp;&nbsp;<a class="idref" href="Imp.html#23430cd9e427d30c054d4f029e39cb7f"><span class="id" title="notation">&lt;{</span></a> <a class="idref" href="Imp.html#:com:com_scope:'if'_x_'then'_x_'else'_x_'end'"><span class="id" title="notation">if</span></a> <a class="idref" href="Imp.html#Y"><span class="id" title="definition">Y</span></a> <a class="idref" href="Imp.html#9e5b22caf5d7cf490e97976162618c2a"><span class="id" title="notation">=</span></a> 0 <a class="idref" href="Imp.html#:com:com_scope:'if'_x_'then'_x_'else'_x_'end'"><span class="id" title="notation">then</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Imp.html#Y"><span class="id" title="definition">Y</span></a> <a class="idref" href="Imp.html#91e9aa710642047a93142bdf557f1a1b"><span class="id" title="notation">:=</span></a> 42<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Imp.html#:com:com_scope:'if'_x_'then'_x_'else'_x_'end'"><span class="id" title="notation">else</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Imp.html#:com:com_scope:'while'_x_'do'_x_'end'"><span class="id" title="notation">while</span></a> <a class="idref" href="Imp.html#:com::'true'"><span class="id" title="notation">true</span></a> <a class="idref" href="Imp.html#:com:com_scope:'while'_x_'do'_x_'end'"><span class="id" title="notation">do</span></a> <a class="idref" href="Imp.html#:com:com_scope:'skip'"><span class="id" title="notation">skip</span></a> <a class="idref" href="Imp.html#:com:com_scope:'while'_x_'do'_x_'end'"><span class="id" title="notation">end</span></a> <span class="comment">(*&nbsp;&lt;-&nbsp;we&nbsp;leak&nbsp;the&nbsp;secret&nbsp;by&nbsp;looping&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Imp.html#:com:com_scope:'if'_x_'then'_x_'else'_x_'end'"><span class="id" title="notation">end</span></a> <a class="idref" href="Imp.html#23430cd9e427d30c054d4f029e39cb7f"><span class="id" title="notation">}&gt;</span></a>.<br/>
</div>

<div class="doc">
And we can prove it ... 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="Y_neq_X" class="idref" href="#Y_neq_X"><span class="id" title="lemma">Y_neq_X</span></a> : (<a class="idref" href="Imp.html#Y"><span class="id" title="definition">Y</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;&gt;'_x"><span class="id" title="notation">≠</span></a> <a class="idref" href="Imp.html#X"><span class="id" title="definition">X</span></a>).<br/>
<span class="id" title="keyword">Proof</span>. <span class="id" title="tactic">intro</span> <span class="id" title="var">contra</span>. <span class="id" title="tactic">discriminate</span>. <span class="id" title="keyword">Qed</span>.<br/><hr class='doublespaceincode'/>
<span class="id" title="keyword">Definition</span> <a id="tini_secure_termination_leak" class="idref" href="#tini_secure_termination_leak"><span class="id" title="definition">tini_secure_termination_leak</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="Noninterference.html#noninterferent_while"><span class="id" title="definition">noninterferent_while</span></a> <a class="idref" href="Noninterference.html#xpub"><span class="id" title="definition">xpub</span></a> <a class="idref" href="Noninterference.html#termination_leak"><span class="id" title="definition">termination_leak</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Noninterference.html#noninterferent_while"><span class="id" title="definition">noninterferent_while</span></a>, <a class="idref" href="Noninterference.html#termination_leak"><span class="id" title="definition">termination_leak</span></a>, <a class="idref" href="Noninterference.html#pub_equiv"><span class="id" title="definition">pub_equiv</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">H</span> <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">H<sub>2</sub></span> <span class="id" title="var">x</span> <span class="id" title="var">Hx</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="Noninterference.html#xpub_true"><span class="id" title="lemma">xpub_true</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">Hx</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">subst</span>. <span class="id" title="tactic">specialize</span> (<span class="id" title="var">H</span> <a class="idref" href="Imp.html#X"><span class="id" title="definition">X</span></a> <a class="idref" href="Noninterference.html#xpubX"><span class="id" title="lemma">xpubX</span></a>).<br/>
&nbsp;&nbsp;<span class="id" title="var">invert</span> <span class="id" title="var">H<sub>1</sub></span>.<br/>
&nbsp;&nbsp;+ <span class="id" title="var">invert</span> <span class="id" title="var">H<sub>8</sub></span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<a class="idref" href="Maps.html#t_update_neq"><span class="id" title="axiom">t_update_neq</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <a class="idref" href="Noninterference.html#Y_neq_X"><span class="id" title="lemma">Y_neq_X</span></a>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="var">invert</span> <span class="id" title="var">H<sub>2</sub></span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="var">invert</span> <span class="id" title="var">H<sub>8</sub></span>. <span class="id" title="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<a class="idref" href="Maps.html#t_update_neq"><span class="id" title="axiom">t_update_neq</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <a class="idref" href="Noninterference.html#Y_neq_X"><span class="id" title="lemma">Y_neq_X</span></a>). <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;× <span class="id" title="tactic">apply</span> <a class="idref" href="Imp.html#loop_never_stops"><span class="id" title="axiom">loop_never_stops</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>8</sub></span>. <span class="id" title="var">contradiction</span>.<br/>
&nbsp;&nbsp;+ <span class="id" title="tactic">apply</span> <a class="idref" href="Imp.html#loop_never_stops"><span class="id" title="axiom">loop_never_stops</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>8</sub></span>. <span class="id" title="var">contradiction</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
<a id="lab434"></a><h2 class="section">Termination-Sensitive Noninterference</h2>

<div class="paragraph"> </div>

 We can give a stronger definition of security that prevents such
    nontermination leaks. It is traditionally called <i>termination-sensitive
    noninterference</i> (TSNI) and it is defined as follows: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="tsni_while_R" class="idref" href="#tsni_while_R"><span class="id" title="definition">tsni_while_R</span></a> (<a id="R:162" class="idref" href="#R:162"><span class="id" title="binder">R</span></a>:<a class="idref" href="Imp.html#com"><span class="id" title="inductive">com</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="Imp.html#state"><span class="id" title="definition">state</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><a class="idref" href="Imp.html#state"><span class="id" title="definition">state</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><span class="id" title="keyword">Prop</span>) <a id="pub:163" class="idref" href="#pub:163"><span class="id" title="binder">pub</span></a> <a id="c:164" class="idref" href="#c:164"><span class="id" title="binder">c</span></a> :=<br/>
&nbsp;&nbsp;<span class="id" title="keyword">∀</span> <a id="s<sub>1</sub>:165" class="idref" href="#s<sub>1</sub>:165"><span class="id" title="binder">s<sub>1</sub></span></a> <a id="s<sub>2</sub>:166" class="idref" href="#s<sub>2</sub>:166"><span class="id" title="binder">s<sub>2</sub></span></a> <a id="s<sub>1</sub>':167" class="idref" href="#s<sub>1</sub>':167"><span class="id" title="binder">s<sub>1</sub>'</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Noninterference.html#pub_equiv"><span class="id" title="definition">pub_equiv</span></a> <a class="idref" href="Noninterference.html#pub:163"><span class="id" title="variable">pub</span></a> <a class="idref" href="Noninterference.html#s<sub>1</sub>:165"><span class="id" title="variable">s<sub>1</sub></span></a> <a class="idref" href="Noninterference.html#s<sub>2</sub>:166"><span class="id" title="variable">s<sub>2</sub></span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Noninterference.html#R:162"><span class="id" title="variable">R</span></a> <a class="idref" href="Noninterference.html#c:164"><span class="id" title="variable">c</span></a> <a class="idref" href="Noninterference.html#s<sub>1</sub>:165"><span class="id" title="variable">s<sub>1</sub></span></a> <a class="idref" href="Noninterference.html#s<sub>1</sub>':167"><span class="id" title="variable">s<sub>1</sub>'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">∃</span></a> <a id="s<sub>2</sub>':168" class="idref" href="#s<sub>2</sub>':168"><span class="id" title="binder">s<sub>2</sub>'</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="Noninterference.html#R:162"><span class="id" title="variable">R</span></a> <a class="idref" href="Noninterference.html#c:164"><span class="id" title="variable">c</span></a> <a class="idref" href="Noninterference.html#s<sub>2</sub>:166"><span class="id" title="variable">s<sub>2</sub></span></a> <a class="idref" href="Noninterference.html#s<sub>2</sub>':168"><span class="id" title="variable">s<sub>2</sub>'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#ba2b0e492d2b4675a0acf3ea92aabadd"><span class="id" title="notation">∧</span></a> <a class="idref" href="Noninterference.html#pub_equiv"><span class="id" title="definition">pub_equiv</span></a> <a class="idref" href="Noninterference.html#pub:163"><span class="id" title="variable">pub</span></a> <a class="idref" href="Noninterference.html#s<sub>1</sub>':167"><span class="id" title="variable">s<sub>1</sub>'</span></a> <a class="idref" href="Noninterference.html#s<sub>2</sub>':168"><span class="id" title="variable">s<sub>2</sub>'</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a>.<br/>
</div>

<div class="doc">
We can prove that <span class="inlinecode"><span class="id" title="var">termination_leak</span></span> doesn't satisfy TSNI: 
</div>
<div class="code">

<span class="id" title="keyword">Definition</span> <a id="tsni_insecure_termination_leak" class="idref" href="#tsni_insecure_termination_leak"><span class="id" title="definition">tsni_insecure_termination_leak</span></a> :<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#63a68285c81db8f9bc456233bb9ed181"><span class="id" title="notation">¬</span></a><a class="idref" href="Noninterference.html#tsni_while_R"><span class="id" title="definition">tsni_while_R</span></a> <a class="idref" href="Imp.html#ceval"><span class="id" title="inductive">ceval</span></a> <a class="idref" href="Noninterference.html#xpub"><span class="id" title="definition">xpub</span></a> <a class="idref" href="Noninterference.html#termination_leak"><span class="id" title="definition">termination_leak</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Noninterference.html#tsni_while_R"><span class="id" title="definition">tsni_while_R</span></a>, <a class="idref" href="Noninterference.html#termination_leak"><span class="id" title="definition">termination_leak</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">Hc</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hc</span> (<a class="idref" href="Imp.html#X"><span class="id" title="definition">X</span></a> <a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> 0 <a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">;</span></a> <a class="idref" href="Imp.html#Y"><span class="id" title="definition">Y</span></a> <a class="idref" href="Imp.html#c78e6ed7f05f8146dc2bcb368255bece"><span class="id" title="notation">!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> 0) (<a class="idref" href="Imp.html#X"><span class="id" title="definition">X</span></a> <a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> 0 <a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">;</span></a> <a class="idref" href="Imp.html#Y"><span class="id" title="definition">Y</span></a> <a class="idref" href="Imp.html#c78e6ed7f05f8146dc2bcb368255bece"><span class="id" title="notation">!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> 1)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<a class="idref" href="Imp.html#Y"><span class="id" title="definition">Y</span></a> <a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> 42<a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">;</span></a> <a class="idref" href="Imp.html#X"><span class="id" title="definition">X</span></a> <a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> 0 <a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">;</span></a> <a class="idref" href="Imp.html#Y"><span class="id" title="definition">Y</span></a> <a class="idref" href="Imp.html#c78e6ed7f05f8146dc2bcb368255bece"><span class="id" title="notation">!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> 0)).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">H</span>: <span class="id" title="keyword">∀</span> <a id="x:170" class="idref" href="#x:170"><span class="id" title="binder">x</span></a>, <a class="idref" href="Noninterference.html#xpub"><span class="id" title="definition">xpub</span></a> <a class="idref" href="Noninterference.html#x:169"><span class="id" title="variable">x</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Imp.html#:::'true'"><span class="id" title="notation">true</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="Imp.html#X"><span class="id" title="definition">X</span></a> <a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> 0<a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">;</span></a> <a class="idref" href="Imp.html#Y"><span class="id" title="definition">Y</span></a> <a class="idref" href="Imp.html#c78e6ed7f05f8146dc2bcb368255bece"><span class="id" title="notation">!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> 0<a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">)</span></a> <a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">x</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#6cd0f7b28b6092304087c7049437bb1a"><span class="id" title="notation">=</span></a> <a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="Imp.html#X"><span class="id" title="definition">X</span></a> <a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> 0<a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">;</span></a> <a class="idref" href="Imp.html#Y"><span class="id" title="definition">Y</span></a> <a class="idref" href="Imp.html#c78e6ed7f05f8146dc2bcb368255bece"><span class="id" title="notation">!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> 1<a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">)</span></a> <a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">x</span></a>).<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">clear</span> <span class="id" title="var">Hc</span>. <span class="id" title="tactic">intros</span> <span class="id" title="var">x</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">apply</span> <a class="idref" href="Noninterference.html#xpub_true"><span class="id" title="lemma">xpub_true</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">subst</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hc</span> <span class="id" title="var">H</span>). <span class="id" title="tactic">clear</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span> (<span class="id" title="var">HH</span> : <a class="idref" href="Imp.html#6037d1f4787d63984beccd5510872ee<sub>9</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="Imp.html#X"><span class="id" title="definition">X</span></a> <a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> 0<a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">;</span></a> <a class="idref" href="Imp.html#Y"><span class="id" title="definition">Y</span></a> <a class="idref" href="Imp.html#c78e6ed7f05f8146dc2bcb368255bece"><span class="id" title="notation">!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> 0<a class="idref" href="Imp.html#6037d1f4787d63984beccd5510872ee<sub>9</sub>"><span class="id" title="notation">)</span></a> <a class="idref" href="Imp.html#6037d1f4787d63984beccd5510872ee<sub>9</sub>"><span class="id" title="notation">=[</span></a> <a class="idref" href="Noninterference.html#termination_leak"><span class="id" title="definition">termination_leak</span></a> <a class="idref" href="Imp.html#6037d1f4787d63984beccd5510872ee<sub>9</sub>"><span class="id" title="notation">]=&gt;</span></a><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<a class="idref" href="Imp.html#6037d1f4787d63984beccd5510872ee<sub>9</sub>"><span class="id" title="notation">(</span></a><a class="idref" href="Imp.html#Y"><span class="id" title="definition">Y</span></a> <a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> 42<a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">;</span></a> <a class="idref" href="Imp.html#X"><span class="id" title="definition">X</span></a> <a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> 0<a class="idref" href="Maps.html#630986d105c0f1782d085b9a306379a<sub>7</sub>"><span class="id" title="notation">;</span></a> <a class="idref" href="Imp.html#Y"><span class="id" title="definition">Y</span></a> <a class="idref" href="Imp.html#c78e6ed7f05f8146dc2bcb368255bece"><span class="id" title="notation">!<span class="nowrap"><span style='font-size:85%;'><span style='vertical-align:5%;'><span style='letter-spacing:-.2em;'>-</span></span>&gt;</span></span></span></a> 0<a class="idref" href="Imp.html#6037d1f4787d63984beccd5510872ee<sub>9</sub>"><span class="id" title="notation">)</span></a>).<br/>
&nbsp;&nbsp;{ <span class="id" title="tactic">clear</span>. <span class="id" title="tactic">unfold</span> <a class="idref" href="Noninterference.html#termination_leak"><span class="id" title="definition">termination_leak</span></a>. <span class="id" title="tactic">constructor</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;- <span class="id" title="tactic">constructor</span>. <span class="id" title="tactic">reflexivity</span>. }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hc</span> <span class="id" title="var">HH</span>). <span class="id" title="tactic">clear</span> <span class="id" title="var">HH</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Hc</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">s<sub>2</sub>'</span> [<span class="id" title="var">Hc</span> <span class="id" title="var">_</span>]].<br/>
&nbsp;&nbsp;<span class="id" title="var">invert</span> <span class="id" title="var">Hc</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">simpl</span> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>4</sub></span>. <span class="id" title="tactic">discriminate</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <a class="idref" href="Imp.html#loop_never_stops"><span class="id" title="axiom">loop_never_stops</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">H<sub>5</sub></span>. <span class="id" title="var">contradiction</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
We can also prove that TSNI is stronger than TINI
    (noninterferent_while) 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="tsni_noninterferent" class="idref" href="#tsni_noninterferent"><span class="id" title="lemma">tsni_noninterferent</span></a> : <span class="id" title="keyword">∀</span> <a id="pub:171" class="idref" href="#pub:171"><span class="id" title="binder">pub</span></a> <a id="c:172" class="idref" href="#c:172"><span class="id" title="binder">c</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Noninterference.html#tsni_while_R"><span class="id" title="definition">tsni_while_R</span></a> <a class="idref" href="Imp.html#ceval"><span class="id" title="inductive">ceval</span></a> <a class="idref" href="Noninterference.html#pub:171"><span class="id" title="variable">pub</span></a> <a class="idref" href="Noninterference.html#c:172"><span class="id" title="variable">c</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Noninterference.html#noninterferent_while_R"><span class="id" title="definition">noninterferent_while_R</span></a> <a class="idref" href="Imp.html#ceval"><span class="id" title="inductive">ceval</span></a> <a class="idref" href="Noninterference.html#pub:171"><span class="id" title="variable">pub</span></a> <a class="idref" href="Noninterference.html#c:172"><span class="id" title="variable">c</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Noninterference.html#noninterferent_while_R"><span class="id" title="definition">noninterferent_while_R</span></a>, <a class="idref" href="Noninterference.html#tsni_while_R"><span class="id" title="definition">tsni_while_R</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">pub</span> <span class="id" title="var">c</span> <span class="id" title="var">Htsni</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">Hequiv</span> <span class="id" title="var">H<sub>1</sub></span> <span class="id" title="var">H<sub>2</sub></span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Htsni</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">Hequiv</span> <span class="id" title="var">H<sub>1</sub></span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Htsni</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">s<sub>2</sub>''</span> [<span class="id" title="var">H<sub>2</sub>'</span> <span class="id" title="var">Hequiv'</span>]].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<a class="idref" href="Imp.html#ceval_deterministic"><span class="id" title="lemma">ceval_deterministic</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">H<sub>2</sub></span> <span class="id" title="var">H<sub>2</sub>'</span>).<br/>
&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <span class="id" title="var">Hequiv'</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
The reverse direction of the implication only works for programs that
    always terminate (such as most of our simple examples above 
</div>
<div class="code">

<span class="id" title="keyword">Lemma</span> <a id="terminating_noninterferent_tsni" class="idref" href="#terminating_noninterferent_tsni"><span class="id" title="lemma">terminating_noninterferent_tsni</span></a>: <span class="id" title="keyword">∀</span> <a id="pub:173" class="idref" href="#pub:173"><span class="id" title="binder">pub</span></a> <a id="c:174" class="idref" href="#c:174"><span class="id" title="binder">c</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="s:175" class="idref" href="#s:175"><span class="id" title="binder">s</span></a>, <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">∃</span></a> <a id="s':176" class="idref" href="#s':176"><span class="id" title="binder">s'</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#a883bdd010993579f99d60b3775bcf54"><span class="id" title="notation">,</span></a> <a class="idref" href="Noninterference.html#s:175"><span class="id" title="variable">s</span></a> <a class="idref" href="Imp.html#6037d1f4787d63984beccd5510872ee<sub>9</sub>"><span class="id" title="notation">=[</span></a> <a class="idref" href="Noninterference.html#c:174"><span class="id" title="variable">c</span></a> <a class="idref" href="Imp.html#6037d1f4787d63984beccd5510872ee<sub>9</sub>"><span class="id" title="notation">]=&gt;</span></a> <a class="idref" href="Noninterference.html#s':176"><span class="id" title="variable">s'</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Noninterference.html#noninterferent_while_R"><span class="id" title="definition">noninterferent_while_R</span></a> <a class="idref" href="Imp.html#ceval"><span class="id" title="inductive">ceval</span></a> <a class="idref" href="Noninterference.html#pub:173"><span class="id" title="variable">pub</span></a> <a class="idref" href="Noninterference.html#c:174"><span class="id" title="variable">c</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="Noninterference.html#tsni_while_R"><span class="id" title="definition">tsni_while_R</span></a> <a class="idref" href="Imp.html#ceval"><span class="id" title="inductive">ceval</span></a> <a class="idref" href="Noninterference.html#pub:173"><span class="id" title="variable">pub</span></a> <a class="idref" href="Noninterference.html#c:174"><span class="id" title="variable">c</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Noninterference.html#noninterferent_while_R"><span class="id" title="definition">noninterferent_while_R</span></a>, <a class="idref" href="Noninterference.html#tsni_while_R"><span class="id" title="definition">tsni_while_R</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">pub</span> <span class="id" title="var">c</span> <span class="id" title="var">Hterminating</span> <span class="id" title="var">Hni</span> <span class="id" title="var">s<sub>1</sub></span> <span class="id" title="var">s<sub>2</sub></span> <span class="id" title="var">s<sub>1</sub>'</span> <span class="id" title="var">Eq</span> <span class="id" title="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> (<span class="id" title="var">Hterminating</span> <span class="id" title="var">s<sub>2</sub></span>) <span class="id" title="keyword">as</span> [<span class="id" title="var">s<sub>2</sub>'</span> <span class="id" title="var">H'</span>].<br/>
&nbsp;&nbsp;<span class="id" title="tactic">∃</span> <span class="id" title="var">s<sub>2</sub>'</span>; <span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">apply</span> <span class="id" title="var">Hni</span> <span class="id" title="keyword">with</span> (<span class="id" title="var">s<sub>1</sub></span> := <span class="id" title="var">s<sub>1</sub></span>) (<span class="id" title="var">s<sub>2</sub></span> := <span class="id" title="var">s<sub>2</sub></span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;+ <span class="id" title="tactic">assumption</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Now for a more interesting use of TSNI: it turns out that
    <span class="inlinecode"><span class="id" title="var">sme_while</span></span> is fully transparent for programs satisfying TSNI. 
</div>
<div class="code">

<span class="id" title="keyword">Theorem</span> <a id="tsni_transparent_while_sme" class="idref" href="#tsni_transparent_while_sme"><span class="id" title="lemma">tsni_transparent_while_sme</span></a> : <span class="id" title="keyword">∀</span> <a id="pub:177" class="idref" href="#pub:177"><span class="id" title="binder">pub</span></a> <a id="c:178" class="idref" href="#c:178"><span class="id" title="binder">c</span></a>,<br/>
&nbsp;&nbsp;<a class="idref" href="Noninterference.html#tsni_while_R"><span class="id" title="definition">tsni_while_R</span></a> <a class="idref" href="Imp.html#ceval"><span class="id" title="inductive">ceval</span></a> <a class="idref" href="Noninterference.html#pub:177"><span class="id" title="variable">pub</span></a> <a class="idref" href="Noninterference.html#c:178"><span class="id" title="variable">c</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">→</span></a><br/>
&nbsp;&nbsp;<a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">(</span></a><span class="id" title="keyword">∀</span> <a id="s:179" class="idref" href="#s:179"><span class="id" title="binder">s</span></a> <a id="s':180" class="idref" href="#s':180"><span class="id" title="binder">s'</span></a>, <a class="idref" href="Noninterference.html#s:179"><span class="id" title="variable">s</span></a> <a class="idref" href="Imp.html#6037d1f4787d63984beccd5510872ee<sub>9</sub>"><span class="id" title="notation">=[</span></a> <a class="idref" href="Noninterference.html#c:178"><span class="id" title="variable">c</span></a> <a class="idref" href="Imp.html#6037d1f4787d63984beccd5510872ee<sub>9</sub>"><span class="id" title="notation">]=&gt;</span></a> <a class="idref" href="Noninterference.html#s':180"><span class="id" title="variable">s'</span></a> <a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'&lt;-&gt;'_x"><span class="id" title="notation">↔</span></a> (<a class="idref" href="Noninterference.html#sme_while"><span class="id" title="definition">sme_while</span></a> <a class="idref" href="Noninterference.html#pub:177"><span class="id" title="variable">pub</span></a>) <a class="idref" href="Noninterference.html#c:178"><span class="id" title="variable">c</span></a> <a class="idref" href="Noninterference.html#s:179"><span class="id" title="variable">s</span></a> <a class="idref" href="Noninterference.html#s':180"><span class="id" title="variable">s'</span></a><a class="idref" href="http://coq.inria.fr/library//Coq.Init.Logic.html#::type_scope:x_'-&gt;'_x"><span class="id" title="notation">)</span></a>.<br/>
<span class="id" title="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">unfold</span> <a class="idref" href="Noninterference.html#tsni_while_R"><span class="id" title="definition">tsni_while_R</span></a>, <a class="idref" href="Noninterference.html#sme_while"><span class="id" title="definition">sme_while</span></a>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">intros</span> <span class="id" title="var">pub</span> <span class="id" title="var">c</span> <span class="id" title="var">Hni</span> <span class="id" title="var">s</span> <span class="id" title="var">s'</span>.<br/>
&nbsp;&nbsp;<span class="id" title="tactic">assert</span>(<span class="id" title="var">HH</span>:<a class="idref" href="Noninterference.html#pub_equiv"><span class="id" title="definition">pub_equiv</span></a> <span class="id" title="var">pub</span> <span class="id" title="var">s</span> (<a class="idref" href="Noninterference.html#split_state"><span class="id" title="definition">split_state</span></a> <span class="id" title="var">s</span> <span class="id" title="var">pub</span> <a class="idref" href="Imp.html#:::'true'"><span class="id" title="notation">true</span></a>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;{ <span class="id" title="tactic">apply</span> <a class="idref" href="Noninterference.html#pub_equiv_sym"><span class="id" title="lemma">pub_equiv_sym</span></a>. <span class="id" title="tactic">apply</span> <a class="idref" href="Noninterference.html#pub_equiv_split_state"><span class="id" title="lemma">pub_equiv_split_state</span></a>. }<br/>
&nbsp;&nbsp;<span class="id" title="tactic">split</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> <span class="id" title="var">H</span>. <span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hni</span> <span class="id" title="var">s</span> (<a class="idref" href="Noninterference.html#split_state"><span class="id" title="definition">split_state</span></a> <span class="id" title="var">s</span> <span class="id" title="var">pub</span> <a class="idref" href="Imp.html#:::'true'"><span class="id" title="notation">true</span></a>) <span class="id" title="var">s'</span> <span class="id" title="var">HH</span> <span class="id" title="var">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Hni</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">s''</span> [<span class="id" title="var">Heval</span> <span class="id" title="var">Hequiv</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">∃</span> <span class="id" title="var">s''</span>. <span class="id" title="tactic">∃</span> <span class="id" title="var">s'</span>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">assumption</span>. <span class="id" title="tactic">split</span>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Noninterference.html#merge_state_pub_equiv"><span class="id" title="lemma">merge_state_pub_equiv</span></a>. <span class="id" title="tactic">assumption</span>.<br/>
&nbsp;&nbsp;- <span class="id" title="tactic">intros</span> [<span class="id" title="var">ps</span> [<span class="id" title="var">ss</span> [<span class="id" title="var">Hp</span> [<span class="id" title="var">Hs</span> <span class="id" title="var">Hm</span>]]]]. <span class="id" title="tactic">subst</span> <span class="id" title="var">s'</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">specialize</span> (<span class="id" title="var">Hni</span> <span class="id" title="var">s</span> (<a class="idref" href="Noninterference.html#split_state"><span class="id" title="definition">split_state</span></a> <span class="id" title="var">s</span> <span class="id" title="var">pub</span> <a class="idref" href="Imp.html#:::'true'"><span class="id" title="notation">true</span></a>) <span class="id" title="var">ss</span> <span class="id" title="var">HH</span> <span class="id" title="var">Hs</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">destruct</span> <span class="id" title="var">Hni</span> <span class="id" title="keyword">as</span> [<span class="id" title="var">s'</span> [<span class="id" title="var">Hp'</span> <span class="id" title="var">Hni</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">rewrite</span> (<a class="idref" href="Imp.html#ceval_deterministic"><span class="id" title="lemma">ceval_deterministic</span></a> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">_</span> <span class="id" title="var">Hp</span> <span class="id" title="var">Hp'</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" title="tactic">apply</span> <a class="idref" href="Noninterference.html#merge_state_pub_equiv"><span class="id" title="lemma">merge_state_pub_equiv</span></a> <span class="id" title="keyword">in</span> <span class="id" title="var">Hni</span>. <span class="id" title="tactic">rewrite</span> <span class="id" title="var">Hni</span>. <span class="id" title="tactic">apply</span> <span class="id" title="var">Hs</span>.<br/>
<span class="id" title="keyword">Qed</span>.<br/>
</div>

<div class="doc">
Unfortunately <span class="inlinecode"><span class="id" title="var">sme_while</span></span>, as we defined it, does not imply TSNI, and this
    is hard to fix in our current setting where programs only return a result in
    the end, a final state, so we had to merge the public and secret inputs into
    a single final state. Instead, SME is commonly defined in a setting with
    interactive IO, in which public outputs and secret outputs can be performed
    independently, during the execution. In that setting, it does transparently
    enforce TSNI. 
</div>
<div class="code">

<span class="comment">(*&nbsp;2023-07-12&nbsp;20:43&nbsp;*)</span><br/>
</div>
</div>

<div id="footer">
<hr/><a href="coqindex.html">Index</a><hr/>This page has been generated by <a href="http://coq.inria.fr/">coqdoc</a>
</div>

</div>

</body>
</html>